# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [ ] [INFRA] Close stale-active failed-root drift in one deterministic watchdog sweep — in `scripts/watchdog.sh`, run a canonical active-root convergence pass that supersedes only `status=blocked|pending` rows whose normalized root is already present in `.dev/completed.md`, preserves `fixing-*` rows byte-for-byte, and emits before/after counters plus one stable root-hash summary. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [ ] [INFRA] Prevent project-driver from generating retry variants for active failed roots — in `scripts/project-driver.sh`, normalize unchecked candidate titles against active `pending|blocked|fixing-*` roots in `.dev/failed-tasks.md`, skip generation when a canonical root is already active, and log deterministic `driver_duplicate_root_skipped` counters. Mission: Criterion #2 retry-loop reduction and Criterion #3 durable root-cause planning.
- [x] [DATA] Surface stale-active convergence counters in status surfaces — add `staleActiveCompletedRows` and `supersededActiveRows` from watchdog reconciliation to `packages/dashboard/src/handlers/pipeline-status.ts` and CLI `status --json` output, keeping field semantics aligned. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [ ] [TEST] Add watchdog regression for deterministic stale-active sweep evidence — in `scripts/tests/watchdog.sh`, add a fixture with mixed `blocked|pending|fixing-*` rows where only completed-root stale active rows are superseded, unaffected rows remain byte-identical, and emitted counters/hash summary are stable across two identical runs. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [ ] [TEST] Add project-driver regression for active-root duplicate suppression counters — in `scripts/tests/project-driver.sh`, assert generation skips unchecked candidates when normalized roots are already active in `.dev/failed-tasks.md`, never skips unrelated roots, and emits deterministic `driver_duplicate_root_skipped` totals. Mission: Criterion #2 quality gates and Criterion #3 convergent planning.
- [ ] [DATA] Refresh blockers Active from canonical failed roots after stale-active supersede — in `scripts/watchdog.sh` blockers sync path, rebuild `.dev/blockers.md` Active from normalized active failed roots only after the convergence pass and skip file rewrite when active-root hash is unchanged. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [ ] [TEST] Add cross-surface parity regression for stale-active counters and root-hash fields — add/extend tests in `scripts/tests/watchdog.sh`, `packages/dashboard/src/handlers/pipeline-status.test.ts`, and CLI status tests to prove `staleActiveCompletedRows`, `supersededActiveRows`, and root-hash parity fields match semantics across watchdog, dashboard, and `status --json`. Mission: Criterion #2 quality gates and Criterion #4 telemetry trust.
- [ ] [INFRA] Add one canonical failed-task active-root diagnostics summarizer for blocked retries — in `scripts/watchdog.sh`, emit one deterministic diagnostics event per normalized active root (latest source row index, status, attempts) and suppress duplicate per-variant emissions so retries are tracked per root cause instead of per duplicate row. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.

# Recent checked history (last 30)
- [x] [TEST] Add watchdog regression for stale blocked/pending supersede guardrails — in `scripts/tests/watchdog.sh`, assert completed-root supersede touches only stale `blocked|pending` rows, never rewrites `fixing-*` rows, and preserves unaffected active-row ordering byte-for-byte. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(typecheck failed)_
- [x] [FIX] Harden failed-task table parsing for legacy unescaped pipe rows — in `scripts/_config.sh` parsing helpers and watchdog reconciliation reads, treat malformed pipe-expanded rows as recoverable (skip or normalize with explicit guard) instead of misclassifying status/attempt columns; emit deterministic skip logs with row index and preserve valid rows byte-for-byte. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability.
- [x] [INFRA] Add watchdog preflight sanitizer for malformed failed-task rows before dispatch — add one idempotent pass in `scripts/watchdog.sh` that validates `.dev/failed-tasks.md` row column counts, repairs only known legacy corruption patterns from unescaped table pipes, and emits before/after counters (`rows_scanned`, `rows_repaired`, `rows_skipped`). Mission: Criterion #2 self-correction throughput and Criterion #3 convergent recovery state.
- [x] [INFRA] Enforce canonical backlog marker ordering in project-driver writes — in `scripts/project-driver.sh` backlog rewrite path, guarantee `[>]` rows remain first (byte-for-byte), `[ ]` rows follow, and top-level `[x]` rows are moved only into checked history section so active work is never buried by history noise. Mission: Criterion #3 deterministic planning state and Criterion #2 no-task-loss reliability.
- [x] [INFRA] Centralize failed-task markdown field codec into one shared shell path — in `scripts/_config.sh`, expose canonical encode/decode helpers for failed-task table fields (pipes, backticks, escaped newlines) and migrate `scripts/task-fixer.sh` plus `scripts/watchdog.sh` to exclusively use those helpers for all reads/writes. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability.
- [x] [TEST] Add shell regression for failed-task field codec round-trip invariants — in shell tests for failed-task parsing/writes, feed adversarial task/error/branch strings through shared codec helpers and assert parse-stable round trips plus unchanged active-root counting semantics. Mission: Criterion #2 quality gates and Criterion #3 convergent parsing.
- [x] [INFRA] Add failed-task history rotation guardrail with archive parity checks — in `scripts/watchdog.sh`, move older `fixed|superseded` rows from `.dev/failed-tasks.md` into `.dev/failed-tasks-archive.md` after a configurable cap while preserving active row ordering and table integrity. Mission: Criterion #2 retry-loop throughput and Criterion #3 deterministic state management.
- [x] [DATA] Emit canonical failed-root snapshot and blockers parity telemetry per reconciliation cycle — in `scripts/watchdog.sh`, publish deterministic `activeRootHash`, `blockersActiveHash`, and `hashMatch` payloads from normalized active roots, and emit a mismatch event when blockers drift from failed-root reality. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add watchdog shell regression for hash-drift alert throttling lifecycle — in `scripts/tests/watchdog.sh`, simulate consecutive `hashMatch=false` cycles to assert one throttled high-severity alert per cooldown window, then verify alerting re-arms only after convergence. Mission: Criterion #2 quality gates and Criterion #4 operational trust. _(typecheck failed)_
- [x] [NMI] Publish one canonical blocked-root diagnostics row per true open root — parse `.dev/failed-tasks.md` active `blocked|pending` rows, capture latest exact `pnpm typecheck` diagnostics from `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, then emit one follow-up task per normalized root and supersede duplicate variants. Mission: Criterion #2 self-correction closure and Criterion #3 convergent retry state. _(typecheck failed)_
- [x] [TEST] Add shell regression for auth-gate dispatch suppression lifecycle — in `scripts/tests/watchdog.sh`, simulate failed agent auth checks to assert dispatch suppression, then restore auth and assert exactly one recovery event with next-cycle dispatch resumption. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [TEST] Add shell regression for reconcile-only idempotence with snapshot invariants — in `scripts/tests/watchdog.sh`, assert reconcile-only mode dispatches nothing, preserves `fixing-*` rows exactly, emits one `failed_root_snapshot`, and performs no changes on a second identical pass. Mission: Criterion #2 quality gates and Criterion #3 convergent recovery.
- [x] [INFRA] Run one canonical stale-active root supersede sweep for true-open convergence — in `scripts/watchdog.sh` reconciliation, supersede `status=blocked|pending` rows in `.dev/failed-tasks.md` whose normalized root is already present in `.dev/completed.md`, preserve `fixing-*` rows byte-for-byte, and emit deterministic before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [INFRA] Centralize failed-task markdown field codec into shared shell helpers — in `scripts/_config.sh`, add canonical encode/decode helpers for task/error/branch table fields (`|`, backticks, and escaped newlines) and migrate both `scripts/task-fixer.sh` and `scripts/watchdog.sh` to use only those helpers. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability. _(typecheck failed)_
- [x] [FIX] Close blocked config parity root for watchdog/one-shot knobs — align `templates/skynet.config.sh` and `packages/cli/src/commands/config.ts` so `SKYNET_WATCHDOG_INTERVAL`, `SKYNET_ONE_SHOT`, and `SKYNET_ONE_SHOT_TASK` defaults/descriptions stay synchronized and verified by tests. Mission: Criterion #1 discoverability and Criterion #3 deterministic config behavior.
- [x] [FIX] Unblock Codex large-prompt reliability root with stdin-first invariants — in `scripts/agents/codex.sh` and shell tests, enforce prompt-via-stdin path, preserve child exit codes, and keep >300KB prompt regression coverage passing. Mission: Criterion #6 multi-agent compatibility and Criterion #2 self-correction closure.
- [x] [NMI] Publish canonical diagnostics only for truly remaining active roots after cleanup — if any `status=blocked|pending` roots remain, capture latest exact `pnpm typecheck` diagnostics from `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, then keep one canonical follow-up per unresolved root. Mission: Criterion #2 self-correction closure and Criterion #4 operator trust. _(typecheck failed)_
- [x] [INFRA] Run one canonical stale-active supersede sweep for blocked/pending rows already fixed — in `scripts/watchdog.sh` reconciliation, supersede any `status=blocked|pending` rows in `.dev/failed-tasks.md` whose normalized root maps to `.dev/completed.md`, preserving all `fixing-*` rows byte-for-byte and emitting before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [INFRA] Canonicalize active failed roots to one row per normalized root in watchdog — extend reconciliation in `scripts/watchdog.sh` to keep exactly one active row per normalized root (`pending|blocked|fixing-*`), supersede duplicate variants, and emit deterministic per-root reconciliation metrics/events. Mission: Criterion #2 throughput and Criterion #3 deterministic state.
- [x] [TEST] Re-open CLI operational E2E smoke coverage as one canonical root — in `tests/e2e/cli-commands.test.sh`, add deterministic checks for `skynet stop`, `pause/resume`, `completions bash`, and `validate`, ensuring no worker-count hardcoding regressions and `pnpm typecheck` stays green. Mission: Criterion #2 quality gates and Criterion #1 safe adoption. _(typecheck failed)_
- [x] [DATA] Surface failed-root convergence metrics in CLI `status --json` — in `packages/cli/src/commands/status.ts`, add `activeRoots`, `duplicateActiveRows`, and `blockedRoots` using the same normalized-root parser semantics as dashboard/watchdog. Mission: Criterion #4 full visibility and Criterion #5 measurable progress.
- [x] [INFRA] Add failed-task history rotation guardrail to bound fixer context size — in `scripts/watchdog.sh`, archive older `fixed|superseded` rows from `.dev/failed-tasks.md` into `.dev/failed-tasks-archive.md` after a configurable cap while preserving active row ordering. Mission: Criterion #2 retry-loop throughput and Criterion #3 deterministic state management. _(typecheck failed)_
