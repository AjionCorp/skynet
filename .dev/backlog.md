# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->
- [x] [INFRA] Add watchdog guardrail to suppress no-op blockers rewrites when active-root hash is unchanged — skip `.dev/blockers.md` Active rewrites and emit a deterministic `blockers_sync_skipped` event when canonical active-root hash has not changed, reducing state churn between cycles. Mission: Criterion #3 deterministic state and Criterion #4 operational clarity.
- [x] [TEST] Add watchdog regression for no-op blockers sync guardrail semantics — in `scripts/tests/watchdog.sh`, assert unchanged active-root hash emits exactly one `blockers_sync_skipped` event, does not rewrite `.dev/blockers.md`, and preserves Active/Resolved/Celebration content byte-for-byte. Mission: Criterion #2 quality gates and Criterion #4 operational trust.
- [>] [INFRA] Run one canonical stale-active root supersede sweep for current blocked/pending drift — in `scripts/watchdog.sh`, reconcile `.dev/failed-tasks.md` so stale `status=blocked|pending` rows that map to `.dev/completed.md` are superseded in one pass (without touching `fixing-*` rows), and emit deterministic before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [DATA] Refresh `.dev/blockers.md` Active from post-reconciliation canonical failed roots — rebuild Active entries from current `.dev/failed-tasks.md` so exactly one bullet remains per true open root and stale duplicate-root bullets are removed while preserving Celebration/Resolved sections. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [>] [INFRA] Add agent-auth preflight gate before watchdog dispatch to avoid dead cycles when credentials expire — in `scripts/watchdog.sh` plus shared auth helpers (`scripts/auth-check.sh`/`scripts/_agent.sh`), detect unauthenticated Claude/Codex sessions before dispatch, emit one throttled `agent_auth_required` event, and skip new claims until auth is restored. Mission: Criterion #2 self-correction continuity and Criterion #3 no-task-loss reliability.
- [ ] [TEST] Add shell regression for auth-expiry dispatch suppression and recovery — in watchdog tests, simulate failed auth checks and assert no new claims/dispatches occur, then restore auth and assert dispatch resumes in the next cycle with a single recovery event. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.

# Recent checked history (last 30)
- [x] [INFRA] Add duplicate-active-root pressure alerting in watchdog with throttle guard — when `duplicate_active_rows > 0` across consecutive cycles, emit a single throttled high-severity event/notification with current root counts and cooldown handling. Mission: Criterion #2 self-correction closure and Criterion #4 operational awareness.
- [x] [DATA] Surface failed-root hash parity in dashboard pipeline-status output — in `packages/dashboard/src/handlers/pipeline-status.ts` (and response types), include `activeRootHash`, `blockersActiveHash`, and `hashMatch` using the same normalized-root hashing semantics as watchdog parity checks. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress. _(typecheck failed)_
- [x] [DATA] Run one canonical reconcile-only convergence sweep and refresh state files — execute watchdog reconcile-only mode to collapse stale active duplicates, then rebuild `.dev/blockers.md` Active from canonical failed roots so parity converges; commit only state-file updates. Mission: Criterion #2 self-correction closure and Criterion #5 measurable progress.
- [x] [INFRA] Add watchdog hash-drift pressure alerting with throttle guard — when failed-root parity reports `hash_match=false` for consecutive cycles, emit one throttled high-severity event with both hashes and root counters, then suppress repeats until cooldown or convergence. Mission: Criterion #2 self-correction throughput and Criterion #4 operational awareness. _(typecheck failed)_
- [x] [INFRA] Add stale-claimed backlog recovery sweep tied to live lock/worktree state — in `scripts/watchdog.sh`, detect `[>]` rows with no corresponding active lock/heartbeat/worktree and atomically demote them back to `[ ]` to prevent permanent claimed starvation. Mission: Criterion #3 no-task-loss guarantees and Criterion #2 throughput.
- [x] [FIX] Restore project-driver backlog ordering convergence when checked rows appear above claims — in `scripts/project-driver.sh`, make the rewrite/sanitizer path rebuild from extracted marker rows so `[x]` can never persist above `[>]`, while preserving claimed lines byte-for-byte. Mission: Criterion #3 deterministic planning and Criterion #2 loop reliability.
- [x] [TEST] Add regression fixture for backlog ordering recovery with misplaced checked rows — in `scripts/tests/project-driver.sh`, feed a backlog where `[x]` rows precede claimed rows and assert output ordering is exactly `[>]` then `[ ]` then `[x]` with claimed lines unchanged. Mission: Criterion #2 quality gates and Criterion #3 deterministic behavior.
- [x] [INFRA] Add watchdog `reconcile-only` cycle mode for failed-task convergence and blockers sync — in `scripts/watchdog.sh`, add a one-shot path that runs reconciliation/supersede + blockers refresh + snapshot emission without dispatching workers/fixers, logging deterministic before/after counters. Mission: Criterion #2 self-correction throughput and Criterion #4 trustworthy visibility.
- [x] [TEST] Add shell regression for watchdog reconcile-only mode idempotence — assert reconcile-only performs zero dispatches, preserves active `fixing-*` rows, emits one `failed_root_snapshot`, and is no-op on second run with identical input. Mission: Criterion #2 quality gates and Criterion #3 convergent recovery. _(typecheck failed)_
- [x] [DATA] Surface failed-root hash parity in CLI `status --json` from canonical files — extend `packages/cli/src/commands/status.ts` to include `activeRootHash`, `blockersActiveHash`, and `hashMatch` using the same normalized-root hashing as watchdog parity checks. Mission: Criterion #4 full visibility and Criterion #5 measurable progress.
- [x] [TEST] Add CLI status JSON regression for failed-root hash parity fields — in `packages/cli/src/commands/__tests__/status.test.ts`, assert `activeRootHash`, `blockersActiveHash`, and `hashMatch` are stable for matching vs drifting fixtures. Mission: Criterion #2 quality gates and Criterion #4 telemetry trust.
- [x] [INFRA] Enforce per-cycle failed-task reconciliation before any fixer dispatch path — in `scripts/watchdog.sh`, guarantee reconciliation/supersede runs in normal and one-shot cycles before fixer launch, and emit one deterministic before/after active-root counter log each cycle. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [FIX] Make failed-task markdown row writes pipe-safe across writers — in `scripts/task-fixer.sh` and any shared failed-task write helpers, escape or encode literal `|` in task/error/branch fields so `.dev/failed-tasks.md` remains parse-stable and row corruption cannot create phantom duplicates. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop reliability.
- [x] [TEST] Add shell regression for failed-task table serialization/parsing invariants — add tests covering rows with embedded `|`, long error strings, and repeated retries; assert canonical parser still counts `pending|blocked|fixing-*` correctly and reconciliation supersedes duplicates deterministically. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [NMI] Publish canonical diagnostics only for truly remaining active roots after cleanup — if any `status=blocked|pending` roots remain, capture latest exact `pnpm typecheck` diagnostics from `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, keep one canonical follow-up task per root, and supersede duplicate variants. Mission: Criterion #2 self-correction closure and Criterion #4 trustworthy telemetry. _(typecheck failed)_
- [x] [TEST] Add watchdog regression for reconciliation-before-fixer ordering in both normal and one-shot cycles — in `scripts/tests/watchdog.sh`, assert the reconcile/supersede pass runs before every fixer dispatch decision and logs exactly one deterministic before/after active-root counter pair per cycle. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [INFRA] Centralize failed-task markdown escaping/unescaping into shared helpers and migrate all writers/parsers — add shared shell helpers in `scripts/_config.sh` (or sourced helper) so `task-fixer.sh` and `watchdog.sh` use one canonical encode/decode path for `|`, backticks, and newlines in table fields. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability.
- [x] [TEST] Add regression coverage for shared failed-task field codec round-trip invariants — feed adversarial task/error strings (embedded `|`, escaped pipes, markdown punctuation, multi-space) through the shared codec and assert parse-stable round-trips plus unchanged active-root counting semantics. Mission: Criterion #2 quality gates and Criterion #3 convergent parsing. _(typecheck failed)_
- [x] [TEST] Add watchdog regression coverage for stale blocked-root supersede with duplicates — in shell tests for `scripts/watchdog.sh`, feed fixtures containing duplicate `blocked|pending` rows for roots already in `.dev/completed.md` and assert exactly one canonical active row remains, unaffected `fixing-*` rows are preserved, and ordering is deterministic. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [INFRA] Run one canonical stale-active supersede sweep for failed-task roots already merged to `main` — in `scripts/watchdog.sh` reconciliation, ensure `_auto_supersede_completed_tasks()` demotes stale `status=blocked|pending` rows when normalized titles match `.dev/completed.md`, preserve any `fixing-*` rows, and emit `task_superseded` per transition. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [DATA] Refresh `.dev/blockers.md` Active from reconciled failed-root reality — rebuild Active entries from current `.dev/failed-tasks.md` after cleanup so there is exactly one bullet per true open root, remove stale duplicate-root bullets, and keep Celebration/Resolved sections intact. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add project-driver regression for backlog ordering sanitizer — feed mixed-order backlog fixtures and assert claimed rows are preserved verbatim at top, unchecked rows remain intact, and checked history is only moved downward. Mission: Criterion #2 quality gates and Criterion #3 deterministic behavior.
- [x] [INFRA] Auto-supersede stale `blocked` failed-task rows already closed by canonical completed roots — in `scripts/watchdog.sh`, extend `_auto_supersede_completed_tasks()` to evaluate `status=blocked` alongside `pending`, preserve active `fixing-*` rows, and emit `task_superseded` per transitioned row. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [TEST] Add watchdog regression for blocked-row supersede guardrails — in shell tests for `scripts/watchdog.sh`, assert completed-root supersede touches only stale `blocked|pending` rows, never rewrites `fixing-*` rows, and preserves unaffected active-row ordering. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(claude failed)_
- [x] [INFRA] Refresh `.dev/blockers.md` Active automatically after failed-task reconciliation — in `scripts/watchdog.sh`, add one canonical rebuild step that keeps exactly one Active bullet per active failed root and removes stale duplicate-root bullets without mutating Celebration/Resolved sections. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add project-driver regression for active blocked-root suppression — in `scripts/project-driver.sh` tests, verify generation skips unchecked tasks whose normalized title matches any active `status=blocked` root from `.dev/failed-tasks.md`, with one skip log per root per cycle. Mission: Criterion #2 quality gates and Criterion #3 convergent planning.
- [x] [INFRA] Add backlog checked-history rotation guardrail to keep project-driver context bounded — in `scripts/project-driver.sh`, move older `[x]` backlog rows beyond a fixed cap to `.dev/backlog-archive.md` while preserving all unchecked/claimed rows order. Mission: Criterion #2 planning throughput and Criterion #3 deterministic state management.
- [x] [TEST] Add project-driver regression for backlog history rotation invariants — in shell tests for `scripts/project-driver.sh`, verify rotation never reorders or rewrites leading claimed `[>]` rows and never removes unchecked `[ ]` tasks while archiving only older `[x]` history entries. Mission: Criterion #2 quality gates and Criterion #3 deterministic planning behavior.
- [x] [INFRA] Add failed-task history rotation guardrail to keep fixer context bounded — in `scripts/watchdog.sh`, move older `fixed|superseded` rows beyond a cap from `.dev/failed-tasks.md` to `.dev/failed-tasks-archive.md` while preserving active `pending|fixing-*|blocked` rows order. Mission: Criterion #2 retry-loop throughput and Criterion #3 deterministic state management. _(typecheck failed)_
- [x] [INFRA] Enforce canonical backlog ordering in project-driver post-generation sanitizer — in `scripts/project-driver.sh`, normalize output so all `[>]` rows stay first, followed by `[ ]` rows, with all `[x]` rows strictly in bottom history; preserve claimed lines byte-for-byte. Mission: Criterion #2 planning reliability and Criterion #3 convergent state.
- [x] [INFRA] Add a watchdog guard to auto-supersede stale `pending` rows already completed by canonical root — in `scripts/watchdog.sh`, compare normalized failed-task roots to `.dev/completed.md` and mark stale retries `superseded` in one pass without touching active fixer rows. Mission: Criterion #2 loop efficiency and Criterion #3 wasted-cycle elimination.
- [x] [TEST] Add shell regression for failed-task write-path dedupe under retry churn — in watchdog/task-fixer shell tests, simulate repeated retries on the same normalized title+branch and assert no duplicate active `pending` rows are appended. Mission: Criterion #2 quality gates and Criterion #3 clean state.
- [x] [INFRA] Harden project-driver generation filter against retry-root duplication — in `scripts/project-driver.sh`, reject new unchecked tasks whose normalized title matches any active failed-task root (including `fixing-*`), log each skip, and keep unchecked backlog count <= 15. Mission: Criterion #3 convergent planning and Criterion #2 retry-loop stability.
- [x] [INFRA] Collapse canonical duplicate `pending` retry rows for the CLI helper DRY root — in `scripts/watchdog.sh` reconciliation, when multiple `pending` rows normalize to `close blocked cli helper dry root for readfile isprocessrunning`, keep one canonical active row, mark the rest `superseded`, and emit per-row `task_superseded` events without modifying active `fixing-*` rows. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [DATA] Refresh blocker state from canonical failed-root reality after reconciliation — regenerate `.dev/blockers.md` Active from `.dev/failed-tasks.md` after the dedupe/supersede sweep, keeping exactly one bullet per active root and removing stale duplicates for the CLI helper DRY root. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress. _(typecheck failed)_
- [x] [TEST] Add watchdog regression for stale-completed supersede guard against active fixer rows — in shell tests, verify `_auto_supersede_completed_tasks` marks only stale `pending` rows as `superseded` while preserving `fixing-*` rows for the same normalized root. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [TEST] Add project-driver regression for `fixing-*` retry-root suppression — in `scripts/project-driver.sh` tests, assert new tasks are skipped when normalized titles match active roots in `pending|fixing-*|blocked`, and that skipped roots are logged once per cycle. Mission: Criterion #3 convergent planning and Criterion #2 retry-loop stability.
- [x] [DATA] Surface failed-root convergence snapshot in CLI status JSON — in `packages/cli/src/commands/status.ts`, include `activeRoots`, `duplicateActiveRows`, and `blockedRoots` in `--json` output using the same parsing rules as dashboard pipeline-status. Mission: Criterion #4 full visibility and Criterion #5 measurable mission progress. _(typecheck failed)_
- [x] [TEST] Add CLI status JSON regression coverage for failed-root convergence fields — in `packages/cli/src/commands/__tests__/status.test.ts`, assert `--json` includes `activeRoots`, `duplicateActiveRows`, and `blockedRoots`, and that values match controlled `.dev/failed-tasks.md` fixtures. Mission: Criterion #2 quality gates and Criterion #4 trustworthy telemetry.
- [x] [INFRA] Emit canonical failed-root convergence snapshot event each watchdog cycle — in `scripts/watchdog.sh`, after reconciliation emit one structured `failed_root_snapshot` event with `active_roots`, `duplicate_active_rows`, and `blocked_roots` counts for longitudinal observability. Mission: Criterion #4 real-time visibility and Criterion #5 measurable progress.
- [x] [TEST] Add shell regression for watchdog convergence snapshot event shape — in shell tests for `scripts/watchdog.sh`, verify `failed_root_snapshot` emits once per cycle with expected counters and that preserved `fixing-*` rows do not inflate duplicate counts. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [FIX] Close canonical CLI helper DRY retry root with lock-compat parity — in `packages/cli/src/utils/readFile.ts`, `packages/cli/src/utils/isProcessRunning.ts`, and dependent CLI commands, resolve remaining retry drift and ensure `pnpm typecheck` passes without behavior changes for dir-lock and file-lock paths. Mission: Criterion #3 maintainability/reliability and Criterion #2 retry-loop closure.
- [x] [DATA] Surface failed-root convergence snapshot in CLI `status --json` from canonical parser output — include `activeRoots`, `duplicateActiveRows`, and `blockedRoots` in `packages/cli/src/commands/status.ts` using the same counting semantics as dashboard pipeline status. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable mission progress.
- [x] [TEST] Add regression coverage for CLI failed-root convergence JSON fields under mixed states — in `packages/cli/src/commands/__tests__/status.test.ts`, assert `activeRoots`, `duplicateActiveRows`, and `blockedRoots` remain correct for fixtures containing `pending|fixing-*|blocked|superseded` rows. Mission: Criterion #2 quality gates and Criterion #4 telemetry consistency.
- [x] [INFRA] Run one canonical failed-task convergence sweep and enforce steady-state invariants — in `scripts/watchdog.sh`, add/verify a single idempotent pass that keeps exactly one active row (`pending|fixing-*|blocked`) per normalized root in `.dev/failed-tasks.md`, supersedes duplicate variants, and emits before/after counters. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [FIX] Close canonical CLI helper DRY root for `readFile`/`isProcessRunning` without behavior drift — in `packages/cli/src/utils/readFile.ts` and `packages/cli/src/utils/isProcessRunning.ts`, finalize shared helpers, migrate remaining command imports (`doctor.ts`, `status.ts`, `watch.ts`, `start.ts`, `metrics.ts`, `cleanup.ts`), and keep dir-lock/file-lock parity. Mission: Criterion #3 maintainability and Criterion #1 reliability.
- [x] [TEST] Add lock-compat regression coverage for CLI helper DRY root — extend CLI command tests to prove shared `isProcessRunning` handles both directory locks and file locks identically to prior behavior, and that `readFile` fallback semantics remain unchanged. Mission: Criterion #2 quality gates and Criterion #3 deterministic behavior.
- [x] [NMI] Refresh `.dev/blockers.md` Active from current failed-root reality — rebuild Active blockers from `.dev/failed-tasks.md` rows with `status=blocked` or high-attempt pending roots, attach exact latest diagnostics from `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, and remove resolved stale root bullets. Mission: Criterion #2 self-correction closure and Criterion #4 trustworthy visibility.
- [x] [NMI] Resolve blocked-root state drift between `.dev/backlog.md` and `.dev/failed-tasks.md` — add a watchdog reconciliation pass that supersedes stale blocked/pending duplicates for already-fixed roots and emits before/after root counts, without touching active `fixing-*` rows. Mission: Criterion #2 retry-loop stability and Criterion #3 state convergence.
- [x] [NMI] Publish canonical blocked-root repro matrix from latest logs — regenerate `.dev/blockers.md` Active from `status=blocked` rows in `.dev/failed-tasks.md` using current `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log` `pnpm typecheck` diagnostics, with exactly one canonical row per root and explicit pass conditions. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state. _(typecheck failed)_
