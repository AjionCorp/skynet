# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [x] [INFRA] Supersede stale `blocked|pending` rows when a `fixing-*` row already owns the same normalized root — in `scripts/watchdog.sh` reconciliation, when canonical precedence selects a `fixing-*` active row for a root, mark lower-priority active variants (`blocked|pending`) as `superseded` in the same pass and emit deterministic counters (`superseded_by_fixing_root`, `active_roots_after`). Mission: Criterion #2 retry-loop throughput and Criterion #3 one-root-one-active-row convergence.
- [ ] [TEST] Add watchdog regression for fixing-root supersede behavior — in `scripts/tests/watchdog.sh`, add fixtures where the same normalized root appears as `fixing-*` plus `blocked|pending` rows and assert only the `fixing-*` row remains active, superseded rows preserve table validity/order, and second identical run is a no-op. Mission: Criterion #2 quality gates and Criterion #3 deterministic reconciliation.
- [x] [DATA] Surface parse-guard and fixing-root supersede counters in status JSON — extend `packages/dashboard/src/handlers/pipeline-status.ts` and `packages/cli/src/commands/status.ts` (`--json`) to include watchdog reconciliation counters (`parseGuardRows`, `supersededByFixingRoot`, `activeRowsBefore`, `activeRowsAfter`) so operators can verify convergence behavior from one status call. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.

- [ ] [INFRA] Enforce unchecked backlog hard-cap and canonical ordering in project-driver writes — in `scripts/project-driver.sh`, after task generation and before write, deterministically keep all claimed `[>]` rows first, then pending `[ ]`, trim lowest-priority pending rows beyond 15 unchecked total, and preserve checked history rows without mutation. Mission: Criterion #3 deterministic planning state and Criterion #2 no-task-loss reliability.
- [ ] [TEST] Add project-driver regression for unchecked-cap + ordering invariants — in `scripts/tests/project-driver.sh`, fixture backlog with mixed `[>]`, `[ ]`, and misplaced `[x]` rows; assert claimed rows remain byte-identical and first, pending rows are capped at 15, checked history is moved to the bottom, and second identical run is no-op. Mission: Criterion #2 quality gates and Criterion #3 convergent planning behavior.
- [ ] [DATA] Surface watchdog canonicalization-precedence counters in status JSON — extend `packages/dashboard/src/handlers/pipeline-status.ts` and `packages/cli/src/commands/status.ts` (`--json`) to include `canonicalizationPrecedenceApplied` alongside existing reconciliation counters so operators can verify one-root-one-active-row convergence from a single status call. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [ ] [TEST] Add cross-surface parity regression for precedence counters — add/extend tests in `scripts/tests/watchdog.sh`, `packages/dashboard/src/handlers/pipeline-status.test.ts`, and CLI status JSON tests to assert `canonicalizationPrecedenceApplied` semantics match watchdog emissions and remain stable across two identical reconciliation passes. Mission: Criterion #2 quality gates and Criterion #4 telemetry trust.

# Recent checked history (last 30)
- [x] [INFRA] Auto-supersede stale `blocked` failed-task rows that match completed roots — in `scripts/watchdog.sh` reconciliation, extend completed-match supersede logic to `status=blocked` (not only pending variants), preserve `fixing-*` rows, and emit deterministic counters for `blocked_rows_superseded`. Mission: Criterion #2 retry-loop reduction and Criterion #3 convergent state.
- [x] [INFRA] Centralize failed-task markdown field codec into shared shell helpers — in `scripts/_config.sh`, add canonical encode/decode helpers for failed-task table fields (embedded pipes/backticks/newlines) and migrate `scripts/task-fixer.sh` plus `scripts/watchdog.sh` writers/parsers to one codec path. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability.
- [x] [DATA] Surface `driver_low_fix_rate_mode` counters in status JSON outputs — extend `packages/dashboard/src/handlers/pipeline-status.ts` and `packages/cli/src/commands/status.ts` to include deterministic low-fix-rate counters (`activated`, `reasonFixRate`, `reasonRetryPressure`, `cappedNewTasks`) sourced from project-driver telemetry so operators can verify pressure behavior. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [INFRA] Emit canonical project-driver telemetry snapshot per cycle — in `scripts/project-driver.sh`, write `.dev/project-driver-telemetry.json` atomically with deterministic fields (`ts`, `pendingBacklog`, `claimedBacklog`, `pendingRetries`, `fixRate`, `duplicateSkipped`, `maxNewTasks`, `driver_low_fix_rate_mode`) so downstream status surfaces can read one stable source of truth. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add shell regression for project-driver telemetry snapshot determinism — in `scripts/tests/project-driver.sh`, assert telemetry JSON is valid, keys are stable, counters match fixture inputs, and identical inputs cause byte-identical output (or an explicit no-rewrite path) across two runs. Mission: Criterion #2 quality gates and Criterion #3 deterministic planning behavior. _(typecheck failed)_
- [x] [INFRA] Publish watchdog stale-active supersede skip diagnostics with throttle guards — in `scripts/watchdog.sh` reconciliation, emit deterministic reason codes/counts for rows not superseded (`status_fixing`, `no_completed_match`, `parse_guard`, `already_canonical`) plus bounded row samples so active-state drift can be triaged without log spam. Mission: Criterion #2 self-correction closure and Criterion #4 operational awareness.
- [x] [TEST] Add cross-script regression for shared failed-root normalization parity — extend `scripts/tests/project-driver.sh` and `scripts/tests/watchdog.sh` with the same adversarial title fixtures to prove canonical helpers produce identical normalized roots in dedupe and supersede flows. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(claude failed)_
- [x] [INFRA] Compact duplicate non-active failed history rows before archive rotation — in `scripts/watchdog.sh`, collapse repeated `fixed|superseded` rows with the same normalized root+branch into one canonical history row before moving rows to `.dev/failed-tasks-archive.md`, preserving the newest attempts/error context and emitting deterministic `history_rows_compacted` metrics. Mission: Criterion #2 retry-loop throughput and Criterion #3 state convergence.
- [x] [TEST] Add regression for failed-task history compaction invariants — in `scripts/tests/watchdog.sh`, assert compaction never touches active rows, preserves markdown table validity, is idempotent across two runs, and keeps archive parity checks stable. Mission: Criterion #2 quality gates and Criterion #3 deterministic state management. _(typecheck failed)_
- [x] [TEST] Add project-driver regression for active-root duplicate suppression counters — in `scripts/tests/project-driver.sh`, assert generation skips unchecked candidates when normalized roots are already active in `.dev/failed-tasks.md`, never skips unrelated roots, and emits deterministic `driver_duplicate_root_skipped` totals. Mission: Criterion #2 quality gates and Criterion #3 convergent planning.
- [x] [DATA] Refresh blockers Active from canonical failed roots after stale-active supersede — in `scripts/watchdog.sh` blockers sync path, rebuild `.dev/blockers.md` Active from normalized active failed roots only after the convergence pass and skip file rewrite when active-root hash is unchanged. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add cross-surface parity regression for stale-active counters and root-hash fields — add/extend tests in `scripts/tests/watchdog.sh`, `packages/dashboard/src/handlers/pipeline-status.test.ts`, and CLI status tests to prove `staleActiveCompletedRows`, `supersededActiveRows`, and root-hash parity fields match semantics across watchdog, dashboard, and `status --json`. Mission: Criterion #2 quality gates and Criterion #4 telemetry trust.
- [x] [INFRA] Enforce active-root canonical row precedence (`fixing-*` > `blocked` > `pending`) in watchdog reconciliation — in `scripts/watchdog.sh`, when multiple active rows share a normalized root, deterministically keep the highest-priority status row (then latest row index tie-break), supersede lower-priority variants, and emit `canonicalization_precedence_applied` counters. Mission: Criterion #2 self-correction throughput and Criterion #3 deterministic recovery. _(typecheck failed)_
- [x] [TEST] Add watchdog regression for active-root precedence and tie-break determinism — in `scripts/tests/watchdog.sh`, include fixtures where the same normalized root appears as `fixing-*`, `blocked`, and `pending`; assert canonical row selection follows precedence, unaffected rows are byte-identical, and second identical run is no-op. Mission: Criterion #2 quality gates and Criterion #3 convergent state.
- [x] [INFRA] Close stale-active failed-root drift in one deterministic watchdog sweep — in `scripts/watchdog.sh`, run a canonical active-root convergence pass that supersedes only `status=blocked|pending` rows whose normalized root is already present in `.dev/completed.md`, preserves `fixing-*` rows byte-for-byte, and emits before/after counters plus one stable root-hash summary. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [INFRA] Prevent project-driver from generating retry variants for active failed roots — in `scripts/project-driver.sh`, normalize unchecked candidate titles against active `pending|blocked|fixing-*` roots in `.dev/failed-tasks.md`, skip generation when a canonical root is already active, and log deterministic `driver_duplicate_root_skipped` counters. Mission: Criterion #2 retry-loop reduction and Criterion #3 durable root-cause planning.
- [x] [DATA] Surface stale-active convergence counters in status surfaces — add `staleActiveCompletedRows` and `supersededActiveRows` from watchdog reconciliation to `packages/dashboard/src/handlers/pipeline-status.ts` and CLI `status --json` output, keeping field semantics aligned. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [TEST] Add watchdog regression for deterministic stale-active sweep evidence — in `scripts/tests/watchdog.sh`, add a fixture with mixed `blocked|pending|fixing-*` rows where only completed-root stale active rows are superseded, unaffected rows remain byte-identical, and emitted counters/hash summary are stable across two identical runs. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(typecheck failed)_
- [x] [TEST] Add watchdog regression for stale blocked/pending supersede guardrails — in `scripts/tests/watchdog.sh`, assert completed-root supersede touches only stale `blocked|pending` rows, never rewrites `fixing-*` rows, and preserves unaffected active-row ordering byte-for-byte. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(typecheck failed)_
