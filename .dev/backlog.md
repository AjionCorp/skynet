# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [ ] [INFRA] Run canonical stale-active failed-root supersede before both fixer dispatch and project-driver generation — in `scripts/watchdog.sh` and `scripts/project-driver.sh`, share one normalized-root active snapshot path that supersedes stale `status=blocked|pending` rows already present in `.dev/completed.md`, preserves `fixing-*` rows byte-for-byte, and emits deterministic before/after counters once per cycle. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [ ] [NMI] Publish canonical diagnostics only for truly remaining blocked roots after stale-active supersede — from latest `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, capture exact `pnpm typecheck` diagnostics and keep exactly one follow-up root per unresolved blocker while superseding duplicate variants. Mission: Criterion #2 self-correction closure and Criterion #4 trustworthy telemetry.
- [ ] [TEST] Add watchdog regression for blocked-row supersede guardrails — in `scripts/tests/watchdog.sh`, assert completed-root supersede touches only stale `blocked|pending` rows, never rewrites `fixing-*` rows, and preserves unaffected active-row ordering. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [ ] [TEST] Add project-driver regression to suppress task generation for stale-active completed roots — in `scripts/tests/project-driver.sh`, verify unchecked generation skips roots detected as stale-active (present as `blocked|pending` in failed-tasks but already completed) until watchdog supersedes them. Mission: Criterion #2 quality gates and Criterion #3 convergent planning.
- [ ] [DATA] Refresh `.dev/blockers.md` Active from canonical failed-root state after convergence tasks land — rebuild Active entries from current `.dev/failed-tasks.md` so exactly one bullet remains per true open root and stale duplicate-root bullets are removed while preserving Celebration/Resolved sections. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable mission progress.
- [ ] [DATA] Surface failed-root convergence snapshot in CLI status JSON — in `packages/cli/src/commands/status.ts`, include `activeRoots`, `duplicateActiveRows`, and `blockedRoots` in `--json` output using the same parsing rules as dashboard pipeline-status. Mission: Criterion #4 full visibility and Criterion #5 measurable mission progress.
- [ ] [INFRA] Add failed-task history rotation guardrail to keep fixer context bounded — in `scripts/watchdog.sh`, move older `fixed|superseded` rows beyond a cap from `.dev/failed-tasks.md` to `.dev/failed-tasks-archive.md` while preserving active `pending|fixing-*|blocked` rows order. Mission: Criterion #2 retry-loop throughput and Criterion #3 deterministic state management.
- [ ] [TEST] Add regression coverage for shared failed-task field codec round-trip invariants — feed adversarial task/error strings (embedded `|`, escaped pipes, markdown punctuation, multi-space) through the shared codec and assert parse-stable round-trips plus unchanged active-root counting semantics. Mission: Criterion #2 quality gates and Criterion #3 convergent parsing.

# Recent checked history (last 30)
- [x] [INFRA] Enforce canonical backlog marker ordering before each dispatch cycle — in `scripts/watchdog.sh` (or shared `_config.sh` helper), run a pre-cycle sanitizer that guarantees all `[>]` rows stay first, `[ ]` rows follow, and any misplaced top-level `[x]` rows are moved into checked history without rewriting claimed lines byte-for-byte. Mission: Criterion #3 deterministic planning state and Criterion #2 no-task-loss reliability.
- [x] [INFRA] Add agent-auth preflight gate before watchdog dispatch to avoid dead cycles when credentials expire — in `scripts/watchdog.sh` plus shared auth helpers (`scripts/auth-check.sh`/`scripts/_agent.sh`), detect unauthenticated Claude/Codex sessions before dispatch, emit one throttled `agent_auth_required` event, and skip new claims until auth is restored. Mission: Criterion #2 self-correction continuity and Criterion #3 no-task-loss reliability.
- [x] [TEST] Add shell regression for auth-expiry dispatch suppression and recovery — in watchdog tests, simulate failed auth checks and assert no new claims/dispatches occur, then restore auth and assert dispatch resumes in the next cycle with a single recovery event. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery. _(typecheck failed)_
- [x] [INFRA] Add watchdog guardrail to suppress no-op blockers rewrites when active-root hash is unchanged — skip `.dev/blockers.md` Active rewrites and emit a deterministic `blockers_sync_skipped` event when canonical active-root hash has not changed, reducing state churn between cycles. Mission: Criterion #3 deterministic state and Criterion #4 operational clarity.
- [x] [TEST] Add watchdog regression for no-op blockers sync guardrail semantics — in `scripts/tests/watchdog.sh`, assert unchanged active-root hash emits exactly one `blockers_sync_skipped` event, does not rewrite `.dev/blockers.md`, and preserves Active/Resolved/Celebration content byte-for-byte. Mission: Criterion #2 quality gates and Criterion #4 operational trust.
- [x] [INFRA] Run one canonical stale-active root supersede sweep for current blocked/pending drift — in `scripts/watchdog.sh`, reconcile `.dev/failed-tasks.md` so stale `status=blocked|pending` rows that map to `.dev/completed.md` are superseded in one pass (without touching `fixing-*` rows), and emit deterministic before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [DATA] Refresh `.dev/blockers.md` Active from post-reconciliation canonical failed roots — rebuild Active entries from current `.dev/failed-tasks.md` so exactly one bullet remains per true open root and stale duplicate-root bullets are removed while preserving Celebration/Resolved sections. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [x] [INFRA] Add duplicate-active-root pressure alerting in watchdog with throttle guard — when `duplicate_active_rows > 0` across consecutive cycles, emit a single throttled high-severity event/notification with current root counts and cooldown handling. Mission: Criterion #2 self-correction closure and Criterion #4 operational awareness.
- [x] [DATA] Surface failed-root hash parity in dashboard pipeline-status output — in `packages/dashboard/src/handlers/pipeline-status.ts` (and response types), include `activeRootHash`, `blockersActiveHash`, and `hashMatch` using the same normalized-root hashing semantics as watchdog parity checks. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress. _(typecheck failed)_
- [x] [DATA] Run one canonical reconcile-only convergence sweep and refresh state files — execute watchdog reconcile-only mode to collapse stale active duplicates, then rebuild `.dev/blockers.md` Active from canonical failed roots so parity converges; commit only state-file updates. Mission: Criterion #2 self-correction closure and Criterion #5 measurable progress.
- [x] [INFRA] Add watchdog hash-drift pressure alerting with throttle guard — when failed-root parity reports `hash_match=false` for consecutive cycles, emit one throttled high-severity event with both hashes and root counters, then suppress repeats until cooldown or convergence. Mission: Criterion #2 self-correction throughput and Criterion #4 operational awareness. _(typecheck failed)_
- [x] [INFRA] Add stale-claimed backlog recovery sweep tied to live lock/worktree state — in `scripts/watchdog.sh`, detect `[>]` rows with no corresponding active lock/heartbeat/worktree and atomically demote them back to `[ ]` to prevent permanent claimed starvation. Mission: Criterion #3 no-task-loss guarantees and Criterion #2 throughput.
- [x] [FIX] Restore project-driver backlog ordering convergence when checked rows appear above claims — in `scripts/project-driver.sh`, make the rewrite/sanitizer path rebuild from extracted marker rows so `[x]` can never persist above `[>]`, while preserving claimed lines byte-for-byte. Mission: Criterion #3 deterministic planning and Criterion #2 loop reliability.
- [x] [TEST] Add regression fixture for backlog ordering recovery with misplaced checked rows — in `scripts/tests/project-driver.sh`, feed a backlog where `[x]` rows precede claimed rows and assert output ordering is exactly `[>]` then `[ ]` then `[x]` with claimed lines unchanged. Mission: Criterion #2 quality gates and Criterion #3 deterministic behavior.
- [x] [INFRA] Add watchdog `reconcile-only` cycle mode for failed-task convergence and blockers sync — in `scripts/watchdog.sh`, add a one-shot path that runs reconciliation/supersede + blockers refresh + snapshot emission without dispatching workers/fixers, logging deterministic before/after counters. Mission: Criterion #2 self-correction throughput and Criterion #4 trustworthy visibility.
- [x] [TEST] Add shell regression for watchdog reconcile-only mode idempotence — assert reconcile-only performs zero dispatches, preserves active `fixing-*` rows, emits one `failed_root_snapshot`, and is no-op on second run with identical input. Mission: Criterion #2 quality gates and Criterion #3 convergent recovery. _(typecheck failed)_
- [x] [DATA] Surface failed-root hash parity in CLI `status --json` from canonical files — extend `packages/cli/src/commands/status.ts` to include `activeRootHash`, `blockersActiveHash`, and `hashMatch` using the same normalized-root hashing as watchdog parity checks. Mission: Criterion #4 full visibility and Criterion #5 measurable progress.
- [x] [TEST] Add CLI status JSON regression for failed-root hash parity fields — in `packages/cli/src/commands/__tests__/status.test.ts`, assert `activeRootHash`, `blockersActiveHash`, and `hashMatch` are stable for matching vs drifting fixtures. Mission: Criterion #2 quality gates and Criterion #4 telemetry trust.
- [x] [INFRA] Enforce per-cycle failed-task reconciliation before any fixer dispatch path — in `scripts/watchdog.sh`, guarantee reconciliation/supersede runs in normal and one-shot cycles before fixer launch, and emit one deterministic before/after active-root counter log each cycle. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [x] [FIX] Make failed-task markdown row writes pipe-safe across writers — in `scripts/task-fixer.sh` and any shared failed-task write helpers, escape or encode literal `|` in task/error/branch fields so `.dev/failed-tasks.md` remains parse-stable and row corruption cannot create phantom duplicates. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop reliability.
- [x] [TEST] Add shell regression for failed-task table serialization/parsing invariants — add tests covering rows with embedded `|`, long error strings, and repeated retries; assert canonical parser still counts `pending|blocked|fixing-*` correctly and reconciliation supersedes duplicates deterministically. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
