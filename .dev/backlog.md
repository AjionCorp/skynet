# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [x] [FEAT] Add mission progress tracking to pipeline-status handler — FRESH implementation (previous branch stale). In `packages/dashboard/src/handlers/pipeline-status.ts`, add a `parseMissionProgress()` function that reads `.dev/mission.md`, extracts the numbered success criteria under `## Success Criteria`, and evaluates each against current state: read completed.md task count, failed-tasks.md fix rate, check for zombie/deadlock references in watchdog logs, check dashboard handler count, check if agent plugins exist. Return as `missionProgress: { id: number, criterion: string, status: 'met'|'partial'|'not-met', evidence: string }[]` in the pipeline-status response. Add `MissionProgress` interface to `packages/dashboard/src/types.ts`. Also update `packages/cli/src/commands/status.ts` to display mission progress summary
- [x] [FEAT] Add mission viewer page to admin dashboard — FRESH implementation (previous branch stale). Create `packages/admin/src/app/admin/mission/page.tsx` that imports a new `MissionDashboard` component from `@ajioncorp/skynet/components`. Create `packages/dashboard/src/components/MissionDashboard.tsx` — fetches pipeline status, renders the raw mission.md content as styled markdown (use a `<pre>` or simple renderer), and below it shows a progress table with green/yellow/red status badges per success criterion from `missionProgress`. Add `MissionDashboard` export to `packages/dashboard/src/components/index.ts`. Add navigation entry in `packages/admin/src/app/admin/layout.tsx`: `{ href: "/admin/mission", label: "Mission", icon: Target }` (import Target from lucide-react). Create API route `packages/admin/src/app/api/admin/mission/route.ts` that reads and returns raw `.dev/mission.md` content _(merge failed)_
- [x] [FIX] Fix watchdog crash_recovery and dispatch hardcoded worker IDs — FRESH implementation (previous branch `dev/fix-watchdog-hardcoded-worker-ids-breaki` has merge conflict — delete it). In `scripts/watchdog.sh`: (1) In `crash_recovery()`, replace `for wid in 1 2` at lines ~115 and ~137 with `for wid in $(seq 1 "${SKYNET_MAX_WORKERS:-2}")`. (2) In Phase 3 orphan worktree cleanup (~line 157), replace the hardcoded `worktree_dirs` array with a dynamic loop building paths for each worker. (3) Replace the hardcoded `w1_running`/`w2_running` variables (~lines 254-262, 350-352) with a dynamic loop checking all workers up to SKYNET_MAX_WORKERS. (4) In the dispatch section, dynamically find idle worker slots instead of only w1/w2. Also verify `validate_backlog()` in `scripts/_config.sh` uses the same dynamic pattern _(merge failed)_
- [x] [FIX] Add merge conflict detection and fresh-branch retry to task-fixer — in `scripts/task-fixer.sh`, before attempting to fix a failed task on its existing branch, check if the branch can merge cleanly into main: run `git merge-tree $(git merge-base main "$BRANCH") main "$BRANCH"` and grep for conflict markers. If conflicts are detected, log "Branch $BRANCH has merge conflicts — creating fresh branch", delete the old branch (`git branch -D "$BRANCH"`), and create a new branch from main instead of checking out the stale one. This prevents the fixer from wasting cycles on unmergeable branches and dramatically improves self-correction success rate for tasks that failed after main has diverged
- [x] [DOCS] Add repository README.md with quickstart and architecture — create `README.md` at repo root. Sections: (1) **What is Skynet** — one paragraph: autonomous AI dev pipeline, LLM agents build/test/ship/self-correct. (2) **Quickstart** — `npm install -g @ajioncorp/skynet-cli && skynet init && skynet setup-agents && skynet start`. (3) **How It Works** — describe the loop: project-driver generates tasks, workers claim and implement, quality gates validate, task-fixer retries failures, watchdog monitors health. (4) **CLI Reference** — table of all 12 commands: init, setup-agents, start, stop, status, doctor, logs, version, add-task, reset-task, dashboard, cleanup. (5) **Dashboard** — describe admin UI, mention `skynet dashboard` command. (6) **Configuration** — key skynet.config.sh variables. (7) **Architecture** — packages/cli, packages/dashboard, packages/admin, scripts/. Keep concise, under 200 lines
- [x] [FIX] Fix lint:sh glob to include scripts/notify/*.sh — in root `package.json`, update the `lint:sh` script from `"shellcheck -S warning scripts/*.sh scripts/agents/*.sh"` to `"shellcheck -S warning scripts/*.sh scripts/agents/*.sh scripts/notify/*.sh"`. The 3 notification channel plugins (telegram.sh, slack.sh, discord.sh) are currently not shellchecked, meaning syntax errors or unsafe patterns could slip into the notification system undetected
- [x] [FEAT] Add Linux cron support to monitoring agents dashboard handler — FRESH implementation (previous branch has merge conflict). In `packages/dashboard/src/handlers/monitoring-agents.ts`, add OS detection via `process.platform`. On `linux`, parse `crontab -l` output for entries between `# BEGIN skynet` / `# END skynet` markers (matching the format written by `packages/cli/src/commands/setup-agents.ts`). Map cron expressions to human-readable intervals (e.g., `*/3 * * * *` -> "Every 3 minutes"). Return the same `AgentInfo[]` response shape. On `darwin`, keep existing `launchctl` logic unchanged. Add a helper `parseCronSchedule(expr: string): { intervalSeconds: number, human: string }`
- [x] [INFRA] Extend watchdog stale branch cleanup to handle fixed and superseded tasks — the existing `_cleanup_stale_branches()` in `scripts/watchdog.sh` (~line 357) only handles entries with `status=blocked`. Extend it to also delete branches for entries with `status=fixed` (task was retried and merged to main) or `status=superseded` (functionality re-implemented via a different task). Currently there are 16 stale dev/* branches — after this change, the next watchdog run should clean up ~11 of them (those that are fixed/superseded), leaving only branches for actively-worked or pending-retry tasks _(merge failed)_
- [x] [INFRA] Wire e2e CLI smoke test into CI workflow — in `.github/workflows/ci.yml`, add a new job `e2e-cli` alongside existing typecheck, unit-test, lint-sh jobs. Steps: checkout, setup Node 20, install pnpm, `pnpm install`, `pnpm --filter @ajioncorp/skynet-cli build` (compile CLI TypeScript), then `bash tests/e2e/init-smoke.test.sh`. This validates that `npx skynet init` scaffolding works correctly on every PR, catching regressions in the CLI path resolution and template copying logic
- [x] [TEST] Add worker-scaling handler unit tests — create `packages/dashboard/src/handlers/worker-scaling.test.ts`. Test cases: (1) GET returns current worker counts by type with correct `WorkerScaleInfo[]` shape, (2) POST scale-up returns correct `WorkerScaleResult`, (3) POST scale-down cleans PID files, (4) max worker limit enforced (returns 400 if count exceeds `maxCount`), (5) invalid worker type returns 400, (6) scale to same count is a no-op, (7) handles missing PID files gracefully, (8) concurrent scale requests don't corrupt state. Mock `child_process.spawn` and `fs` operations. Follow patterns from existing tests in `packages/dashboard/src/handlers/*.test.ts`
- [>] [TEST] Add Playwright e2e tests for admin dashboard core flows — create `packages/admin/e2e/dashboard.spec.ts` and `packages/admin/playwright.config.ts`. Configure Playwright with `webServer` pointing to `pnpm dev` on port 3100. Test cases: (1) pipeline page loads and shows health badge, (2) tasks page loads and displays pending/claimed/done counts, (3) monitoring page shows agent status, (4) sidebar navigation works between all tabs, (5) worker scaling controls render with +/- buttons, (6) mission page loads after mission viewer is built. Add `"test:e2e": "playwright test"` to `packages/admin/package.json`
- [>] [FEAT] Add `skynet cleanup` CLI command for branch and worktree maintenance — create `packages/cli/src/commands/cleanup.ts`. List all local `dev/*` branches with their status: merged (in main), orphaned (no matching backlog/failed entry), active (has worktree or matching `[>]` claim). Default `--dry-run` mode shows what would be deleted. With `--force`, delete merged/orphaned branches via `git branch -D`, prune worktrees via `git worktree prune`. Show summary: "Deleted N branches, pruned M worktrees, K branches preserved (active)". Register in `packages/cli/src/index.ts`
- [x] [FIX] Inject previous failure context into task-fixer retry prompts — in scripts/task-fixer.sh, when building the Claude Code prompt for a retry, read the last 100 lines of the failed branch's worker log (`$SCRIPTS_DIR/dev-worker-*.log`) and include the error output in the prompt under a "## Previous Failure" section. Also include the git diff of what was changed on the failed branch (`git diff main...$BRANCH`). This gives Claude maximum context to fix the issue on retry, directly improving the self-correction success rate
- [x] [FIX] Fix watchdog hardcoded worker IDs breaking scaling beyond 2 workers _(merge failed — superseded by fresh task above)_
- [x] [FIX] Fix task-fixer reading only dev-worker-1.log regardless of which worker failed — in scripts/task-fixer.sh, the retry prompt context reads `tail -100 "$SCRIPTS_DIR/dev-worker-1.log"` hardcoded. When a task fails on worker 2, the fixer gets irrelevant log context, reducing fix success rate. Fix: parse the failed-tasks.md entry to determine which worker originally ran the task (match branch name against current-task-N.md files or check the log files for the task title), then read the correct worker's log
- [x] [FEAT] Add `skynet logs` CLI command — create packages/cli/src/commands/logs.ts. Accept subcommand for log type: `skynet logs worker [--id N]` (reads .dev/scripts/dev-worker-N.log), `skynet logs fixer`, `skynet logs watchdog`, `skynet logs health-check`. Support `--tail N` (default 50 lines) and `--follow` (uses `fs.watch` + readline to stream new lines). If no subcommand given, list available log files with their sizes and last-modified times. Register in packages/cli/src/index.ts
- [x] [FEAT] Add `skynet add-task` CLI command — create packages/cli/src/commands/add-task.ts. Usage: `skynet add-task "Task title" --tag FEAT --description "details" --position top`. Read .dev/backlog.md, find the insertion point (after the header comments, before first `[x]` entry for position=top, or before the `[x]` block for position=bottom). Write the new line as `- [ ] [TAG] Title — description`. Use atomic write (write to .tmp then rename). Register in packages/cli/src/index.ts
- [x] [FEAT] Add notification channel plugin system — refactor scripts/_notify.sh to support pluggable channels. Create scripts/notify/ directory with telegram.sh (move existing tg() function), slack.sh (POST to SKYNET_SLACK_WEBHOOK_URL with JSON payload), and discord.sh (POST to SKYNET_DISCORD_WEBHOOK_URL). Update _notify.sh to source all scripts/notify/*.sh files. Add SKYNET_NOTIFY_CHANNELS="telegram" to skynet.config.sh (comma-separated list). Update the `tg()` wrapper to call all enabled channels
- [x] [FEAT] Add pipeline health score to dashboard and `skynet status` — create a `calculate_health_score()` function. Formula: start at 100, subtract 5 per pending failed task, subtract 10 per active blocker, subtract 2 per stale heartbeat, subtract 1 per task pending >24h. Clamp to 0-100. Add to packages/dashboard/src/handlers/pipeline-status.ts response as `healthScore: number`. Display as a colored badge in PipelineDashboard component (green >80, yellow >50, red <=50). Also output in packages/cli/src/commands/status.ts
- [x] [FEAT] Add `skynet dashboard` CLI command to launch admin app — create packages/cli/src/commands/dashboard.ts. Resolve admin package path relative to skynet root (same pattern as init.ts). Run `pnpm --filter admin dev -- --port <PORT>` via child_process.spawn with stdio inherit. Default port 3100 (configurable via --port flag). Open browser automatically via `open` (macOS) or `xdg-open` (Linux). Register in packages/cli/src/index.ts
- [x] [INFRA] Add `npx skynet init` end-to-end smoke test — create tests/e2e/init-smoke.test.sh
- [x] [FEAT] Add multi-project PID isolation validation _(merge failed — superseded by stale branch cleanup)_
- [x] [INFRA] Delete stale dev branches and prune worktrees _(merge failed — superseded by fresh cleanup task above)_
- [x] [FEAT] Add `skynet reset-task` CLI command — packages/cli/src/commands/reset-task.ts
- [x] [FEAT] Add worker activity log rotation — in scripts/dev-worker.sh and task-fixer.sh
- [x] [TEST] Add vitest unit tests for dashboard health score and task parsing — packages/dashboard/src/handlers/pipeline-status.health.test.ts
- [x] [FEAT] Add `skynet version` CLI command with update check — packages/cli/src/commands/version.ts
- [x] [FIX] Fix CLI scripts path resolution for npm package distribution
- [x] [FIX] Add PID lock to health-check.sh to prevent concurrent instances
- [x] [FIX] Harden task-fixer.sh EXIT trap for mid-merge crash safety
- [x] [FEAT] Add `skynet doctor` CLI diagnostics command — packages/cli/src/commands/doctor.ts
- [x] [FEAT] Add `skynet add-task` CLI command for backlog injection _(merge failed — recreated and completed above)_
- [x] [FEAT] Add worker port offset to prevent dev-server conflicts in multi-worker mode
- [x] [FEAT] Add Linux cron support to monitoring agents dashboard _(merge failed — superseded by fresh task above)_
- [x] [FEAT] Add dynamic worker scaling from admin dashboard
- [x] [FEAT] Add backlog health validation to watchdog
- [x] [FEAT] Add task duration tracking to completed.md
- [x] [INFRA] Add root `test` script and CI unit test job
- [x] [FEAT] Add automatic stale branch cleanup for abandoned failed tasks _(merge failed — superseded by fresh cleanup task above)_
- [x] [FEAT] Add configurable quality gates via skynet.config.sh
- [x] [FEAT] Add `skynet status` CLI command
- [x] [FEAT] we need to be able to see in admin for pipeline and monitoring who is active _(superseded by admin improvements)_
- [x] [NMI] Lets have an ability to add more workers to different areas from the admin dynamically _(superseded by dynamic worker scaling)_
- [x] [FEAT] Lets improve Pipeline and Monitoring for admin
- [x] [FEAT] Add worker heartbeat and stale detection
- [x] [FEAT] Add agent plugin system for LLM-agnostic workers
- [x] [INFRA] Add shellcheck linting for all shell scripts
- [x] [TEST] Add integration test for full pipeline task lifecycle _(claude failed — superseded)_
- [x] [FEAT] Add `skynet logs` CLI command _(claude failed — recreated and completed above)_
- [x] [TEST] Add Playwright tests for all dashboard component interactions _(claude failed — superseded by fresh task above)_
- [x] [INFRA] Add more tags and add tooltip to them _(claude failed)_
- [x] [FEAT] Add task dependency tracking
- [x] [FEAT] Add real-time pipeline dashboard via Server-Sent Events
- [x] [FEAT] Add crash recovery to watchdog
- [x] [FEAT] Add `skynet start` and `skynet stop` CLI commands
- [x] [INFRA] Add npm package build and publish workflow
- [x] [FEAT] Add self-correction metrics tracking _(being fixed by task-fixer)_
- [x] [TEST] Add unit tests for shell script lock acquisition and task claiming _(being fixed by task-fixer)_
- [x] [TEST] Add TypeScript tests for API handlers _(being fixed by task-fixer)_
- [x] [FEAT] Add mission progress tracking to project-driver _(superseded by fresh task above)_
- [x] [FEAT] Add mission.md viewer tab to admin dashboard _(superseded by fresh task above)_
- [x] [INFRA] Add CI/CD workflow _(superseded — CI exists in .github/workflows/ci.yml)_
- [x] [FEAT] Add webhook notification support _(superseded by notification channel plugin system)_
- [x] [INFRA] Add cron support alongside launchd
