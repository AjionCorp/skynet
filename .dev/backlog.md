# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [x] [TEST] Add shell regression for auth-gate dispatch suppression lifecycle — in `scripts/tests/watchdog.sh`, simulate failed agent auth checks to assert dispatch suppression, then restore auth and assert exactly one recovery event with next-cycle dispatch resumption. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [ ] [TEST] Add shell regression for reconcile-only idempotence with snapshot invariants — in `scripts/tests/watchdog.sh`, assert reconcile-only mode dispatches nothing, preserves `fixing-*` rows exactly, emits one `failed_root_snapshot`, and performs no changes on a second identical pass. Mission: Criterion #2 quality gates and Criterion #3 convergent recovery.

- [x] [INFRA] Run one canonical stale-active root supersede sweep for true-open convergence — in `scripts/watchdog.sh` reconciliation, supersede `status=blocked|pending` rows in `.dev/failed-tasks.md` whose normalized root is already present in `.dev/completed.md`, preserve `fixing-*` rows byte-for-byte, and emit deterministic before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [INFRA] Centralize failed-task markdown field codec into shared shell helpers — in `scripts/_config.sh`, add canonical encode/decode helpers for task/error/branch table fields (`|`, backticks, and escaped newlines) and migrate both `scripts/task-fixer.sh` and `scripts/watchdog.sh` to use only those helpers. Mission: Criterion #3 deterministic state and Criterion #2 retry-loop stability. _(typecheck failed)_
- [ ] [TEST] Add regression coverage for shared failed-task field codec round-trip invariants — in shell tests for failed-task parsing/writes, feed adversarial strings (embedded `|`, escaped pipes, markdown punctuation, multi-space/newline variants) through the shared codec and assert parse-stable round trips plus unchanged active-root counting semantics. Mission: Criterion #2 quality gates and Criterion #3 convergent parsing.
- [ ] [DATA] Emit canonical `failed_root_snapshot` parity payload after each reconciliation cycle — in `scripts/watchdog.sh`, emit active-root hash and counters from canonical normalized roots and include a deterministic `hash_match` comparison against `.dev/blockers.md` Active root hash. Mission: Criterion #4 trustworthy visibility and Criterion #5 measurable progress.
- [ ] [TEST] Add watchdog shell regression for hash-drift alert throttling lifecycle — in `scripts/tests/watchdog.sh`, simulate repeated `hash_match=false` cycles and assert one high-severity alert per cooldown window, then verify alerting re-arms after convergence. Mission: Criterion #2 quality gates and Criterion #4 trustworthy operations.

# Recent checked history (last 30)
- [x] [FIX] Close blocked config parity root for watchdog/one-shot knobs — align `templates/skynet.config.sh` and `packages/cli/src/commands/config.ts` so `SKYNET_WATCHDOG_INTERVAL`, `SKYNET_ONE_SHOT`, and `SKYNET_ONE_SHOT_TASK` defaults/descriptions stay synchronized and verified by tests. Mission: Criterion #1 discoverability and Criterion #3 deterministic config behavior.
- [x] [FIX] Unblock Codex large-prompt reliability root with stdin-first invariants — in `scripts/agents/codex.sh` and shell tests, enforce prompt-via-stdin path, preserve child exit codes, and keep >300KB prompt regression coverage passing. Mission: Criterion #6 multi-agent compatibility and Criterion #2 self-correction closure.
- [x] [NMI] Publish canonical diagnostics only for truly remaining active roots after cleanup — if any `status=blocked|pending` roots remain, capture latest exact `pnpm typecheck` diagnostics from `.dev/scripts/dev-worker-*.log` and `.dev/scripts/task-fixer-*.log`, then keep one canonical follow-up per unresolved root. Mission: Criterion #2 self-correction closure and Criterion #4 operator trust. _(typecheck failed)_
- [x] [INFRA] Run one canonical stale-active supersede sweep for blocked/pending rows already fixed — in `scripts/watchdog.sh` reconciliation, supersede any `status=blocked|pending` rows in `.dev/failed-tasks.md` whose normalized root maps to `.dev/completed.md`, preserving all `fixing-*` rows byte-for-byte and emitting before/after root counters. Mission: Criterion #2 self-correction closure and Criterion #3 convergent state.
- [x] [INFRA] Canonicalize active failed roots to one row per normalized root in watchdog — extend reconciliation in `scripts/watchdog.sh` to keep exactly one active row per normalized root (`pending|blocked|fixing-*`), supersede duplicate variants, and emit deterministic per-root reconciliation metrics/events. Mission: Criterion #2 throughput and Criterion #3 deterministic state.
- [x] [TEST] Re-open CLI operational E2E smoke coverage as one canonical root — in `tests/e2e/cli-commands.test.sh`, add deterministic checks for `skynet stop`, `pause/resume`, `completions bash`, and `validate`, ensuring no worker-count hardcoding regressions and `pnpm typecheck` stays green. Mission: Criterion #2 quality gates and Criterion #1 safe adoption. _(typecheck failed)_
- [x] [DATA] Surface failed-root convergence metrics in CLI `status --json` — in `packages/cli/src/commands/status.ts`, add `activeRoots`, `duplicateActiveRows`, and `blockedRoots` using the same normalized-root parser semantics as dashboard/watchdog. Mission: Criterion #4 full visibility and Criterion #5 measurable progress.
- [x] [INFRA] Add failed-task history rotation guardrail to bound fixer context size — in `scripts/watchdog.sh`, archive older `fixed|superseded` rows from `.dev/failed-tasks.md` into `.dev/failed-tasks-archive.md` after a configurable cap while preserving active row ordering. Mission: Criterion #2 retry-loop throughput and Criterion #3 deterministic state management. _(typecheck failed)_
