# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->
- [>] [FIX] Land canonical CLI helper DRY extraction for `readFile`/`isProcessRunning` — finalize shared utilities in `packages/cli/src/utils/`, migrate `doctor.ts`/`status.ts`/`watch.ts`/`start.ts`/`metrics.ts`/`cleanup.ts`, and add dir-lock plus file-lock compatibility tests. Mission: Criterion #3 maintainability and Criterion #1 reliability.
- [x] [INFRA] Enforce continuous failed-task root convergence beyond one-time sweep — in `scripts/watchdog.sh`, add per-cycle reconciliation metrics (`active_roots`, `duplicate_active_rows`, `superseded_rows`) and fail-safe supersede for redundant active variants, emitting structured `task_superseded` and reconciliation events. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state. _(typecheck failed)_
- [>] [TEST] Add regression coverage for failed-task convergence across `pending|fixing-*|blocked` states — extend shell tests for `scripts/watchdog.sh` and `scripts/task-fixer.sh` to prove duplicate active variants collapse to one canonical root and stale `fixing-*` rows return to `pending` when fixer lock is absent. Mission: Criterion #2 quality gates and Criterion #3 deterministic recovery.
- [x] [NMI] Reconcile blockers Active with current canonical roots after claimed sweeps complete — regenerate `.dev/blockers.md` Active from `.dev/failed-tasks.md` (`status=blocked`, `attempts>=3`), attach latest exact `pnpm typecheck` diagnostics, and remove stale root entries that are already fixed/superseded. Mission: Criterion #2 self-correction closure.
- [x] [INFRA] Run one deterministic failed-task compaction pass after active claims settle — add a one-shot helper in `scripts/watchdog.sh` (or sourced helper) to collapse duplicate `pending|superseded` rows by normalized root+branch in `.dev/failed-tasks.md`, keep one canonical active row, and emit before/after counters via `emit_event`. Mission: Criterion #2 self-correction throughput and Criterion #3 convergent state.
- [>] [FIX] Close blocked Codex prompt root with exact repro+guard test — use `.dev/blockers.md` repro to patch `scripts/agents/codex.sh` so stdin-first prompt delivery and child exit-code propagation are both preserved through `_agent_exec`, then add/update shell regression for >300KB prompt payloads and run `pnpm typecheck`. Mission: Criterion #6 multi-agent compatibility and Criterion #2 retry-loop closure.
- [>] [FIX] Close blocked config parity root for one-shot/watchdog knobs — align `templates/skynet.config.sh` and `packages/cli/src/commands/config.ts` so `SKYNET_WATCHDOG_INTERVAL`, `SKYNET_ONE_SHOT`, and `SKYNET_ONE_SHOT_TASK` defaults/descriptions match exactly, add/update config command coverage, and keep `pnpm typecheck` green. Mission: Criterion #1 adoption safety and Criterion #3 deterministic config behavior.
- [ ] [TEST] Close blocked CLI operational E2E root in one canonical test update — in `tests/e2e/cli-commands.test.sh`, stabilize assertions for `stop`, `pause/resume`, `completions bash`, and `validate` against current CLI output, then verify with `pnpm typecheck`. Mission: Criterion #2 quality gates and Criterion #1 safe adoption.
- [ ] [FIX] Close blocked pipeline-logs optimization root with response-shape parity — in `packages/dashboard/src/handlers/pipeline-logs.ts` and related tests, keep buffer-based newline counting while preserving exact empty-file and no-trailing-newline response behavior and passing `pnpm typecheck`. Mission: Criterion #3 runtime efficiency and Criterion #2 reliable gates.
- [ ] [FIX] Close blocked backlog-parser DRY root without parser behavior drift — centralize `extractTitle()` and `parseBlockedBy()` in `packages/dashboard/src/lib/backlog-parser.ts`, update `pipeline-status.ts` and `tasks.ts` imports, and add/adjust parity tests for blocked dependency parsing with `pnpm typecheck` green. Mission: Criterion #3 maintainability and Criterion #2 retry-loop reduction.
- [ ] [INFRA] Prevent future duplicate retry variants at source in project-driver output filtering — hard-fail generation of new unchecked tasks whose normalized title matches any active/blocked canonical root in `.dev/failed-tasks.md`, log skipped roots, and keep unchecked backlog capped under 15 in `scripts/project-driver.sh`. Mission: Criterion #3 convergent planning and Criterion #2 self-correction stability.

- [x] [FIX] Fix dashboard typecheck — 35 fetch mock type errors blocking all worker merges — `pnpm typecheck` fails with TS2741 ("Property 'preconnect' is missing") and TS2352 (fetch-to-Mock cast error) in 11 dashboard component test files: `ActivityFeed.test.tsx`, `EventsDashboard.test.tsx`, `LogViewer.test.tsx`, `MissionDashboard.test.tsx`, `MonitoringDashboard.test.tsx`, `PipelineDashboard.test.tsx`, `PromptsDashboard.test.tsx`, `SettingsDashboard.test.tsx`, `SyncDashboard.test.tsx`, `TasksDashboard.test.tsx`, `WorkerScaling.test.tsx`. All errors come from `global.fetch = vi.fn().mockResolvedValue(...)` where the mock lacks the `preconnect` property added in newer Node.js/undici types. Fix: in each test file's `mockFetchWith()` or `beforeEach` block, replace direct `global.fetch = vi.fn()...` assignment with `vi.stubGlobal('fetch', vi.fn().mockResolvedValue(...))` which bypasses the type check on assignment. For places that cast `global.fetch as Mock`, change to `vi.mocked(global.fetch)`. Also check `AdminLayout.test.tsx` and `SkynetProvider.test.tsx` for the same pattern. Run `pnpm typecheck` — must exit 0 with zero errors. Criterion #2 (typecheck is the quality gate — 0 errors required for any worker to merge)
- [x] [FIX] Fix `sed -n 'Ip'` GNU extension breaking `blockedBy` dependency parsing on macOS — in `scripts/dev-worker.sh` line 125, `sed -n 's/.*| *blockedBy: *\(.*\)$/\1/Ip'` uses the `I` (case-insensitive) flag which is a GNU sed extension NOT available in macOS BSD sed. On macOS (the primary target platform), `blocked_by` is always empty, meaning `is_task_blocked()` never detects blocked tasks — workers attempt blocked tasks immediately, wasting cycles and producing incorrect results. Same issue in `scripts/_config.sh` line 231 inside `validate_backlog()`. Fix: replace `sed -n 's/.*| *blockedBy: *\(.*\)$/\1/Ip'` with `sed -n 's/.*| *[bB]locked[bB]y: *\(.*\)$/\1/p'` (manual case alternation, portable across BSD and GNU sed). Apply to both files. Run `bash -n scripts/dev-worker.sh scripts/_config.sh` and `pnpm typecheck`. Criterion #1 (portability — macOS is the primary platform) and #3 (no wasted worker cycles on blocked tasks)
- [x] [FIX] Add backlog mutex lock to CLI `add-task` and `reset-task` commands to prevent data corruption — in `packages/cli/src/commands/add-task.ts` lines 46-89, `backlog.md` is read, modified, and written using atomic rename but WITHOUT acquiring the backlog mutex lock (`${SKYNET_LOCK_PREFIX}-backlog.lock`). Shell workers hold this lock during all backlog modifications. Concurrent `skynet add-task` and a worker claiming a task can corrupt `backlog.md` (lost writes). Same issue in `packages/cli/src/commands/reset-task.ts` which writes both `backlog.md` and `failed-tasks.md` without any lock at lines 124 and 140. Fix: (1) Create a shared `acquireBacklogLock(lockPath: string, retries?: number, intervalMs?: number): boolean` utility in `packages/cli/src/utils/backlogLock.ts`. (2) In `add-task.ts`, before reading backlog.md, acquire lock; release in a try/finally with `rmSync(lockPath, { recursive: true })`. (3) Apply same pattern to `reset-task.ts`. Derive lock path as `${lockPrefix}-backlog.lock` where lockPrefix comes from config. Run `pnpm typecheck`. Criterion #3 (data integrity — no backlog corruption under concurrent access)
- [x] [FIX] Add `files` field and `prepublishOnly` script to dashboard package.json for correct npm publish — `packages/dashboard/package.json` has no `files` field, meaning `npm publish` includes test files, TypeScript source, devDependencies' artifacts — shipping a bloated, incorrect package. Also missing `prepublishOnly` script, so local `npm publish` would publish stale or missing `dist/`. Fix: (1) Add `"files": ["dist", "README.md"]` to `packages/dashboard/package.json`. (2) Add `"prepublishOnly": "tsc"` to the `scripts` block. (3) Verify with `pnpm --filter @ajioncorp/skynet pack` that the tarball contains only `dist/` and `README.md`, no `.test.ts` files. Run `pnpm typecheck`. Criterion #1 (working npm package — external consumers must receive compiled JS, not source TypeScript) _(typecheck failed)_
- [x] [FIX] Add `git pull` before first merge attempt in dev-worker.sh and task-fixer.sh to reduce unnecessary conflicts — in `scripts/dev-worker.sh` lines 588-591, the first merge attempt goes directly to `git merge "$branch_name" --no-edit` without pulling the latest `main`. With 4 concurrent workers, `main` advances between branch creation and merge time. The `git pull` only happens in the rebase recovery path at line 597, meaning every concurrent merge conflicts first, then recovers — wasting 10-30 seconds per task. Fix: add `git pull origin "$SKYNET_MAIN_BRANCH" 2>>"$LOG" || true` between lines 588 and 590 (after `cd "$PROJECT_DIR"`, before the first `git merge`). Apply the same fix in `scripts/task-fixer.sh` before its merge attempt at line 445. Run `bash -n` on both files and `pnpm typecheck`. Criterion #3 (reliability — proactively prevent merge conflicts instead of recovering from them)
- [x] [FIX] Guard `skynet init` against re-run silently overwriting existing `skynet.config.sh` — in `packages/cli/src/commands/init.ts` line 179, `writeFileSync(join(devDir, "skynet.config.sh"), configContent)` unconditionally overwrites the config file. If a user accidentally re-runs `skynet init` in an already-initialized project, their customized config (port, notification tokens, agent settings) is silently destroyed. The `.md` state files are correctly guarded with `existsSync` checks, but the two shell config files are not. Fix: before writing `skynet.config.sh` (line 179) and `skynet.project.sh` (line 184), check `existsSync`. If the file exists AND `--force` is not set, print `"  Existing skynet.config.sh found — skipping (use --force to overwrite)"` and skip. Add `.option('--force', 'Overwrite existing config files')` to the init command options. Run `pnpm typecheck`. Criterion #1 (safe init — no accidental config destruction on re-run)
- [x] [FIX] Fix task POST handler to retry lock acquisition instead of immediate 423 failure — in `packages/dashboard/src/handlers/tasks.ts` lines 143-150, lock acquisition uses a single `mkdirSync(backlogLockPath)` with zero retry. If a shell worker holds the lock (even for 100ms during a claim), the dashboard API immediately returns HTTP 423 to the user. Shell scripts retry 50 times at 100ms intervals (5 seconds total). Fix: wrap the `mkdirSync` in an async retry loop: try up to 30 times with 100ms delay between attempts (`await new Promise(r => setTimeout(r, 100))`). If all retries fail, return 423 as before. Run `pnpm typecheck`. Criterion #4 (dashboard operations must actually work — adding tasks from the UI should not fail during normal pipeline activity) _(typecheck failed)_
- [x] [FIX] Fix dashboard typecheck — 35 fetch mock type errors blocking all worker merges — `pnpm typecheck` fails with TS2741 ("Property 'preconnect' is missing") and TS2352 (fetch-to-Mock cast error) in 13 dashboard component test files: `ActivityFeed.test.tsx`, `EventsDashboard.test.tsx`, `LogViewer.test.tsx`, `MissionDashboard.test.tsx`, `MonitoringDashboard.test.tsx`, `PipelineDashboard.test.tsx`, `PromptsDashboard.test.tsx`, `SettingsDashboard.test.tsx`, `SyncDashboard.test.tsx`, `TasksDashboard.test.tsx`, `WorkerScaling.test.tsx`. All errors come from `global.fetch = vi.fn().mockResolvedValue(...)` where the mock lacks the `preconnect` property added in newer Node.js/undici types. Fix: in each test file's `mockFetchWith()` or `beforeEach` block, replace direct `global.fetch = vi.fn()...` assignment with `vi.stubGlobal('fetch', vi.fn().mockResolvedValue(...))` which bypasses the type check on assignment. For places that cast `global.fetch as Mock`, change to `vi.mocked(global.fetch)`. Run `pnpm typecheck` — must exit cleanly. Criterion #2 (typecheck is the quality gate — 0 errors required for any worker to merge) _(typecheck failed)_
- [x] [FIX] Add `worker` field to `EventEntry` interface and display in dashboard — in `packages/dashboard/src/types.ts` line 257, `EventEntry` only has `ts`, `event`, `detail`. But `scripts/_events.sh` emits `{"ts":"ISO","event":"type","worker":N,"detail":"text"}` — the `worker` field is silently dropped during deserialization. Fix: (1) add `worker?: number;` to `EventEntry` interface. (2) In `packages/dashboard/src/handlers/events.ts`, include `worker` when parsing event JSON lines. (3) In `packages/dashboard/src/components/ActivityFeed.tsx`, show "W{N}" badge next to each event when worker is present. (4) In `packages/dashboard/src/components/EventsDashboard.tsx`, add Worker column to the events table. Run `pnpm typecheck`. Criterion #4 (complete event visibility — know which worker performed each action)
- [x] [FIX] Add `validate`, `changelog`, and `--from-snapshot` to completions.ts — in `packages/cli/src/commands/completions.ts`, the `COMMANDS` object (lines 1-25) is missing 2 registered commands and 1 flag: (1) Add `validate: ["--dir", "--help"]` to COMMANDS. (2) Add `changelog: ["--since", "--output", "--dir", "--help"]` to COMMANDS. (3) Add `"--from-snapshot"` to the `init` flags array (currently only has `--name`, `--dir`, `--copy-scripts`, `--non-interactive`). (4) In the zsh `commands` array (lines 90-114), add `'validate:Run pre-flight project validation checks'` and `'changelog:Generate changelog from completed tasks'`. Run `pnpm typecheck`. Criterion #1 (complete tab completion — all 25 commands discoverable)
- [x] [DOCS] Update README.md with missing CLI commands, dashboard components, and config vars — the main `README.md` CLI Reference table is missing 3 commands: add rows for `validate` ("Run pre-flight project validation checks"), `changelog` ("Generate changelog from completed tasks"), and `test-notify` ("Test notification channel configuration"). The Dashboard Components table is missing 5 newer components: add `ActivityFeed`, `EventsDashboard`, `LogViewer`, `SettingsDashboard`, `MissionDashboard`. The Configuration table is missing 4 config vars: add `SKYNET_WATCHDOG_INTERVAL` (180), `SKYNET_MAX_FIXERS` (3), `SKYNET_DRIVER_BACKLOG_THRESHOLD` (5), `SKYNET_AGENT_TIMEOUT_MINUTES` (45). Run `pnpm typecheck`. Criterion #1 (accurate documentation for adopters)
- [x] [FIX] Add `SKYNET_ONE_SHOT` and `SKYNET_ONE_SHOT_TASK` to config.ts KNOWN_VARS — `SKYNET_ONE_SHOT` is used in 5+ places in `scripts/watchdog.sh` and 9+ places in `scripts/dev-worker.sh` as a single-task mode flag. `SKYNET_ONE_SHOT_TASK` is used in `dev-worker.sh` and `packages/cli/src/commands/run.ts` line 65. Neither appears in the `KNOWN_VARS` dictionary in `packages/cli/src/commands/config.ts`, making `skynet config list` show blank descriptions. Fix: add `SKYNET_ONE_SHOT: "Set to 1 for single-task mode — worker exits after completing one task"` and `SKYNET_ONE_SHOT_TASK: "Task description for single-task mode (set automatically by skynet run)"` to the KNOWN_VARS object. Run `pnpm typecheck`. Criterion #1 (accurate developer tooling — all config vars described)
- [x] [FIX] Improve watchdog auto-supersede to catch stale failed-tasks with title variations — in `scripts/watchdog.sh`, the `_auto_supersede_completed_tasks()` function uses exact title matching between `failed-tasks.md` and `completed.md`. When a task is completed via a "FRESH implementation" with a slightly different title, the original failed entry stays `pending` and the task-fixer wastes cycles retrying it. Fix: normalize both titles before comparison — strip tags (`[FIX]`, `[FEAT]`, etc.), strip "FRESH implementation" suffix, lowercase, collapse whitespace, and compare the first 50 characters. If a failed task's normalized title matches any completed task, supersede it. Currently 5 stale entries match this pattern. Run `pnpm typecheck`. Criterion #3 (no wasted fixer cycles on already-completed work) _(typecheck failed)_
- [x] [INFRA] Add `pnpm install --frozen-lockfile` to worker flow before typecheck — in `scripts/dev-worker.sh`, the quality gate section runs `pnpm typecheck` but does NOT run `pnpm install` first. When the pnpm lockfile has been updated (e.g., new dependency added) but the worktree's `node_modules` is stale, typecheck fails with "Cannot find module" errors. This caused 5 recent task failures (all "typecheck failed" with TS2307 for vitest). Fix: in `dev-worker.sh`, before the first quality gate evaluation, add `pnpm install --frozen-lockfile >> "$LOG" 2>&1` to ensure dependencies are fresh. Only run if `pnpm-lock.yaml` has changed since last install (check mtime of `node_modules/.modules.yaml` vs `pnpm-lock.yaml`). Run `pnpm typecheck`. Criterion #3 (reliable quality gates — dependencies must be installed before typecheck)
- [x] [FIX] Extract duplicate `isProcessRunning` and `readFile` utilities to shared CLI module — `isProcessRunning()` is copy-pasted in 4 CLI files (`doctor.ts`, `status.ts`, `watch.ts`, `start.ts`) with minor signature variation. `readFile()` (a 3-line try/catch wrapper around `readFileSync`) is copy-pasted in 5 CLI files (`doctor.ts`, `status.ts`, `watch.ts`, `metrics.ts`, `cleanup.ts`). Fix: (1) Create `packages/cli/src/utils/readFile.ts` exporting `readFile(path: string): string` that returns empty string on error. (2) Create `packages/cli/src/utils/isProcessRunning.ts` exporting `isProcessRunning(lockPath: string): { running: boolean; pid: string }` supporting both dir-based and file-based locks. (3) Update all 9 files to import from the shared utils and delete their local copies. This follows the same DRY pattern used for `loadConfig.ts` (which eliminated 19 duplicates). Run `pnpm typecheck`. Criterion #3 (maintainable code — DRY principle) _(typecheck failed)_
- [x] [FIX] Fix CI `lint-sh` job missing pnpm setup causing every shell lint run to fail — in `.github/workflows/ci.yml` lines 36-43, the `lint-sh` job installs shellcheck but does NOT install pnpm via `pnpm/action-setup@v4` or set up Node. The final step `pnpm lint:sh` fails with "pnpm: command not found" on every CI run. Every other job in the workflow correctly includes the pnpm/action-setup and actions/setup-node steps. Fix: add `- uses: pnpm/action-setup@v4` and `- uses: actions/setup-node@v4` with `node-version: 20` and `cache: pnpm` steps, plus `- run: pnpm install --frozen-lockfile` before the `pnpm lint:sh` step, matching the pattern in the `typecheck` job (lines 14-20). Alternatively, since `lint:sh` just runs shellcheck directly, replace `pnpm lint:sh` with the raw shellcheck command: `shellcheck -S warning scripts/*.sh scripts/agents/*.sh scripts/notify/*.sh`. Run `pnpm typecheck`. Criterion #2 (CI must actually work — broken lint job means shell script quality is ungated)
- [x] [FIX] Fix worker-scaling handler using `unlinkSync` on directory-based lock files — in `packages/dashboard/src/handlers/worker-scaling.ts` line 238, `unlinkSync(instance.lockFile)` attempts to delete the lock as a file, but all workers now use mkdir-based locks where `lockFile` is a directory containing a `pid` file. `unlinkSync` throws `EISDIR` on directories, which is silently swallowed by the catch block at line 239. Scale-down operations never clean up lock directories, leaving stale locks that cause `skynet doctor`, `status`, and `stop` to report phantom running workers. Fix: change line 238 from `unlinkSync(instance.lockFile)` to `rmSync(instance.lockFile, { recursive: true, force: true })`. Import `rmSync` from `fs` if not already imported. This matches the pattern already used correctly in `packages/cli/src/commands/stop.ts` line 42. Run `pnpm typecheck`. Criterion #3 (reliable scale-down — no stale locks) and Criterion #4 (dashboard operations must actually work)
- [x] [FIX] Fix `skynet logs` column header using unsupported printf format specifiers — in `packages/cli/src/commands/logs.ts` line 50, `console.log("    %-30s  %8s  %s", "File", "Size", "Modified")` uses C-style printf format specifiers that Node.js `console.log` does NOT interpret. The actual output is the raw format string followed by the arguments: `    %-30s  %8s  %s File Size Modified`. The data rows below use manual `.padEnd(30)` and `.padStart(8)` (lines 59-60), making the header misaligned with the data. Fix: replace line 50 with explicit padding matching the data rows: `console.log(\`    ${"File".padEnd(30)}  ${"Size".padStart(8)}  Modified\`)`. Run `pnpm typecheck`. Criterion #1 (CLI output must be correct — users see this every time they run `skynet logs`)
- [x] [FIX] Read CLI version from package.json instead of hardcoding "0.1.0" — in `packages/cli/src/index.ts` line 34, `.version("0.1.0")` is hardcoded. When `package.json` version is bumped for a release, `skynet --version` (Commander's built-in flag) will show the stale "0.1.0" instead of the actual version. The separate `version.ts` command reads from package.json correctly, but the Commander `.version()` registration does not. Fix: at the top of `index.ts`, import `createRequire` from `"module"`, then `const require = createRequire(import.meta.url); const pkg = require("../package.json");` and change `.version("0.1.0")` to `.version(pkg.version)`. This is the same pattern used by the `version.ts` command. Run `pnpm typecheck`. Criterion #1 (accurate CLI — version must match published package)
- [x] [FIX] Migrate sync-runner.sh, feature-validator.sh, and ui-tester.sh to mkdir-based atomic PID locks — three scripts still use legacy file-based PID locks with a TOCTOU race window. (1) `scripts/sync-runner.sh` lines 19-25: `if [ -f "$LOCKFILE" ] && kill -0 ... echo $$ > "$LOCKFILE"`. (2) `scripts/feature-validator.sh` lines 19-25: identical pattern. (3) `scripts/ui-tester.sh` lines 18-24: identical pattern. All other main scripts (`watchdog.sh`, `dev-worker.sh`, `task-fixer.sh`, `project-driver.sh`) were already migrated to mkdir-based atomic locks. Fix: in each of the 3 files, replace the `if [ -f ] ... echo $$ >` block with `mkdir "$LOCKFILE" 2>/dev/null || { ... check stale ... exit 0; }; echo $$ > "$LOCKFILE/pid"`. Update each cleanup trap from `rm -f "$LOCKFILE"` to `rm -rf "$LOCKFILE"`. Follow the exact pattern in `scripts/health-check.sh` lines 17-32 (which already uses mkdir). Run `bash -n scripts/sync-runner.sh scripts/feature-validator.sh scripts/ui-tester.sh` and `pnpm typecheck`. Criterion #3 (no race conditions — consistent locking across all scripts)
- [x] [FIX] Fix health-check.sh lock path using `$SCRIPTS_DIR` instead of `$SKYNET_LOCK_PREFIX` — in `scripts/health-check.sh` line 15, `LOCK_FILE="$SCRIPTS_DIR/health-check.lock"` places the lock inside `.dev/scripts/` instead of `/tmp/skynet-{project}-*`. Every other script uses `${SKYNET_LOCK_PREFIX}-{name}.lock` (resolving to `/tmp/`). This causes three problems: (a) `skynet doctor` scans `${lockPrefix}-health-check.lock` at the temp path, never finding it — health-check always shows as "not running", (b) `skynet stop` cannot stop health-check for the same reason, (c) the lock directory pollutes the project's `.dev/scripts/` directory. Fix: change line 15 from `LOCK_FILE="$SCRIPTS_DIR/health-check.lock"` to `LOCK_FILE="${SKYNET_LOCK_PREFIX}-health-check.lock"`. Run `bash -n scripts/health-check.sh` and `pnpm typecheck`. Criterion #3 (consistent lock paths — all CLI tools can discover and manage all running processes)
- [x] [FIX] Use `sed_inplace` wrapper in task-fixer.sh instead of raw `sed -i.bak` — in `scripts/task-fixer.sh`, two locations (lines 165 and 389) use `sed -i.bak ... "$FAILED"; rm -f "$FAILED.bak"` to modify failed-tasks.md. The `_compat.sh` module provides `sed_inplace()` specifically for portable sed-in-place editing. The raw `sed -i.bak` pattern creates a `.bak` file that requires manual cleanup — if the process is killed between `sed` and `rm -f`, the `.bak` persists indefinitely. Fix: at line 165, change `sed -i.bak "s/| fixing-${FIXER_ID} |/| pending |/g" "$FAILED"; rm -f "$FAILED.bak"` to `sed_inplace "s/| fixing-${FIXER_ID} |/| pending |/g" "$FAILED"`. Apply the same change at line 389. Run `bash -n scripts/task-fixer.sh` and `pnpm typecheck`. Criterion #1 (portability — use the portable wrapper consistently)
- [x] [FIX] Extract duplicate `isProcessRunning` and `readFile` utilities to shared CLI module — `isProcessRunning()` is copy-pasted in 4 CLI files (`doctor.ts`, `status.ts`, `watch.ts`, `start.ts`) with minor signature variation. `readFile()` (a 3-line try/catch wrapper around `readFileSync`) is copy-pasted in 5 CLI files (`doctor.ts`, `status.ts`, `watch.ts`, `metrics.ts`, `cleanup.ts`). Fix: (1) Create `packages/cli/src/utils/readFile.ts` exporting `readFile(path: string): string` that returns empty string on error. (2) Create `packages/cli/src/utils/isProcessRunning.ts` exporting `isProcessRunning(lockPath: string): { running: boolean; pid: string }` supporting both dir-based and file-based locks. (3) Update all 9 files to import from the shared utils and delete their local copies. This follows the same DRY pattern used for `loadConfig.ts` (which eliminated 19 duplicates). Run `pnpm typecheck`. Criterion #3 (maintainable code — DRY principle) _(typecheck failed)_
- [x] [FIX] Extract duplicate `extractTitle` and `parseBlockedBy` to shared backlog-parser module — in `packages/dashboard/src/handlers/pipeline-status.ts` (lines 29, 39) and `packages/dashboard/src/handlers/tasks.ts` (lines 7, 20), `extractTitle()` and `parseBlockedBy()` are byte-for-byte identical copy-pastes. A third `parseBacklog()` exists independently in `packages/dashboard/src/lib/backlog-parser.ts` (already exported). Fix: (1) Move `extractTitle()` and `parseBlockedBy()` to `packages/dashboard/src/lib/backlog-parser.ts` alongside the existing `parseBacklog`. (2) Update `pipeline-status.ts` and `tasks.ts` to import from `../lib/backlog-parser` and delete their local copies. (3) If `tasks.ts` has a more feature-rich `parseBacklog` (with blocked-dependency resolution), consolidate into the shared version with an options parameter. Run `pnpm typecheck`. Criterion #3 (DRY — bug in title parsing must be fixable in one place) _(typecheck failed)_
- [x] [FIX] Replace `&>/dev/null` bashism with portable `>/dev/null 2>&1` in 8 script locations — `&>` is a bashism that redirects both stdout and stderr. While bash 3.2 supports it, the project's shell rules mandate bash 3.2 compatibility and the rest of the codebase uses `>/dev/null 2>&1` exclusively. The 8 locations: `scripts/auth-check.sh` lines 14 and 106, `scripts/agents/claude.sh` line 14, `scripts/agents/codex.sh` line 14, `scripts/_agent.sh` lines 37, 94, and 161, `scripts/_compat.sh` line 62. Also in `scripts/_compat.sh` line 7, replace `[[ "$(uname -s)" == "Darwin" ]]` with `[ "$(uname -s)" = "Darwin" ]` for POSIX consistency (this is the only `[[` in the codebase outside the already-fixed `watchdog.sh`). Fix: global find-and-replace `&>/dev/null` with `>/dev/null 2>&1` in these files. Run `bash -n` on all modified files and `pnpm typecheck`. Criterion #1 (portability — consistent bash 3.2 style)
- [x] [INFRA] Add `permissions: contents: read` to CI workflow and npm metadata to published packages — (1) In `.github/workflows/ci.yml`, add top-level `permissions: contents: read` to enforce least-privilege access for the GITHUB_TOKEN. Both publish workflows already have explicit permissions — CI should too. (2) In `packages/cli/package.json`, add: `"description": "CLI for Skynet — autonomous AI development pipeline"`, `"repository": { "type": "git", "url": "https://github.com/AjionCorp/skynet" }`, `"license": "MIT"`, `"engines": { "node": ">=20" }`, `"keywords": ["skynet", "ai", "pipeline", "claude", "autonomous"]`. (3) In `packages/dashboard/package.json`, add the same fields with `"description": "Embeddable dashboard components and API handlers for Skynet pipeline monitoring"`. (4) Fix `packages/cli/src/commands/init.ts` line 177 which ends with `;;` (double semicolons — TypeScript treats the second as an empty statement, but it's a typo). Run `pnpm typecheck`. Criterion #1 (professional npm packages) and #2 (CI security best practice)
- [x] [FIX] Optimize pipeline-logs handler to avoid reading entire file for line count — in `packages/dashboard/src/handlers/pipeline-logs.ts` lines 96-97, `const content = readFileSync(logPath, "utf-8"); totalLines = content.split("\n").length;` reads the entire log file into memory just to count lines. For log files at the `SKYNET_MAX_LOG_SIZE_KB` limit (1 MB), this allocates and splits a 1 MB string on every API call to `/api/admin/pipeline/logs`. The response data (tail output) is already computed separately above. Fix: replace the full-file read with a streaming line counter: `let totalLines = 0; const buf = readFileSync(logPath); for (let i = 0; i < buf.length; i++) { if (buf[i] === 10) totalLines++; } totalLines++;`. This counts newlines without creating an array of substrings, reducing memory usage by ~4x for large files. Alternatively, since the `tail` offset is the primary use case, set `totalLines` to an estimate using `statSync(logPath).size / 80` (average line length) if exact count is not critical. Run `pnpm typecheck`. Criterion #3 (efficient API handlers — no unnecessary memory allocation) _(typecheck failed)_
- [x] [FIX] Remove ghost `SKYNET_START_DEV_CMD` from config.ts KNOWN_VARS — in `packages/cli/src/commands/config.ts` line 58, `SKYNET_START_DEV_CMD: "Command to start the dev server (optional)"` is listed in `KNOWN_VARS` but this variable does NOT exist in `templates/skynet.config.sh` and is not referenced in any shell script. The actual dev server command variable is `SKYNET_DEV_SERVER_CMD` which is already correctly documented at line 16. `skynet config list` shows a row for a non-existent variable, confusing users who try to set it. Fix: delete line 58 containing `SKYNET_START_DEV_CMD`. Run `pnpm typecheck`. Criterion #1 (accurate developer tooling — no phantom config variables)
- [x] [FIX] Add `SKYNET_WORKER_CONTEXT` and `SKYNET_WORKER_CONVENTIONS` as commented-out examples in config template — `dev-worker.sh` line 461 uses `${SKYNET_WORKER_CONTEXT:-}` and line 482 uses `${SKYNET_WORKER_CONVENTIONS:-}` for injecting project-specific context and coding conventions into agent prompts. `task-fixer.sh` line 382 also uses `${SKYNET_WORKER_CONVENTIONS:-}`. These are documented in `KNOWN_VARS` (config.ts lines 59-60) but NOT in `templates/skynet.config.sh`, making them completely undiscoverable to users. Fix: add after the Agent Plugin section (after line 85 in the template) as commented-out examples: `# export SKYNET_WORKER_CONTEXT=""  # Path to file with project-specific context injected into agent prompts` and `# export SKYNET_WORKER_CONVENTIONS=""  # Path to file with coding conventions injected into agent prompts`. Run `pnpm typecheck`. Criterion #1 (all config knobs discoverable in the template)
- [x] [DOCS] Add README.md for `@ajioncorp/skynet` dashboard package — the npm package for embedding Skynet's dashboard into external Next.js apps has no README (`packages/dashboard/README.md` does not exist). The npmjs.com page would be blank. Create `packages/dashboard/README.md` with sections: (1) One-line description: "Embeddable dashboard components and API handlers for Skynet pipeline monitoring", (2) Installation: `npm install @ajioncorp/skynet` with peer deps (next >=14, react >=18), (3) Quick Start showing `SkynetProvider` setup and component import pattern, (4) Handler factories table mapping each `createXxxHandler(config)` to its API route, (5) Available components list (PipelineDashboard, TasksDashboard, MonitoringDashboard, etc.), (6) TypeScript types reference linking to `types.ts`. Add `"README.md"` to the `files` array in `packages/dashboard/package.json` if a `files` field exists. Keep under 100 lines. Run `pnpm typecheck`. Criterion #1 (usable npm package surface for external consumers)
- [x] [FIX] Validate git repository during `skynet init` — in `packages/cli/src/commands/init.ts`, the `initCommand()` function creates `.dev/` and copies scripts without checking if the current directory is inside a git repository. If a user runs `npx skynet init` in a non-git directory, the pipeline will fail on first task claim when `git worktree add` is called with a confusing low-level error. Fix: at the start of `initCommand()`, before any file operations, run `execSync("git rev-parse --is-inside-work-tree", { stdio: "pipe" })` in a try/catch. If it fails, print a clear error: "Error: skynet init must be run from within a git repository. Run 'git init' first." and `process.exit(1)`. Also verify the repo has at least one commit via `execSync("git rev-parse HEAD", { stdio: "pipe" })` since `git worktree` requires it — if no commits exist, print "Error: git repository must have at least one commit. Run 'git add -A && git commit -m initial' first." Run `pnpm typecheck`. Criterion #1 (clear errors during setup — catches misconfiguration before pipeline starts)
- [x] [INFRA] Add publish workflow for `@ajioncorp/skynet` dashboard package — currently only `.github/workflows/publish-cli.yml` exists for the CLI package. The dashboard package `@ajioncorp/skynet` has `publishConfig` in `packages/dashboard/package.json` with dist paths but no GitHub Actions publish workflow. Create `.github/workflows/publish-dashboard.yml` triggered on `dashboard-v*` tags. Steps: checkout, setup Node 20, setup pnpm 10, `pnpm install`, `pnpm typecheck`, `pnpm --filter @ajioncorp/skynet test`, `pnpm --filter @ajioncorp/skynet build`, verify `packages/dashboard/dist/index.js` exists, `npm publish --provenance --access public` from `packages/dashboard/`. Follow the same pattern as `publish-cli.yml`. Run `pnpm typecheck`. Criterion #1 (dashboard package actually publishable to npm) and Criterion #2 (CI gates on every publish)
- [x] [FIX] Fix TypeScript backlog mutex path missing dash separator — in `packages/dashboard/src/handlers/tasks.ts` line 85, `backlogLockPath` is constructed as `${lockPrefix}backlog.lock` (no dash), producing `/tmp/skynet-skynetbacklog.lock`. But bash scripts use `${SKYNET_LOCK_PREFIX}-backlog.lock` (with dash), producing `/tmp/skynet-skynet-backlog.lock`. The dashboard and workers can NEVER contend on the same mutex — concurrent writes from the dashboard POST `/api/admin/tasks` and a shell worker can corrupt `backlog.md`. Same missing-dash issue in `pipeline-status.ts` lines 422-423 (`${lockPrefix}claude-token` and `${lockPrefix}auth-failed` — both missing the dash). Fix: in `tasks.ts:85`, change to `${lockPrefix}-backlog.lock`. In `pipeline-status.ts:422-423`, change to `${lockPrefix}-claude-token` and `${lockPrefix}-auth-failed`. In `pipeline-status.ts:447`, change to `${lockPrefix}-backlog.lock`. Run `pnpm typecheck`. Criterion #3 (data integrity — backlog.md corruption prevention)
- [x] [FIX] Migrate task-fixer.sh and project-driver.sh to mkdir-based atomic PID locks — `scripts/task-fixer.sh` lines 98-102 and `scripts/project-driver.sh` lines 26-31 still use legacy file-based PID locks (`echo $$ > "$LOCKFILE"`) with a TOCTOU race window. `watchdog.sh` and `dev-worker.sh` were already migrated to mkdir-based atomic locks. Fix: (1) In `task-fixer.sh`, replace the `if [ -f "$LOCKFILE" ]...echo $$ > "$LOCKFILE"` block with `mkdir "$LOCKFILE" 2>/dev/null || { ... }; echo $$ > "$LOCKFILE/pid"`. Update `cleanup_on_exit` at line 155 from `rm -f "$LOCKFILE"` to `rm -rf "$LOCKFILE"`. (2) Apply the same pattern to `project-driver.sh` lines 26-31 and its cleanup. (3) In `dev-worker.sh` line 395, update the project-driver lock check from `cat "${SKYNET_LOCK_PREFIX}-project-driver.lock"` to `cat "${SKYNET_LOCK_PREFIX}-project-driver.lock/pid"` since the lock is now a directory. Run `pnpm typecheck` and `bash -n scripts/task-fixer.sh scripts/project-driver.sh`. Criterion #3 (no race conditions — prevents duplicate fixer/driver instances)
- [x] [FIX] Fix watchdog zombie detection to check heartbeat before killing alive workers — in `scripts/watchdog.sh` lines 149-155, the `crash_recovery()` function determines zombies using lock directory mtime: `lock_mtime=$(file_mtime "$lockfile"); lock_age_secs=$((now - lock_mtime))`. If `lock_age_secs > stale_secs`, the worker is killed — even if its heartbeat is fresh. A legitimately running worker on a slow 50-minute task gets killed because the lock dir mtime (set at creation, never updated) exceeds `SKYNET_STALE_MINUTES`. Fix: before killing at line 155, check the corresponding heartbeat file: `local hb_file="$DEV_DIR/worker-${wid}.heartbeat"` and if it exists and is recent (within stale_secs), log "Worker $wid lock is old but heartbeat is fresh — skipping" and continue. Only kill when BOTH the lock is stale AND the heartbeat is stale or missing. Run `pnpm typecheck`. Criterion #3 (no false-positive zombie kills — prevents legitimate work from being lost)
- [x] [FIX] Fix `skynet stop` and `skynet doctor` hardcoded worker lists — in `packages/cli/src/commands/stop.ts` line 99, workers are hardcoded as `["dev-worker-1", "dev-worker-2", "task-fixer", "project-driver", ...]`. When `SKYNET_MAX_WORKERS=4`, workers 3-4 are silently left running by `skynet stop`. Same issue in `packages/cli/src/commands/doctor.ts` line 213-214 which hardcodes the same 2-worker list. Fix: (1) In `stop.ts`, read `SKYNET_MAX_WORKERS` and `SKYNET_MAX_FIXERS` from config via `loadConfig()`, then dynamically build the worker list: `for (let i = 1; i <= maxWorkers; i++) workers.push("dev-worker-" + i)` and `for (let i = 1; i <= maxFixers; i++) workers.push("task-fixer-" + i)`. (2) In `doctor.ts`, apply the same dynamic pattern for the Workers section at line 213. Also add stale lock cleanup to `--fix` mode: when a stale lock directory is detected (PID not alive), `rmdirSync`/`rmSync` the lock directory. Run `pnpm typecheck`. Criterion #1 (correct CLI behavior at all scale configurations) and #3 (reliable stop)
- [x] [FIX] Fix pipeline-status.ts `handlerCount` always returning 0 in production builds — in `packages/dashboard/src/handlers/pipeline-status.ts` lines 546-553, handler counting uses `readdir(handlersDir).filter((f) => f.endsWith(".ts") && !f.includes(".test."))`. In production Next.js builds, `__dirname` points to compiled output containing `.js` files, not `.ts`. The filter matches zero files, so `handlerCount` is always 0, breaking mission criterion #1 and #4 evaluation. Fix: change the filter to check for both extensions: `f.endsWith(".ts") || f.endsWith(".js")` and exclude both `.test.ts` and `.test.js`. Alternatively, hardcode the handler count as a known constant (currently 10 handlers) since it changes rarely and counting compiled files is inherently fragile. Run `pnpm typecheck` and `pnpm build` to verify. Criterion #4 (dashboard shows correct mission progress in production)
- [x] [INFRA] Add typecheck and test steps to publish-cli.yml before npm publish — in `.github/workflows/publish-cli.yml`, the publish job runs `pnpm build` and checks that `dist/index.js` exists, but does NOT run `pnpm typecheck` or `pnpm test` before publishing. A developer can push a `cli-v*` tag on a commit with failing tests and the broken version ships to npm. Fix: add two steps before the publish step: (1) `pnpm typecheck` to catch type errors, (2) `pnpm --filter @ajioncorp/skynet-cli test` to run CLI unit tests. If either fails, the publish is blocked. This prevents broken CLI releases from reaching users via `npx skynet init`. Run `pnpm typecheck`. Criterion #2 (CI quality gates prevent broken releases)
- [x] [FIX] Fix watchdog `_archive_old_completions` date comparison using `<` in `[ ]` — in `scripts/watchdog.sh` line 495, `[ "$entry_date" < "$cutoff_date" ]` uses `<` inside POSIX `[ ]` test brackets. In POSIX `[ ]`, `<` is the input redirection operator, not a string comparison. Bash's builtin `[` intercepts this, but the behavior is fragile and may create a file named after `$cutoff_date` in the current directory on some systems. Fix: change to `[ "$entry_date" \< "$cutoff_date" ]` (escaped for POSIX) or preferably use a portable comparison: `case` statement or `[ "$(printf '%s\n' "$entry_date" "$cutoff_date" | sort | head -1)" = "$entry_date" ]` and `[ "$entry_date" != "$cutoff_date" ]`. Run `bash -n scripts/watchdog.sh` and `pnpm typecheck`. Criterion #1 (portability — bash 3.2 on macOS)
- [x] [FIX] Fix health-check.sh unquoted `$SKYNET_LINT_CMD` causing word splitting — in `scripts/health-check.sh` line 102, `if $SKYNET_LINT_CMD >> "$LOG" 2>&1` expands without quotes. If the user sets `SKYNET_LINT_CMD="pnpm run lint"`, word splitting treats each space-separated token as a separate argument to the first token, breaking the command with confusing "command not found" errors. The quality gates in `dev-worker.sh` use `eval "$_gate_cmd"` which handles the full string as a shell command. Fix: change line 102 from `if $SKYNET_LINT_CMD >> "$LOG" 2>&1` to `if eval "$SKYNET_LINT_CMD" >> "$LOG" 2>&1`. Apply the same fix to `$SKYNET_TYPECHECK_CMD` if it has the same pattern anywhere in the file. Run `bash -n scripts/health-check.sh` and `pnpm typecheck`. Criterion #1 (portability — commands with spaces must work)
- [x] [FIX] Fix codex.sh to pipe prompt via stdin instead of CLI argument — in `scripts/agents/codex.sh` line 41, `_agent_exec $SKYNET_CODEX_BIN $SKYNET_CODEX_FLAGS $model_flag "$prompt"` passes the prompt as a CLI argument. `claude.sh` was already fixed to pipe via stdin to avoid ARG_MAX limits (~256KB per argument on macOS). For large task descriptions with extensive `SKYNET_WORKER_CONTEXT`, the codex agent will silently fail. Fix: change line 41 to `printf '%s\n' "$prompt" | _agent_exec $SKYNET_CODEX_BIN $SKYNET_CODEX_FLAGS $model_flag >> "$log_file" 2>&1` matching `claude.sh`'s pattern. Verify Codex CLI accepts stdin input (check `--help` output). If Codex doesn't support stdin, use a temp file: `local _prompt_file=$(mktemp); printf '%s\n' "$prompt" > "$_prompt_file"; _agent_exec ... --file "$_prompt_file"` and clean up in the trap handler. Run `bash -n scripts/agents/codex.sh`. Criterion #6 (agent parity — all plugins should handle large prompts) _(typecheck failed)_
- [x] [FIX] Fix `_agent.sh` relative plugin path resolution breaking custom agents — in `scripts/_agent.sh` line 65, `_resolve_plugin_path()` returns relative paths unchanged: `*) echo "$name" ;;`. The plugin is then sourced with `source "$_plugin_resolved"`, but `$PWD` at source time is not where the user placed their plugin. A user setting `SKYNET_AGENT_PLUGIN="./my-agent.sh"` gets "FATAL: Agent plugin not found" because the file check at line 101 runs from a different directory. Fix: in the `*)` case of `_resolve_plugin_path()`, resolve relative paths against `$PROJECT_DIR`: `*) if [ -f "$PROJECT_DIR/$name" ]; then echo "$PROJECT_DIR/$name"; elif [ -f "$name" ]; then echo "$name"; else echo "$name"; fi ;;`. This makes `SKYNET_AGENT_PLUGIN="./my-agent.sh"` resolve relative to the project root. Run `bash -n scripts/_agent.sh`. Criterion #6 (extensibility — custom agent plugins must actually work)
- [x] [FIX] Add missing `SKYNET_WATCHDOG_INTERVAL` and `SKYNET_ONE_SHOT` to config template — `SKYNET_WATCHDOG_INTERVAL` is used in `scripts/watchdog.sh` line 16 (`${SKYNET_WATCHDOG_INTERVAL:-180}`) and documented in `config.ts` KNOWN_VARS, but is NOT in `templates/skynet.config.sh`. Users cannot discover or tune watchdog dispatch frequency. `SKYNET_ONE_SHOT` is used in 5 places in `watchdog.sh` and 9 places in `dev-worker.sh` as a feature flag for single-task mode, but is completely undocumented. Fix: add to `templates/skynet.config.sh` before the closing comments: `export SKYNET_WATCHDOG_INTERVAL="180"` with comment "# Seconds between watchdog monitoring cycles" and `export SKYNET_ONE_SHOT=""` with comment "# Set to 1 for single-task mode (worker exits after one task)". Also add `SKYNET_ONE_SHOT` to `KNOWN_VARS` in `config.ts` with description "Run workers in single-task mode — exit after completing one task". Run `pnpm typecheck`. Criterion #1 (discoverable configuration — all tuning knobs must be in the template) _(typecheck failed)_
- [x] [FIX] Fix duplicate Activity icon for events page in admin navigation — in `packages/admin/src/app/admin/layout.tsx`, both `pipeline` (line 9) and `events` (line 17) use the `Activity` icon from lucide-react. This makes the sidebar navigation confusing — two identical icons for different pages. Fix: change the `events` entry to use the `ScrollText` icon (or `FileText`/`ListOrdered`), which better represents an event log/audit trail. Import `ScrollText` from `lucide-react` and update the icon property. Run `pnpm typecheck`. Criterion #4 (dashboard usability — distinct visual navigation)
- [x] [TEST] Add E2E tests for `skynet stop`, `skynet pause`/`resume`, and remaining CLI smoke tests — in `tests/e2e/cli-commands.test.sh`, the E2E suite covers init, add-task, status, doctor, config, export/import, but is missing critical operational commands. Add: (a) **stop**: create a mock PID lock directory for `dev-worker-3`, run `skynet stop`, verify it attempts to kill the correct PIDs and removes lock dirs (this catches the hardcoded worker list bug). (b) **pause/resume**: run `skynet pause`, verify `.dev/pipeline-paused` sentinel exists with correct JSON, run `skynet resume`, verify sentinel is removed. (c) **completions**: run `skynet completions bash`, verify output contains `complete -W` and all 26 command names. (d) **validate**: run `skynet validate`, verify it checks gates, git remote, disk space, and mission.md. These are the last untested CLI E2E workflows. Run `pnpm typecheck`. Criterion #2 (comprehensive E2E coverage — all operational commands tested) _(typecheck failed)_
- [x] [FIX] Fix project-driver deduplication to include completed.md and `[x]` backlog entries — in `scripts/project-driver.sh`, the deduplication logic at lines 215-219 only snapshots pending `[ ]` and claimed `[>]` backlog entries via `grep '^\- \[[ >]\]'`. It NEVER reads `completed.md`. When the backlog empties, the LLM regenerates already-completed tasks because the dedup guard allows them through. This caused `completions` to be executed 15+ times and `watch` 8+ times. Fix: (1) At line 216, also include `[x]` entries: change `grep '^\- \[[ >]\]'` to `grep '^\- \[[ >x]\]'`. (2) After line 219, add: `if [ -f "$COMPLETED" ]; then awk -F'|' 'NR>2 {t=$3; gsub(/^ +| +$/,"",t); if(t!="") print "- [ ] " t}' "$COMPLETED" >> "$_dedup_snapshot"; while IFS= read -r _line; do _normalize_task_line "$_line"; done < <(tail -n +3 "$_dedup_snapshot") >> "$_dedup_normalized"; fi`. This ensures tasks already in completed.md are never regenerated. Run `pnpm typecheck`. Criterion #3 (no wasted cycles — this single bug wasted ~30% of all API credits)
- [x] [FIX] Fix stale lock recovery using wrong backlog marker causing 0m re-executions — in `scripts/dev-worker.sh` line 336, when stale lock detection triggers, the code calls `remove_from_backlog "- [ ] $task_title"` but by that point the task is marked `[>]` (claimed), not `[ ]` (pending). Since `remove_from_backlog` does an exact match via `grep -Fxv`, the remove silently fails. The `[>]` entry persists, watchdog later unclaims it back to `[ ]`, and the task re-executes with "0m" duration because the implementation already exists. Fix: change line 336 from `remove_from_backlog "- [ ] $task_title"` to `remove_from_backlog "- [>] $task_title"`. Also add a fallback: if the `[>]` match fails, try `[x]` in case it was already marked done by another code path. Run `pnpm typecheck`. Criterion #3 (no duplicate executions — directly explains the 0m duration entries in completed.md)
- [x] [FIX] Consolidate duplicate port config variables `SKYNET_DEV_SERVER_PORT` and `SKYNET_DEV_PORT` — in `templates/skynet.config.sh` lines 17-18, two separate port variables exist: `SKYNET_DEV_SERVER_PORT=3000` and `SKYNET_DEV_PORT=3000`. The `init.ts` command (line 146) substitutes only `SKYNET_DEV_SERVER_PORT` when user passes `--port`, but `scripts/_config.sh` and `dev-worker.sh` only read `SKYNET_DEV_PORT` for runtime port calculation. This means `skynet init --port 4000` has no effect on workers — they still use port 3000. Fix: (1) remove `SKYNET_DEV_SERVER_PORT` from the template, keep only `SKYNET_DEV_PORT`. (2) In `packages/cli/src/commands/init.ts` line 146, change the `.replace()` target from `SKYNET_DEV_SERVER_PORT` to `SKYNET_DEV_PORT`. (3) Update `start-dev.sh` if it references `SKYNET_DEV_SERVER_PORT`. (4) Remove `SKYNET_DEV_SERVER_PORT` from `KNOWN_VARS` in `config.ts` if present. Run `pnpm typecheck`. Criterion #1 (correct init — user-specified port must actually take effect)
- [x] [FIX] Use configurable `SKYNET_AUTH_NOTIFY_INTERVAL` in auth-check.sh instead of hardcoded value — in `scripts/auth-check.sh` line 16, `AUTH_NOTIFY_INTERVAL=3600` is hardcoded, ignoring the `SKYNET_AUTH_NOTIFY_INTERVAL=3600` defined in `templates/skynet.config.sh` line 59. The config variable is dead — changing it has no effect. Fix: change line 16 from `AUTH_NOTIFY_INTERVAL=3600` to `AUTH_NOTIFY_INTERVAL="${SKYNET_AUTH_NOTIFY_INTERVAL:-3600}"`. Also check if `CODEX_NOTIFY_INTERVAL` (around line 102) has the same issue and apply the same pattern. Run `pnpm typecheck`. Criterion #3 (config variables must actually be honored — no dead config)
- [x] [FIX] Make worker-scaling handler read `SKYNET_MAX_FIXERS` from config instead of hardcoding 3 — in `packages/dashboard/src/handlers/worker-scaling.ts` lines 16-18, `TYPE_MAX` hardcodes `"task-fixer": 3`. If a user sets `SKYNET_MAX_FIXERS=5` in config, the dashboard scaling UI still caps at 3 fixers, which is misleading. Fix: (1) add `maxFixers?: number` to the `SkynetConfig` interface in `packages/dashboard/src/types.ts` (after `maxWorkers`). (2) In `maxForType()`, handle `"task-fixer"` dynamically: `if (t === "task-fixer") return maxFixers;`. (3) In the admin API route `packages/admin/src/app/api/admin/workers/scale/route.ts`, read `SKYNET_MAX_FIXERS` from config and pass it to the handler. Run `pnpm typecheck`. Criterion #4 (dashboard must reflect actual configuration)
- [x] [FIX] Make start-dev.sh accept worker ID for per-worker log and PID file isolation — in `scripts/start-dev.sh` lines 9-10, `LOG` and `PIDFILE` are hardcoded to `next-dev.log` and `next-dev.pid`. In multi-worker setups, all workers share the same log and PID file, causing log interleaving and PID tracking conflicts. Fix: accept an optional `$1` argument for worker ID. When provided, derive `LOG="$SCRIPTS_DIR/next-dev-w${1}.log"` and `PIDFILE="$SCRIPTS_DIR/next-dev-w${1}.pid"`. When absent, use the current defaults for backward compatibility. In `dev-worker.sh`, pass `$WORKER_ID` when calling `start-dev.sh`. Run `pnpm typecheck`. Criterion #3 (multi-worker isolation — no shared state between workers)
- [x] [FIX] Consolidate duplicate `PipelineStatus` and `MonitoringStatus` types — in `packages/dashboard/src/types.ts`, `PipelineStatus` (lines 97-128) and `MonitoringStatus` (lines 154-185) are structurally identical — every field in one exists in the other with the same type. This duplication means any new field must be manually mirrored. Fix: delete the `MonitoringStatus` interface body (lines 154-185) and replace with `export type MonitoringStatus = PipelineStatus;`. Verify all imports compile. Run `pnpm typecheck`. Criterion #3 (DRY — no duplicate type definitions)
- [x] [INFRA] Add `timeout-minutes` to all CI workflow jobs to prevent runaway builds — in `.github/workflows/ci.yml`, the `e2e-admin` Playwright job has no `timeout-minutes`, defaulting to GitHub's 6-hour maximum. If Playwright hangs, the job wastes CI minutes. Fix: add `timeout-minutes: 10` to `e2e-admin` and `e2e-cli` jobs, `timeout-minutes: 5` to `typecheck`, `build`, `lint-sh`, and `lint-ts` jobs, `timeout-minutes: 10` to `unit-test`. These generous limits prevent hangs without interrupting legitimate runs. Criterion #2 (efficient CI — no wasted GitHub Actions minutes)
- [x] [FEAT] Add `echo` agent plugin for pipeline dry-run testing — create `scripts/agents/echo.sh` as a minimal agent plugin that echoes the task description back without calling any LLM. On `agent_run()`, create a single commit with a placeholder file containing the task description and "TODO: implement". On `agent_check()`, return success. This lets users run `SKYNET_AGENT_PLUGIN=echo skynet start` to test the full pipeline lifecycle (claim, branch, gate, merge) without burning LLM API tokens. Register in the agent selection logic in `scripts/_agent.sh`. Run `pnpm typecheck` and `bash -n scripts/agents/echo.sh`. Criterion #1 (faster pipeline verification during setup) and #6 (extensible to any agent) _(typecheck failed)_
- [x] [FIX] Truncate completed.md to last 30 entries in project-driver.sh prompt context — in `scripts/project-driver.sh` line 59, `completed_content=$(cat "$COMPLETED")` loads the ENTIRE 132KB (35K tokens) completed.md into the LLM prompt. With 164+ entries and growing, this wastes API credits and context window on every project-driver invocation. The LLM only needs recent completions for deduplication context (which is now handled separately by the dedup check). Fix: change line 59 from `completed_content=$(cat "$COMPLETED")` to `completed_content=$(head -2 "$COMPLETED"; tail -30 "$COMPLETED")` — keeps the markdown table header (2 lines) plus only the last 30 entries. This cuts prompt size by ~80% (~28K tokens saved per run). Also change the prompt text at line 129 from `### Completed Tasks (.dev/completed.md)` to `### Recent Completed Tasks (last 30 of $(wc -l < "$COMPLETED") entries)`. Run `pnpm typecheck`. Criterion #3 (efficient resource usage — saves ~$0.50+ per project-driver run)
- [x] [INFRA] Extract loadConfig() to shared CLI utility module — the identical `loadConfig()` function is copy-pasted in 19 CLI command files (`status.ts`, `doctor.ts`, `add-task.ts`, `pause.ts`, `resume.ts`, `run.ts`, `logs.ts`, `stop.ts`, `start.ts`, `watch.ts`, `reset-task.ts`, `validate.ts`, `setup-agents.ts`, `test-notify.ts`, `metrics.ts`, `changelog.ts`, `export.ts`, `import.ts`, `cleanup.ts`). Create `packages/cli/src/utils/loadConfig.ts` exporting a single `loadConfig(projectDir: string): Record<string, string> | null` function with the fixed regex (supporting both quoted and unquoted values). Update all 19 files to `import { loadConfig } from '../utils/loadConfig'` and delete their local copies. This makes future config parser changes (like the unquoted value fix) a single-file change instead of 19. Run `pnpm typecheck`. Criterion #3 (maintainable code — DRY principle)
- [x] [FIX] Add merge retry with rebase to task-fixer.sh — `scripts/task-fixer.sh` line 427 does a bare `git merge "$branch_name" --no-edit` with NO recovery on failure. Unlike `dev-worker.sh` (lines 555-576) which has full merge-abort → git-pull → rebase → retry logic, the task-fixer immediately gives up on merge conflicts. Since fixers run on branches that have already diverged from main (the original worker failed, main has moved), merge conflicts are very common for fixer attempts. Fix: after line 427, add the same recovery block as `dev-worker.sh:555-576`: `git merge --abort`, `git pull origin main`, `git checkout "$branch_name"`, `git rebase main`, if rebase succeeds retry merge once. If rebase has conflicts, `git rebase --abort` and proceed to fail. Log "Merge conflict — attempting rebase recovery..." for visibility. Run `pnpm typecheck`. Criterion #2 (self-correction rate improvement — fixer merge failures are the #1 remaining failure mode)
- [x] [FIX] Fix dynamic Tailwind class names getting purged in production PipelineDashboard — in `packages/dashboard/src/components/PipelineDashboard.tsx` lines 273-306, health score and self-correction rate colors are constructed via template literals: `border-${healthColor}-500/20`, `bg-${healthColor}-500/5`, `text-${healthColor}-400`, etc. where `healthColor` is computed at runtime (`"emerald"`, `"amber"`, or `"red"`). Tailwind's content scanner cannot detect dynamically-constructed class names and will purge them in production builds, leaving unstyled elements. Fix: replace the dynamic `healthColor` pattern with a lookup object that returns complete class strings: `const colorClasses = { high: 'border-emerald-500/20 bg-emerald-500/5 text-emerald-400', medium: 'border-amber-500/20 bg-amber-500/5 text-amber-400', low: 'border-red-500/20 bg-red-500/5 text-red-400' }`. Apply the same fix to the self-correction rate badge. Run `pnpm typecheck` and `pnpm build` to verify. Criterion #4 (dashboard actually works in production)
- [x] [INFRA] Add completed.md archival to prevent unbounded state file growth — there is NO rotation or archival mechanism for `.dev/completed.md`. With 164+ entries (132KB), it grows with every completed task and is never trimmed. All readers (`project-driver.sh`, `watchdog.sh`, `pipeline-status.ts`, `status.ts`, `metrics.ts`, `changelog.ts`) parse the full file on every invocation. In `scripts/watchdog.sh`, after the existing `_auto_supersede_completed_tasks` call (~line 429), add a new function `_archive_old_completions()`: if completed.md has more than 100 entries (lines after the 2-line header), move entries older than 7 days to `.dev/completed-archive.md` (append, creating if needed), keeping only the last 100 in the active file. Preserve the markdown table header. Log "Archived N completed entries older than 7 days". Update `packages/cli/src/commands/changelog.ts` and `metrics.ts` to also read `completed-archive.md` if it exists (for full historical data). Run `pnpm typecheck`. Criterion #3 (no unbounded resource consumption — completed.md will eventually hit ARG_MAX on the command line)
- [x] [FIX] Fix is_task_blocked() to also check completed.md for dependency resolution — in `scripts/dev-worker.sh` lines 121-141, `is_task_blocked()` only checks for `[x]` markers in `$BACKLOG` to determine if a dependency is done. Once old `[x]` entries are cleaned from the backlog (or after a completed.md archival), a dependency that was genuinely completed won't match, and the dependent task stays blocked forever. Fix: after line 136 (`if ! grep -q "^\- \[x\] .*${dep}" "$BACKLOG"...`), add a fallback check: `if [ -f "$COMPLETED" ] && grep -qF "$dep" "$COMPLETED" 2>/dev/null; then continue; fi`. This mirrors the same pattern already used in `_config.sh:229-233` for `validate_backlog()`. Run `pnpm typecheck`. Criterion #3 (correct dependency resolution — prevents tasks from getting stuck)
- [x] [TEST] Add `validate.test.ts` CLI unit test — `validate.ts` is the only CLI command (1 of 26) without test coverage. Create `packages/cli/src/commands/__tests__/validate.test.ts`. Mock `fs.readFileSync`, `fs.existsSync`, `fs.statfsSync`, and `child_process.execSync`. Test: (a) with valid config containing SKYNET_GATE_1, runs the gate command and reports PASS, (b) gate command failure reports FAIL, (c) no SKYNET_GATE_N variables defined reports WARN, (d) `git ls-remote` success reports Git Remote PASS, (e) `git ls-remote` failure reports Git Remote FAIL, (f) disk space < 1GB reports WARN, (g) missing `.dev/mission.md` reports FAIL, (h) empty mission.md reports FAIL, (i) overall exit code 1 when any check is FAIL. Follow existing CLI test patterns in `doctor.test.ts`. Run `pnpm test`. Criterion #2 (complete CLI test coverage — 26/26 commands)
- [x] [FIX] Fix sync-runner.sh bash 3.2 array syntax incompatibility — `scripts/sync-runner.sh` lines 56-57 use `declare -a _sync_names=()` and `declare -a _sync_results=()`, and later iterate with `"${!_sync_names[@]}"` (line ~75) which requires bash 4+ for the `${!}` indirect expansion on indexed arrays. On macOS with bash 3.2 (the default), this silently fails or produces incorrect results. Fix: replace `"${!_sync_names[@]}"` with a counter-based loop: `local _i=0; while [ $_i -lt ${#_sync_names[@]} ]; do ... _i=$((_i + 1)); done`. Also verify no other bash 4+ syntax is used in the file. Run `pnpm typecheck` and `bash -n scripts/sync-runner.sh` with bash 3.2 to verify. Criterion #1 (portability — macOS compatibility is a mission requirement)
- [x] [FIX] Make LogViewer worker/fixer count dynamic instead of hardcoded — in `packages/dashboard/src/components/LogViewer.tsx` lines 8-19, `LOG_SOURCES` is a hardcoded array with exactly 4 worker entries and 3 fixer entries. If `SKYNET_MAX_WORKERS` or `SKYNET_MAX_FIXERS` is configured higher, those workers' logs are invisible in the dashboard. Fix: change `LOG_SOURCES` from a static const to a function `getLogSources(maxWorkers: number, maxFixers: number)` that generates entries dynamically. Fetch `maxWorkers` and `maxFixers` from the config API endpoint (`/api/admin/config`) on component mount, defaulting to 4 workers and 3 fixers if the API is unavailable. Run `pnpm typecheck`. Criterion #4 (dashboard visibility scales with configuration)
- [x] [FIX] Cap pipeline-status handler `completed` array to last 50 entries — in `packages/dashboard/src/handlers/pipeline-status.ts` lines 329-351, the entire `completed.md` table is parsed and returned as the `completed` array in the API response (line ~570). With 170+ completed tasks and growing, this response payload grows unboundedly. The only consumer is `MonitoringDashboard.tsx` which uses `status.completed.slice(-5)` (last 5 entries). Fix: (1) compute `completedCount` and `averageTaskDuration` from the full array BEFORE slicing, (2) replace the full `completed` array with `completed.slice(-50)` in the response object, keeping only the 50 most recent entries. This reduces API response size by ~80% without affecting any dashboard view. Run `pnpm typecheck`. Criterion #3 (efficient API responses — no unbounded payloads)
- [x] [FIX] Pass agent prompt via stdin instead of CLI argument to avoid ARG_MAX — in `scripts/agents/claude.sh` line 39, the prompt is passed as a direct CLI argument: `_agent_exec $SKYNET_CLAUDE_BIN $SKYNET_CLAUDE_FLAGS "$prompt"`. On macOS, `ARG_MAX` is ~1MB. With large `SKYNET_WORKER_CONTEXT` and `SKYNET_WORKER_CONVENTIONS` config values, the prompt can exceed this limit. Fix: change the invocation to pipe the prompt via stdin: `echo "$prompt" | _agent_exec $SKYNET_CLAUDE_BIN $SKYNET_CLAUDE_FLAGS --print -` or write to a temp file and pass via `cat`. Check the `_agent_exec` function in `scripts/_agent.sh` to ensure stdin piping is compatible. If using a temp file, ensure it's cleaned up in the trap handler. Test with a large prompt string (>500KB) to verify. Run `pnpm typecheck`. Criterion #3 (reliability — prevents silent failures on large projects with extensive conventions)
- [x] [FIX] Use mkdir-based atomic lock for watchdog PID singleton enforcement — in `scripts/watchdog.sh` lines 22-31, the PID lock uses a file-based check-then-write pattern: `if [ -f "$WATCHDOG_LOCK" ]; then ... rm -f; fi; echo $$ > "$WATCHDOG_LOCK"`. This has a TOCTOU race — between `rm -f` and `echo $$`, a second watchdog can pass the check and both believe they're the singleton. The same pattern exists in `scripts/dev-worker.sh` lines 254-259. Fix: replace the PID file approach with `mkdir`-based atomic locking (same pattern as the backlog mutex at `scripts/_config.sh`). Use `mkdir "$WATCHDOG_LOCK_DIR" 2>/dev/null` as the atomic test-and-set, then write `$$` inside it as `pid`. On cleanup, `rm -rf "$WATCHDOG_LOCK_DIR"`. Apply the same fix to `dev-worker.sh`. Run `pnpm typecheck`. Criterion #3 (no race conditions in singleton enforcement)
- [x] [FIX] Move health alert sentinel from `.dev/` to `/tmp/` — in `scripts/watchdog.sh` line 507, the health alert sentinel is written to `$DEV_DIR/health-alert-sent` (the project's `.dev/` directory). This creates an untracked git file in the working directory and pollutes the project state. All other runtime sentinel and lock files correctly live in `/tmp/skynet-*`. Fix: change line 507 from `local sentinel="$DEV_DIR/health-alert-sent"` to `local sentinel="/tmp/skynet-${SKYNET_PROJECT_NAME:-skynet}-health-alert-sent"`. This matches the existing convention for lock files (`$SKYNET_LOCK_PREFIX-*`). Run `pnpm typecheck`. Criterion #3 (clean project state — no transient files in `.dev/`)
- [x] [FIX] Replace `[[` with `case` in watchdog.sh for bash 3.2 style consistency — in `scripts/watchdog.sh` line 529, inside `_cleanup_stale_branches()`: `[[ "$branch" == dev/* ]] || continue`. While `[[` technically works in bash 3.2, the project's shell rules state bash 3.2 compatibility and the rest of the codebase uses `[ ... ]` exclusively. This is the only `[[` usage in the pipeline scripts (except `_compat.sh` for platform detection). Fix: replace with a `case` statement: `case "$branch" in dev/*) ;; *) continue ;; esac`. Run `bash -n scripts/watchdog.sh` and `pnpm typecheck` to verify. Criterion #1 (portability — consistent bash 3.2 style across all scripts)
- [x] [FIX] Add missing KNOWN_VARS entries for SKYNET_WORKER_CONTEXT, SKYNET_WORKER_CONVENTIONS, and SKYNET_WATCHDOG_INTERVAL — in `packages/cli/src/commands/config.ts` lines 11-59, the `KNOWN_VARS` dictionary (used for `skynet config list` descriptions) is missing 3 config variables that exist in the real config and are referenced in pipeline scripts. Add before the closing brace: `SKYNET_WORKER_CONTEXT: "Path to file with project-specific context injected into worker prompts"`, `SKYNET_WORKER_CONVENTIONS: "Path to file with coding conventions injected into worker prompts"`, `SKYNET_WATCHDOG_INTERVAL: "Seconds between watchdog monitoring cycles (default: 180)"`. This makes `skynet config list` show descriptions for ALL variables. Run `pnpm typecheck`. Criterion #1 (accurate developer tooling — no blank description rows)
- [x] [FIX] Fix `check-server-errors.sh` hardcoded log path breaking multi-worker server error scanning — `scripts/check-server-errors.sh` line 9 hardcodes `SERVER_LOG="$SCRIPTS_DIR/next-dev.log"` but `dev-worker.sh` creates per-worker logs at `$SCRIPTS_DIR/next-dev-w${WORKER_ID}.log`. This means the server error check (called at `dev-worker.sh` line 534) always exits early with "No server log found" — server errors are silently undetected. Fix: change line 9 to `SERVER_LOG="${1:-$SCRIPTS_DIR/next-dev.log}"` to accept an optional log path argument. In `dev-worker.sh` line 534, pass the worker-specific log: `bash "$SCRIPTS_DIR/check-server-errors.sh" "$SCRIPTS_DIR/next-dev-w${WORKER_ID}.log"`. This makes server error detection actually work for multi-worker setups. Run `pnpm typecheck` to verify no breakage. Criterion #3 (no silent failures)
- [x] [FIX] Fix `sync-runner.sh` pre-flight check using non-existent API route — `scripts/sync-runner.sh` line 28 checks `curl -sf "$BASE_URL/api/admin/sync-status"` but there is NO `/api/admin/sync-status` route in the admin package (the sync data comes from the pipeline-status handler). This means sync-runner ALWAYS fails the pre-flight check with "Dev server not reachable" even when the server is healthy — the sync logic has never successfully executed. Fix: change line 28 from `"$BASE_URL/api/admin/sync-status"` to `"$BASE_URL/api/admin/pipeline/status"` which exists and returns JSON. Run `pnpm typecheck` to verify. Criterion #3 (reliability — scripts should actually work)
- [x] [FIX] Add `tg` notification and `emit_event` when task-fixer escalates task to blocked — in `scripts/task-fixer.sh` lines 231-236, when `fix_attempts >= MAX_FIX_ATTEMPTS`, the script marks the task as `blocked` in failed-tasks.md and writes to blockers.md, but sends NO notification and emits NO event. Humans are never alerted when a task is permanently blocked. Fix: after line 234 (the `echo >> "$BLOCKERS"` line), add two lines: `tg "🚫 *${SKYNET_PROJECT_NAME_UPPER} TASK-FIXER F${FIXER_ID}* task BLOCKED after $MAX_FIX_ATTEMPTS attempts — $task_title"` and `emit_event "task_blocked" "Fixer $FIXER_ID: $task_title (max attempts)"`. Run `pnpm typecheck`. Criterion #2 (self-correction visibility) and #4 (dashboard event coverage)
- [x] [FIX] Add missing handler and type exports to `packages/dashboard/src/index.ts` — the root `index.ts` handler export block (lines 41-54) is missing `createEventsHandler` and `createMissionRawHandler` which were added after the initial block was written. The type export block (lines 2-29) is missing `SelfCorrectionStats` and `EventEntry`. Fix: add `createEventsHandler` and `createMissionRawHandler` to the handler re-export block. Add `SelfCorrectionStats` and `EventEntry` to the type re-export block. These are needed by external consumers importing from `@ajioncorp/skynet` root path (the admin app uses sub-path imports so it works, but any external Next.js app embedding the dashboard would get undefined). Run `pnpm typecheck`. Criterion #1 (correct npm package API surface)
- [x] [TEST] Add `changelog.test.ts` CLI unit test — `changelog.ts` is the only CLI command (1 of 25) with zero test coverage. Create `packages/cli/src/commands/__tests__/changelog.test.ts`. Mock `fs.readFileSync` to return sample completed.md with pipe-delimited entries across multiple dates and tags. Test: (a) groups entries by date with `## YYYY-MM-DD` headers, (b) organizes tasks under correct tag headings ([FEAT] → "Features", [FIX] → "Bug Fixes", [INFRA] → "Infrastructure", [TEST] → "Tests", [DOCS] → "Documentation"), (c) `--since` flag filters entries after given date, (d) `--output` flag writes to file path instead of stdout, (e) handles empty completed.md gracefully, (f) strips pipe delimiters and extra whitespace from task descriptions. Follow existing CLI test patterns in `init.test.ts`. Criterion #2 (complete CLI test coverage — 25/25 commands)
- [x] [INFRA] Add CI job dependency chain to save GitHub Actions minutes — in `.github/workflows/ci.yml`, add `needs:` to expensive jobs so they skip when fast checks fail. Add: `build` → `needs: [typecheck]`, `e2e-cli` → `needs: [typecheck, unit-test]`, `e2e-admin` → `needs: [typecheck, build]`. Currently all 7 jobs run in parallel — if `typecheck` fails (the most common failure mode), 6 other jobs still run for ~15 minutes before also failing. Keep `lint-sh` and `lint-ts` independent (fast, no deps). This saves CI minutes on failures while keeping the parallel-on-success benefit for lint jobs. Criterion #2 (efficient CI pipeline)
- [x] [FEAT] Add `skynet validate` CLI command for pre-flight project validation — create `packages/cli/src/commands/validate.ts`. Unlike `doctor` (which checks the pipeline itself), `validate` checks the TARGET project's readiness: (a) parse `SKYNET_GATE_N` variables from config and dry-run each gate command, reporting pass/fail per gate, (b) verify git remote is accessible via `git ls-remote origin HEAD`, (c) check disk space in project dir (warn if < 1GB free), (d) verify `.dev/mission.md` exists and has content. Print summary: "N/M pre-flight checks passed". Register as `program.command('validate').description('Run pre-flight checks for the target project')` in `packages/cli/src/index.ts`. This helps users verify their project is correctly set up BEFORE starting the pipeline. Criterion #1 (under 5 min to autonomous — validate catches config issues early)
- [x] [INFRA] Add Playwright E2E tests for events, logs, settings, and workers admin pages — in `packages/admin/e2e/`, extend `dashboard.spec.ts` or create `pages.spec.ts`. Add 4 test cases: (a) `/admin/events` page loads and shows events table with timestamp and type columns, (b) `/admin/logs` page loads and shows log type dropdown and monospace content area, (c) `/admin/settings` page loads and shows config key-value table with save button, (d) `/admin/workers` page loads and shows worker scaling controls with +/- buttons. These are the last 4 admin pages without E2E coverage (the other 6 are covered in `admin.spec.ts` and `dashboard.spec.ts`). Criterion #2 (complete admin E2E coverage) and #4 (verified dashboard visibility)
- [x] [FIX] Remove duplicate `_cleanup_stale_branches` function in watchdog.sh — `scripts/watchdog.sh` defines `_cleanup_stale_branches()` twice: first at line ~435 (handles fixed|superseded|blocked statuses, deletes local+remote branches for all resolved failed tasks) and again at line ~503 (only handles blocked entries with 24h+ age check against blockers.md). The first definition runs at line ~487 and already comprehensively handles ALL resolved statuses including blocked. The second definition at ~503 silently redefines the function, then runs at ~570 doing redundant work (blocked branches were already deleted by the first call). Fix: delete the second function definition — remove the comment block starting with `# --- Stale branch cleanup for permanently failed tasks ---` (line ~500) through the closing brace (line ~567), and delete its invocation `_cleanup_stale_branches` at line ~570. Also remove the `cd "$PROJECT_DIR"` line just before it (line ~569) since it's only needed by the second call. The first, comprehensive version already covers all cases. This is a real bug from two separate tasks being merged independently. Run `pnpm typecheck` to verify no breakage. Criterion #3 (clean code, no redundant logic)
- [x] [FIX] Update config.ts KNOWN_VARS dictionary with missing config variable descriptions — in `packages/cli/src/commands/config.ts`, the `KNOWN_VARS` object (lines 10-53) is missing descriptions for 5 config variables that were added to `templates/skynet.config.sh` after the dictionary was created. Add these entries before the closing brace on line 53: `SKYNET_AGENT_TIMEOUT_MINUTES: "Max minutes before agent process is killed (default: 45)"`, `SKYNET_HEALTH_ALERT_THRESHOLD: "Health score threshold for watchdog alerts (default: 50)"`, `SKYNET_MAX_EVENTS_LOG_KB: "Max events.log size in KB before rotation (default: 1024)"`, `SKYNET_MAX_FIXERS: "Maximum concurrent task-fixer instances (default: 3)"`, `SKYNET_DRIVER_BACKLOG_THRESHOLD: "Pending task count before project-driver generates more (default: 5)"`, `SKYNET_START_DEV_CMD: "Command to start the dev server (optional)"`. This makes `skynet config list` show descriptions for ALL variables instead of blanks for newer ones. Criterion #1 (accurate developer tooling)
- [x] [DOCS] Update README.md and packages/cli/README.md CLI reference tables with missing commands — the main `README.md` CLI Reference table (lines 36-56) lists 19 commands but is missing `export` ("Export pipeline state as a JSON snapshot"), `import` ("Restore pipeline state from an exported snapshot"), and `completions` ("Generate bash or zsh shell completions"). Add rows for all 3 after the `config` row. Also fix `SKYNET_MAX_WORKERS` default from `2` to `4` in the Configuration table (line 91) — this was fixed in `templates/skynet.config.sh` but the README was never updated. In `packages/cli/README.md`, add `import` ("Restore pipeline state from snapshot") and `completions` ("Generate shell completions for bash/zsh") to the Commands table after the `config` row. Update the total command count in any prose that mentions a specific number. Criterion #1 (accurate documentation)
- [x] [TEST] Add `completions.test.ts` CLI unit test — the `completions` command is the newest CLI addition and has zero test coverage. Create `packages/cli/src/commands/__tests__/completions.test.ts`. Test: (a) bash output contains `complete -W` with all registered command names (init, setup-agents, start, stop, etc.), (b) bash output contains `_skynet()` function definition and `COMPREPLY`, (c) zsh output starts with `#compdef skynet` and contains `_arguments`, (d) zsh output includes all registered commands, (e) invalid shell argument (e.g., "fish") produces error output or exits with non-zero, (f) installation hint is written to stderr. Mock `process.stdout.write` and `process.stderr.write`. Follow patterns in `init.test.ts` and `config.test.ts`. Criterion #2 (complete CLI test coverage — currently 21/23 commands tested)
- [x] [TEST] Add `test-notify.test.ts` CLI unit test — create `packages/cli/src/commands/__tests__/test-notify.test.ts`. Mock `child_process.execSync` for notify script execution and `fs.readFileSync` for config parsing. Test: (a) reads `SKYNET_NOTIFY_CHANNELS` from config and identifies enabled channels, (b) executes correct `scripts/notify/<channel>.sh` for each enabled channel, (c) `--channel telegram` tests only the specified channel, (d) reports per-channel OK/FAILED with captured output, (e) handles no configured channels with helpful message ("No notification channels configured"), (f) handles script execution failure (exit code != 0) gracefully with FAILED status. Follow existing CLI test patterns in `init.test.ts`. Criterion #2 (complete CLI test coverage)
- [x] [TEST] Add `AdminLayout.test.tsx` and `SkynetProvider.test.tsx` component tests — the last 2 untested dashboard components. Create `packages/dashboard/src/components/AdminLayout.test.tsx`: test renders sidebar navigation with all expected links (pipeline, tasks, monitoring, workers, logs, mission, events, settings, prompts, sync), test active link gets highlighted styling via pathname matching, test renders children content area correctly. Create `packages/dashboard/src/components/SkynetProvider.test.tsx`: test provides `apiPrefix` context value to children via `useSkynet()` hook, test default apiPrefix is empty string, test custom apiPrefix is passed through, test children render within provider. Use vitest + @testing-library/react. Follow existing component test patterns in `PipelineDashboard.test.tsx`. Criterion #2 (100% dashboard component test coverage — currently 11/13)
- [x] [TEST] Add `config-migrate.test.ts` CLI unit test for config migrate subcommand — create `packages/cli/src/commands/__tests__/config-migrate.test.ts`. Mock `fs.readFileSync` for both template config and user config files. Test: (a) detects missing variables by comparing template vs user config, (b) appends new variables with their default values and preceding comments from template, (c) reports "Added N new config variables: VAR1, VAR2" when variables are missing, (d) reports "Config is up to date" when all variables are present, (e) handles missing template file gracefully, (f) handles missing user config file with helpful error message. Follow existing CLI test patterns. Criterion #2 (test coverage for new config migrate feature)
- [x] [FEAT] Add `skynet init --from-snapshot` to bootstrap from exported state — in `packages/cli/src/commands/init.ts`, add `--from-snapshot <path>` option via `.option('--from-snapshot <path>', 'Initialize from a previously exported pipeline snapshot')`. When provided, after creating the `.dev/` directory structure and copying scripts (the normal init flow), read the JSON snapshot file (same format as `skynet export` output), validate it has expected keys (backlog.md, completed.md, etc.), and overwrite the default state files with the snapshot's content. Log which files were restored: "Restored N files from snapshot". Skip `skynet.config.sh` from the snapshot (machine-specific paths would be wrong — keep the freshly generated one). This enables duplicating a pipeline setup from one project to another, useful for teams adopting Skynet across multiple repositories. Criterion #1 (faster multi-project adoption)
- [x] [FEAT] Add `skynet changelog` CLI command for release note generation — create `packages/cli/src/commands/changelog.ts`. Reads `.dev/completed.md`, parses the pipe-delimited table, groups entries by date, organizes by tag ([FEAT] → "Features", [FIX] → "Bug Fixes", [INFRA] → "Infrastructure", [TEST] → "Tests", [DOCS] → "Documentation"). Output format: `## YYYY-MM-DD\n### Features\n- task description\n### Bug Fixes\n- task description\n...`. Default prints to stdout. Add `--output <path>` flag to write to a file. Add `--since <date>` flag to filter entries after a given date (useful for generating notes between releases). Register as `program.command('changelog').description('Generate changelog from completed tasks')` in `packages/cli/src/index.ts`. Criterion #5 (measurable mission progress → releasable artifact)
- [x] [TEST] Add `export.test.ts`, `dashboard.test.ts`, and `import.test.ts` CLI unit tests — the last 3 of 21 CLI commands without test coverage. Create in `packages/cli/src/commands/__tests__/`. For `export.test.ts`: mock `fs.readFileSync` for `.dev/` files, test JSON output contains all expected keys (backlog.md, completed.md, failed-tasks.md, blockers.md, mission.md, skynet.config.sh, events.log), test `--output` flag writes to custom path, test handles missing `.dev/` files gracefully (empty string value). For `dashboard.test.ts`: mock `child_process.spawn`, test launches pnpm dev command with correct `--port` argument, test default port is 3100, test `--port` flag overrides, test opens browser via `open` on macOS / `xdg-open` on Linux (mock `process.platform`). For `import.test.ts`: mock `fs.readFileSync` and `fs.writeFileSync`, test validates snapshot JSON has expected keys, test rejects invalid JSON, test `--dry-run` shows diff without writing, test `--merge` appends to .md files instead of overwriting, test `--force` skips confirmation prompt. Follow patterns in `init.test.ts` and `config.test.ts`. Criterion #2 (100% CLI test coverage)
- [x] [INFRA] Add agent execution timeout to prevent zombie agent processes — in `scripts/_agent.sh`, wrap the agent invocation with a configurable timeout. Add `SKYNET_AGENT_TIMEOUT_MINUTES="45"` to `templates/skynet.config.sh`. In the `run_agent()` function (currently in each plugin's `agent_run()`), prefix the agent command with a portable timeout: on Linux use `timeout ${timeout_secs}`, on macOS use `perl -e 'alarm shift; exec @ARGV' ${timeout_secs}` (bash 3.2 compatible, no GNU coreutils dependency). If the agent times out, return exit code 124 (standard timeout convention). In `scripts/dev-worker.sh`, after the agent call (~line 440), detect exit code 124 and log "Agent timed out after ${SKYNET_AGENT_TIMEOUT_MINUTES}m" before marking as failed. In `scripts/task-fixer.sh`, apply the same timeout wrapper. This prevents a single hung agent (network issue, infinite loop, LLM API outage) from blocking a worker slot indefinitely. Criterion #3 (no zombie processes)
- [x] [INFRA] Add automatic merge retry with rebase in dev-worker.sh — in `scripts/dev-worker.sh`, when `git merge "$branch_name" --no-edit` fails at line 550, instead of immediately marking the task as failed, attempt recovery: (a) `git merge --abort`, (b) `git pull origin main` to get latest, (c) `git checkout "$branch_name"`, (d) `git rebase main` — if rebase succeeds, checkout main and retry merge. Add a retry counter (max 1 rebase attempt). If rebase itself has conflicts, `git rebase --abort` and proceed to fail the task as before. Log "Merge conflict — attempting rebase recovery..." for visibility. Currently ~15% of task failures are merge conflicts from concurrent workers, all of which go to the task-fixer for a full retry cycle. Inline rebase recovery would resolve most of these in seconds instead of minutes, directly improving throughput and reducing API credit usage. Criterion #2 (self-correction) and #3 (reliability)
- [x] [FEAT] Add shell completions for bash and zsh — create `packages/cli/src/commands/completions.ts`. Register as `program.command('completions').description('Generate shell completions')` with `.argument('<shell>', 'Shell type: bash or zsh')` in `packages/cli/src/index.ts`. For bash: output a `complete -W "<all-commands>" skynet` script plus per-command flag completions using `_skynet()` function with `COMPREPLY`. For zsh: output a `#compdef skynet` script using `_arguments` with all 22 commands and their flags. Include all registered commands: init, setup-agents, start, stop, pause, resume, status, doctor, logs, version, add-task, run, dashboard, reset-task, cleanup, watch, upgrade, metrics, export, import, config, completions. Print installation hint to stderr: "# Add to ~/.bashrc: eval \"$(skynet completions bash)\"". Criterion #1 (developer experience — tab completion for 22 commands)
- [x] [FEAT] Add `skynet test-notify` CLI command for notification channel verification — create `packages/cli/src/commands/test-notify.ts`. Read `SKYNET_NOTIFY_CHANNELS` from `.dev/skynet.config.sh` (parse same way as config.ts). For each enabled channel (telegram, slack, discord), execute the corresponding notify script (`scripts/notify/<channel>.sh`) with a test message: "Skynet test notification from <project_name> at <ISO timestamp>". Capture stdout/stderr and report per-channel: "telegram: OK" or "slack: FAILED (connection refused)". Add `--channel <name>` flag to test a single channel. If no channels are configured, print "No notification channels configured. Set SKYNET_NOTIFY_CHANNELS in skynet.config.sh". Register in `packages/cli/src/index.ts`. Criterion #1 (verify notification setup before going live)
- [x] [INFRA] Add SSE auto-reconnection with backoff to PipelineDashboard — in `packages/dashboard/src/components/PipelineDashboard.tsx`, the `EventSource` SSE connection has no reconnection handling — if the server restarts or network blips, the dashboard silently stops updating. Add: (a) `onerror` handler that closes the failed connection and schedules a reconnect with exponential backoff (1s → 2s → 4s → 8s, max 30s), (b) reset backoff timer on successful `onmessage`, (c) add a `connectionStatus` state variable ('connected' | 'reconnecting' | 'disconnected') displayed as a small colored indicator (green/yellow/red dot) next to the page title, (d) handle `document.visibilitychange` — close SSE when tab is hidden, reopen when visible to save server resources. Keep the existing polling fallback intact for browsers that don't support SSE. Criterion #4 (reliable real-time dashboard visibility)
- [x] [FEAT] Add config auto-migration to detect and add new variables on upgrade — in `packages/cli/src/commands/config.ts`, add a `migrate` subcommand: `skynet config migrate`. Reads the installed template (`templates/skynet.config.sh` relative to CLI package) and the user's `.dev/skynet.config.sh`. For each `SKYNET_*` variable defined in the template that is absent from the user's config, append it with its default value and preceding comment (copy the template's comment block). Print "Added N new config variables: VAR1, VAR2, ...". If all variables exist, print "Config is up to date". Also wire this into `packages/cli/src/commands/upgrade.ts` — after a successful npm upgrade, automatically run config migration and report results. This solves the "silent missing config" problem when users upgrade and new config variables (like `SKYNET_HEALTH_ALERT_THRESHOLD`, `SKYNET_AGENT_TIMEOUT_MINUTES`) were added in the newer version. Criterion #1 (smooth upgrade path)
- [x] [TEST] Expand E2E CLI test suite with export/import round-trip and doctor --fix verification — in `tests/e2e/cli-commands.test.sh`, add 3 new test cases after the existing ones: (a) **Export/import round-trip**: run `skynet export --output /tmp/skynet-test-export.json`, verify JSON file exists and contains expected keys, then modify backlog.md (add a test line), run `skynet import /tmp/skynet-test-export.json --force`, verify backlog.md was restored to pre-modification state. (b) **Doctor --fix**: create a stale `.dev/worker-99.heartbeat` file with epoch 0, run `skynet doctor` and verify WARN for stale heartbeat, run `skynet doctor --fix` and verify the stale file was deleted, re-run `skynet doctor` and verify PASS. (c) **Config set/get round-trip**: run `skynet config set SKYNET_MAX_WORKERS 6`, then `skynet config get SKYNET_MAX_WORKERS` and verify output is "6", then restore original value. These are the last untested CLI workflows. Criterion #2 (comprehensive E2E coverage)
- [x] [TEST] Add `status.test.ts` CLI unit test — `status.ts` is the most complex CLI command (400+ lines) with zero dedicated tests. Create `packages/cli/src/commands/__tests__/status.test.ts`. Mock `fs.readFileSync` for all `.dev/` state files (backlog.md, completed.md, failed-tasks.md, current-task-N.md, worker-N.heartbeat, skynet.config.sh). Test: (a) `--json` flag outputs valid JSON matching `{ project, paused, tasks, workers, healthScore, selfCorrectionRate, missionProgress, lastActivity }` shape, (b) `--quiet` flag outputs only the health score number, (c) health score calculation returns 100 with no failures/blockers/stale heartbeats, (d) health score deductions are correct (5 per pending failure, 10 per blocker, 2 per stale heartbeat), (e) worker heartbeat detection loops through all N workers (not just 2), (f) mission progress parsing shows all 6 criteria. Follow patterns in existing CLI tests (`init.test.ts`, `doctor.test.ts`). Criterion #2
- [x] [DOCS] Add npm package README for @ajioncorp/skynet-cli — create `packages/cli/README.md`. Sections: (1) **One-line description**: "CLI for Skynet — autonomous AI development pipeline". (2) **Installation**: `npm install -g @ajioncorp/skynet-cli`. (3) **Quick Start**: 4 lines — `skynet init --name my-project`, `skynet setup-agents`, `skynet start`, `skynet watch`. (4) **Commands**: table of all 21 commands (init, setup-agents, start, stop, pause, resume, status, doctor, logs, version, add-task, run, dashboard, reset-task, cleanup, watch, upgrade, metrics, export, config) with brief one-line descriptions. (5) **Configuration**: key `skynet.config.sh` variables (SKYNET_MAX_WORKERS, SKYNET_STALE_MINUTES, SKYNET_AGENT_PLUGIN, SKYNET_GATE_N). (6) **Dashboard**: `skynet dashboard` launches admin UI on port 3100. (7) **Links**: link to main repo README and CONTRIBUTING.md. Keep under 120 lines. Also add `"README.md"` to the `files` array in `packages/cli/package.json` so it ships with the npm tarball. The npm package currently has NO readme — the npmjs.com page is blank. Criterion #1 (developer experience for npm users)
- [x] [TEST] Add `logs.test.ts`, `start.test.ts`, `stop.test.ts`, and `version.test.ts` CLI unit tests — create 4 test files in `packages/cli/src/commands/__tests__/`. For `logs.test.ts`: mock `fs.readdirSync` and `fs.readFileSync` for log file listing, test `--tail N` reads last N lines, test `--follow` sets up `fs.watch`, test missing log directory returns helpful message, test `--id` flag selects correct worker log. For `start.test.ts`: mock `child_process.spawn`, test launches watchdog.sh, test detects already-running via PID lock file. For `stop.test.ts`: mock `fs.readFileSync` for PID files, test sends SIGTERM to workers, test handles missing PID files gracefully. For `version.test.ts`: mock package.json read, test outputs version string, mock `execSync` for npm update check, test outdated version suggests upgrade command. Follow existing CLI test patterns in `init.test.ts`. Criterion #2
- [x] [TEST] Add `pause.test.ts`, `resume.test.ts`, `reset-task.test.ts`, and `setup-agents.test.ts` CLI unit tests — create 4 test files in `packages/cli/src/commands/__tests__/`. For `pause.test.ts`: test creates `.dev/pipeline-paused` sentinel file with correct JSON shape `{ pausedAt, pausedBy }`, test no-op when already paused with appropriate message. For `resume.test.ts`: test removes sentinel file, test no-op when not paused. For `reset-task.test.ts`: test fuzzy-matches task title substring in failed-tasks.md, test resets status to pending and attempts to 0, test updates backlog.md entry from `[x]` to `[ ]`, test `--force` flag deletes stale branch. For `setup-agents.test.ts`: test generates launchd plist files on darwin (mock `process.platform`), test generates crontab entries on linux, test `--uninstall` removes agents, test `--dry-run` shows what would be installed. Mock `fs`, `child_process`, and `process.platform`. Criterion #2
- [x] [INFRA] Add standalone `build` verification job to CI workflow — in `.github/workflows/ci.yml`, add a `build` job that runs `pnpm build` to compile all TypeScript packages (admin, dashboard, CLI). Currently `pnpm build` is only run implicitly as part of the `e2e-admin` job, meaning build failures can be masked by earlier job failures. The new job should run after `install` (same pnpm store cache pattern as other jobs). Steps: checkout, setup Node 20, setup pnpm, `pnpm install`, `pnpm build`. This catches TypeScript compilation errors that `pnpm typecheck` might miss (since typecheck doesn't emit files). Criterion #2 (catching build errors before merge)
- [x] [INFRA] Add health score alert notification to watchdog — in `scripts/watchdog.sh`, after the crash recovery and stale detection phases, compute a simple health score using the same logic as the pipeline-status handler: start at 100, subtract 5 per pending failed task (grep `status=pending` in failed-tasks.md), subtract 10 per active blocker (count non-empty lines under `## Active` in blockers.md), subtract 2 per stale heartbeat. If score drops below `${SKYNET_HEALTH_ALERT_THRESHOLD:-50}`, call `emit_event "health_alert" "Health score: $score"` and `notify_all "Pipeline health alert: score $score/100"`. Use a sentinel file `.dev/health-alert-sent` to prevent repeated alerts — only alert once per drop, delete sentinel when score recovers above threshold. Add `SKYNET_HEALTH_ALERT_THRESHOLD="50"` to `templates/skynet.config.sh` with comment. Criterion #3 (proactive failure detection)
- [x] [INFRA] Add project-driver backlog deduplication check — in `scripts/project-driver.sh`, after the LLM generates new tasks (the `claude` command output) but before appending them to backlog.md, check each new task line against existing pending `[ ]` and claimed `[>]` entries in the current backlog. Normalize comparison: strip tags (`[FEAT]`, `[FIX]`, etc.), lowercase, remove extra whitespace, take first 60 characters. Skip any new task whose normalized prefix matches an existing entry. Log "Skipped duplicate: <title>" for each skipped task. This prevents the project-driver from regenerating tasks that are already in the backlog or in progress, which wastes worker cycles. Criterion #3 (clean state, no wasted effort)
- [x] [FEAT] Add `skynet doctor --fix` auto-remediation mode — in `packages/cli/src/commands/doctor.ts`, add `--fix` boolean option. When a check fails and has a known remediation: (a) stale heartbeats → delete the stale `.dev/worker-N.heartbeat` file, (b) orphaned worktrees → run `git worktree prune` via `execSync`, (c) orphaned claimed tasks (claimed `[>]` in backlog but no matching worker) → reset from `[>]` to `[ ]` in backlog.md, (d) missing required config vars → append defaults from template. Print "Auto-fixed N issues" summary. Without `--fix`, behavior is unchanged (report only). Register the flag via `.option('--fix', 'Auto-fix issues where possible')`. Criterion #1 (self-healing accessible to users) and #3 (faster recovery)
- [x] [FEAT] Add `skynet import` CLI command for restoring pipeline state from snapshot — create `packages/cli/src/commands/import.ts`. Reads a JSON snapshot file (produced by `skynet export`), validates it has expected keys (backlog.md, completed.md, failed-tasks.md, blockers.md, mission.md, skynet.config.sh), then writes each key's string value back to the corresponding `.dev/` file. Add `--dry-run` flag that shows which files would be overwritten and their size changes without writing. Add `--merge` flag that appends rather than overwrites for .md files. Prompt for confirmation before overwriting (unless `--force` flag). Register in `packages/cli/src/index.ts`. Criterion #1 (complete state management lifecycle — export + import)
- [x] [FEAT] Wire emit_event() calls into dev-worker.sh, task-fixer.sh, and watchdog.sh — THIRD attempt. Criterion #4
- [x] [FEAT] Add EventsDashboard component and `/admin/events` page. Criterion #4
- [x] [DOCS] Update README CLI reference with run, watch, upgrade, and metrics commands. Criterion #1
- [x] [FEAT] Add `skynet metrics` CLI command for pipeline performance analytics. Criterion #5
- [x] [INFRA] Add pipeline velocity metrics to project-driver.sh prompt context. Criterion #3 and #5
- [x] [TEST] Add CLI unit tests for watch, run, upgrade, and cleanup commands. Criterion #2
- [x] [FIX] Delete stale dev/* branches for all superseded failed tasks. Criterion #3
- [x] [TEST] Add EventsDashboard component tests. Criterion #2
- [x] [TEST] Add `metrics.test.ts` CLI unit test. Criterion #2
- [x] [FEAT] Add `skynet export` CLI command for pipeline state snapshot. Criterion #1
- [x] [FIX] Fix mission criterion #2 evaluation formula in CLI status and pipeline-status handler
- [x] [TEST] Add events handler unit tests and ActivityFeed component tests — FRESH implementation
- [x] [TEST] Add vitest component tests for SettingsDashboard, WorkerScaling, and LogViewer
- [x] [TEST] Add vitest component tests for PipelineDashboard, TasksDashboard, and MissionDashboard
- [x] [FEAT] Add JSON output mode to `skynet status` for programmatic access — FRESH implementation
- [x] [TEST] Add component tests for MonitoringDashboard, PromptsDashboard, and SyncDashboard
- [x] [INFRA] Add events.log rotation to _events.sh to prevent unbounded growth
- [x] [TEST] Add vitest unit tests for core CLI commands
- [x] [FEAT] Add `skynet watch` command for real-time terminal monitoring
- [x] [FEAT] Add `skynet setup-agents --uninstall` for clean agent removal
- [x] [DOCS] Add CONTRIBUTING.md with agent plugin and extension guide
- [x] [FEAT] Add `skynet upgrade` CLI command for self-update
- [x] [FEAT] Add `skynet run` CLI command for one-shot task execution
- [x] [FEAT] Build events TypeScript handler, API route, and ActivityFeed dashboard component
- [x] [FIX] Adjust self-correction rate formula to count superseded tasks as pipeline self-correction
- [x] [FIX] Update README CLI reference to include pause, resume, and config commands
- [x] [TEST] Add config handler unit tests
- [x] [FIX] Fix CLI status command hardcoded worker heartbeat and worker list
- [x] [FEAT] Add self-correction rate calculation to pipeline-status and dashboard
- [x] [FEAT] Add graceful shutdown signal handling to dev-worker.sh and task-fixer.sh
- [x] [FEAT] Add `skynet pause` and `skynet resume` CLI commands — FRESH implementation
- [x] [INFRA] Extend watchdog stale branch cleanup to handle fixed and superseded tasks — FRESH implementation
- [x] [FEAT] Add pipeline completion detection and mission-complete notification
- [x] [FIX] Supersede stale pending failed-task entries for already-completed functionality
- [x] [DOCS] Add troubleshooting section to README.md
- [x] [FEAT] Add mission progress tracking to pipeline-status handler — FRESH implementation
- [x] [FEAT] Add mission viewer page to admin dashboard — FRESH implementation
- [x] [FIX] Fix watchdog crash_recovery and dispatch hardcoded worker IDs — FRESH implementation
- [x] [FIX] Add error boundaries and loading states to admin dashboard pages
- [x] [TEST] Add end-to-end test for full CLI command integration
- [x] [FEAT] Add `skynet config` CLI command for viewing and editing configuration
- [x] [FEAT] Add task retry budget and fixer cooldown to prevent infinite fix loops
- [x] [INFRA] Enhance `skynet doctor` with runtime consistency checks
- [x] [FIX] Wire WorkerScaling component into admin dashboard navigation
- [x] [FEAT] Add log viewer page to admin dashboard for live log viewing
- [x] [INFRA] Add Playwright E2E test job to CI workflow
- [x] [FIX] Fix SKYNET_MAX_WORKERS default mismatch between config template and watchdog
- [x] [TEST] Add unit tests for untested dashboard handlers
- [x] [FIX] Harden project-driver.sh against missing .dev/ state files
- [x] [FEAT] Add interactive mission template generator to `skynet init`
- [x] [INFRA] Add ESLint with TypeScript support to CI pipeline
- [x] [FEAT] Add `/admin/settings` page for config editing via dashboard
- [x] [TEST] Add mission-raw and pipeline-stream handler unit tests
- [x] [TEST] Add worker-scaling handler unit tests
- [x] [TEST] Add Playwright e2e tests for admin dashboard core flows
- [x] [FEAT] Add `skynet cleanup` CLI command for branch and worktree maintenance
- [x] [FIX] Inject previous failure context into task-fixer retry prompts
- [x] [FIX] Fix task-fixer reading only dev-worker-1.log regardless of which worker failed
- [x] [FEAT] Add `skynet logs` CLI command
- [x] [FEAT] Add `skynet add-task` CLI command
- [x] [FEAT] Add notification channel plugin system
- [x] [FEAT] Add `skynet dashboard` CLI command to launch admin app
- [x] [FEAT] Add pipeline health score to dashboard and `skynet status`
- [x] [INFRA] Add `npx skynet init` end-to-end smoke test
- [x] [FEAT] Add `skynet reset-task` CLI command
- [x] [FEAT] Add worker activity log rotation
- [x] [TEST] Add vitest unit tests for dashboard health score and task parsing
- [x] [FEAT] Add `skynet version` CLI command with update check
- [x] [FIX] Fix CLI scripts path resolution for npm package distribution
- [x] [FIX] Add PID lock to health-check.sh to prevent concurrent instances
- [x] [FIX] Harden task-fixer.sh EXIT trap for mid-merge crash safety
- [x] [FEAT] Add `skynet doctor` CLI diagnostics command
- [x] [FEAT] Add worker port offset to prevent dev-server conflicts
- [x] [FEAT] Add Linux cron support to monitoring agents dashboard handler — FRESH implementation
- [x] [FEAT] Add dynamic worker scaling from admin dashboard
- [x] [FEAT] Add backlog health validation to watchdog
- [x] [FEAT] Add task duration tracking to completed.md
- [x] [INFRA] Add root `test` script and CI unit test job
- [x] [FEAT] Add configurable quality gates via skynet.config.sh
- [x] [FEAT] Add `skynet status` CLI command
- [x] [FEAT] Add worker heartbeat and stale detection
- [x] [FEAT] Add agent plugin system for LLM-agnostic workers
- [x] [INFRA] Add shellcheck linting for all shell scripts
- [x] [FIX] Add merge conflict detection and fresh-branch retry to task-fixer
- [x] [DOCS] Add repository README.md with quickstart and architecture
- [x] [FEAT] Add task dependency tracking
- [x] [FEAT] Add real-time pipeline dashboard via Server-Sent Events
- [x] [FEAT] Add crash recovery to watchdog
- [x] [FEAT] Add `skynet start` and `skynet stop` CLI commands
- [x] [INFRA] Add npm package build and publish workflow
- [x] [INFRA] Add cron support alongside launchd
