# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [x] [TEST] Add `export.test.ts`, `dashboard.test.ts`, and `import.test.ts` CLI unit tests — the last 3 of 21 CLI commands without test coverage. Create in `packages/cli/src/commands/__tests__/`. For `export.test.ts`: mock `fs.readFileSync` for `.dev/` files, test JSON output contains all expected keys (backlog.md, completed.md, failed-tasks.md, blockers.md, mission.md, skynet.config.sh, events.log), test `--output` flag writes to custom path, test handles missing `.dev/` files gracefully (empty string value). For `dashboard.test.ts`: mock `child_process.spawn`, test launches pnpm dev command with correct `--port` argument, test default port is 3100, test `--port` flag overrides, test opens browser via `open` on macOS / `xdg-open` on Linux (mock `process.platform`). For `import.test.ts`: mock `fs.readFileSync` and `fs.writeFileSync`, test validates snapshot JSON has expected keys, test rejects invalid JSON, test `--dry-run` shows diff without writing, test `--merge` appends to .md files instead of overwriting, test `--force` skips confirmation prompt. Follow patterns in `init.test.ts` and `config.test.ts`. Criterion #2 (100% CLI test coverage)
- [x] [INFRA] Add agent execution timeout to prevent zombie agent processes — in `scripts/_agent.sh`, wrap the agent invocation with a configurable timeout. Add `SKYNET_AGENT_TIMEOUT_MINUTES="45"` to `templates/skynet.config.sh`. In the `run_agent()` function (currently in each plugin's `agent_run()`), prefix the agent command with a portable timeout: on Linux use `timeout ${timeout_secs}`, on macOS use `perl -e 'alarm shift; exec @ARGV' ${timeout_secs}` (bash 3.2 compatible, no GNU coreutils dependency). If the agent times out, return exit code 124 (standard timeout convention). In `scripts/dev-worker.sh`, after the agent call (~line 440), detect exit code 124 and log "Agent timed out after ${SKYNET_AGENT_TIMEOUT_MINUTES}m" before marking as failed. In `scripts/task-fixer.sh`, apply the same timeout wrapper. This prevents a single hung agent (network issue, infinite loop, LLM API outage) from blocking a worker slot indefinitely. Criterion #3 (no zombie processes)
- [x] [INFRA] Add automatic merge retry with rebase in dev-worker.sh — in `scripts/dev-worker.sh`, when `git merge "$branch_name" --no-edit` fails at line 550, instead of immediately marking the task as failed, attempt recovery: (a) `git merge --abort`, (b) `git pull origin main` to get latest, (c) `git checkout "$branch_name"`, (d) `git rebase main` — if rebase succeeds, checkout main and retry merge. Add a retry counter (max 1 rebase attempt). If rebase itself has conflicts, `git rebase --abort` and proceed to fail the task as before. Log "Merge conflict — attempting rebase recovery..." for visibility. Currently ~15% of task failures are merge conflicts from concurrent workers, all of which go to the task-fixer for a full retry cycle. Inline rebase recovery would resolve most of these in seconds instead of minutes, directly improving throughput and reducing API credit usage. Criterion #2 (self-correction) and #3 (reliability)
- [x] [FEAT] Add shell completions for bash and zsh — create `packages/cli/src/commands/completions.ts`. Register as `program.command('completions').description('Generate shell completions')` with `.argument('<shell>', 'Shell type: bash or zsh')` in `packages/cli/src/index.ts`. For bash: output a `complete -W "<all-commands>" skynet` script plus per-command flag completions using `_skynet()` function with `COMPREPLY`. For zsh: output a `#compdef skynet` script using `_arguments` with all 22 commands and their flags. Include all registered commands: init, setup-agents, start, stop, pause, resume, status, doctor, logs, version, add-task, run, dashboard, reset-task, cleanup, watch, upgrade, metrics, export, import, config, completions. Print installation hint to stderr: "# Add to ~/.bashrc: eval \"$(skynet completions bash)\"". Criterion #1 (developer experience — tab completion for 22 commands)
- [>] [FEAT] Add `skynet test-notify` CLI command for notification channel verification — create `packages/cli/src/commands/test-notify.ts`. Read `SKYNET_NOTIFY_CHANNELS` from `.dev/skynet.config.sh` (parse same way as config.ts). For each enabled channel (telegram, slack, discord), execute the corresponding notify script (`scripts/notify/<channel>.sh`) with a test message: "Skynet test notification from <project_name> at <ISO timestamp>". Capture stdout/stderr and report per-channel: "telegram: OK" or "slack: FAILED (connection refused)". Add `--channel <name>` flag to test a single channel. If no channels are configured, print "No notification channels configured. Set SKYNET_NOTIFY_CHANNELS in skynet.config.sh". Register in `packages/cli/src/index.ts`. Criterion #1 (verify notification setup before going live)
- [x] [INFRA] Add SSE auto-reconnection with backoff to PipelineDashboard — in `packages/dashboard/src/components/PipelineDashboard.tsx`, the `EventSource` SSE connection has no reconnection handling — if the server restarts or network blips, the dashboard silently stops updating. Add: (a) `onerror` handler that closes the failed connection and schedules a reconnect with exponential backoff (1s → 2s → 4s → 8s, max 30s), (b) reset backoff timer on successful `onmessage`, (c) add a `connectionStatus` state variable ('connected' | 'reconnecting' | 'disconnected') displayed as a small colored indicator (green/yellow/red dot) next to the page title, (d) handle `document.visibilitychange` — close SSE when tab is hidden, reopen when visible to save server resources. Keep the existing polling fallback intact for browsers that don't support SSE. Criterion #4 (reliable real-time dashboard visibility)
- [>] [FEAT] Add config auto-migration to detect and add new variables on upgrade — in `packages/cli/src/commands/config.ts`, add a `migrate` subcommand: `skynet config migrate`. Reads the installed template (`templates/skynet.config.sh` relative to CLI package) and the user's `.dev/skynet.config.sh`. For each `SKYNET_*` variable defined in the template that is absent from the user's config, append it with its default value and preceding comment (copy the template's comment block). Print "Added N new config variables: VAR1, VAR2, ...". If all variables exist, print "Config is up to date". Also wire this into `packages/cli/src/commands/upgrade.ts` — after a successful npm upgrade, automatically run config migration and report results. This solves the "silent missing config" problem when users upgrade and new config variables (like `SKYNET_HEALTH_ALERT_THRESHOLD`, `SKYNET_AGENT_TIMEOUT_MINUTES`) were added in the newer version. Criterion #1 (smooth upgrade path)
- [>] [TEST] Expand E2E CLI test suite with export/import round-trip and doctor --fix verification — in `tests/e2e/cli-commands.test.sh`, add 3 new test cases after the existing ones: (a) **Export/import round-trip**: run `skynet export --output /tmp/skynet-test-export.json`, verify JSON file exists and contains expected keys, then modify backlog.md (add a test line), run `skynet import /tmp/skynet-test-export.json --force`, verify backlog.md was restored to pre-modification state. (b) **Doctor --fix**: create a stale `.dev/worker-99.heartbeat` file with epoch 0, run `skynet doctor` and verify WARN for stale heartbeat, run `skynet doctor --fix` and verify the stale file was deleted, re-run `skynet doctor` and verify PASS. (c) **Config set/get round-trip**: run `skynet config set SKYNET_MAX_WORKERS 6`, then `skynet config get SKYNET_MAX_WORKERS` and verify output is "6", then restore original value. These are the last untested CLI workflows. Criterion #2 (comprehensive E2E coverage)

- [x] [TEST] Add `status.test.ts` CLI unit test — `status.ts` is the most complex CLI command (400+ lines) with zero dedicated tests. Create `packages/cli/src/commands/__tests__/status.test.ts`. Mock `fs.readFileSync` for all `.dev/` state files (backlog.md, completed.md, failed-tasks.md, current-task-N.md, worker-N.heartbeat, skynet.config.sh). Test: (a) `--json` flag outputs valid JSON matching `{ project, paused, tasks, workers, healthScore, selfCorrectionRate, missionProgress, lastActivity }` shape, (b) `--quiet` flag outputs only the health score number, (c) health score calculation returns 100 with no failures/blockers/stale heartbeats, (d) health score deductions are correct (5 per pending failure, 10 per blocker, 2 per stale heartbeat), (e) worker heartbeat detection loops through all N workers (not just 2), (f) mission progress parsing shows all 6 criteria. Follow patterns in existing CLI tests (`init.test.ts`, `doctor.test.ts`). Criterion #2
- [x] [DOCS] Add npm package README for @ajioncorp/skynet-cli — create `packages/cli/README.md`. Sections: (1) **One-line description**: "CLI for Skynet — autonomous AI development pipeline". (2) **Installation**: `npm install -g @ajioncorp/skynet-cli`. (3) **Quick Start**: 4 lines — `skynet init --name my-project`, `skynet setup-agents`, `skynet start`, `skynet watch`. (4) **Commands**: table of all 21 commands (init, setup-agents, start, stop, pause, resume, status, doctor, logs, version, add-task, run, dashboard, reset-task, cleanup, watch, upgrade, metrics, export, config) with brief one-line descriptions. (5) **Configuration**: key `skynet.config.sh` variables (SKYNET_MAX_WORKERS, SKYNET_STALE_MINUTES, SKYNET_AGENT_PLUGIN, SKYNET_GATE_N). (6) **Dashboard**: `skynet dashboard` launches admin UI on port 3100. (7) **Links**: link to main repo README and CONTRIBUTING.md. Keep under 120 lines. Also add `"README.md"` to the `files` array in `packages/cli/package.json` so it ships with the npm tarball. The npm package currently has NO readme — the npmjs.com page is blank. Criterion #1 (developer experience for npm users)
- [x] [TEST] Add `logs.test.ts`, `start.test.ts`, `stop.test.ts`, and `version.test.ts` CLI unit tests — create 4 test files in `packages/cli/src/commands/__tests__/`. For `logs.test.ts`: mock `fs.readdirSync` and `fs.readFileSync` for log file listing, test `--tail N` reads last N lines, test `--follow` sets up `fs.watch`, test missing log directory returns helpful message, test `--id` flag selects correct worker log. For `start.test.ts`: mock `child_process.spawn`, test launches watchdog.sh, test detects already-running via PID lock file. For `stop.test.ts`: mock `fs.readFileSync` for PID files, test sends SIGTERM to workers, test handles missing PID files gracefully. For `version.test.ts`: mock package.json read, test outputs version string, mock `execSync` for npm update check, test outdated version suggests upgrade command. Follow existing CLI test patterns in `init.test.ts`. Criterion #2
- [x] [TEST] Add `pause.test.ts`, `resume.test.ts`, `reset-task.test.ts`, and `setup-agents.test.ts` CLI unit tests — create 4 test files in `packages/cli/src/commands/__tests__/`. For `pause.test.ts`: test creates `.dev/pipeline-paused` sentinel file with correct JSON shape `{ pausedAt, pausedBy }`, test no-op when already paused with appropriate message. For `resume.test.ts`: test removes sentinel file, test no-op when not paused. For `reset-task.test.ts`: test fuzzy-matches task title substring in failed-tasks.md, test resets status to pending and attempts to 0, test updates backlog.md entry from `[x]` to `[ ]`, test `--force` flag deletes stale branch. For `setup-agents.test.ts`: test generates launchd plist files on darwin (mock `process.platform`), test generates crontab entries on linux, test `--uninstall` removes agents, test `--dry-run` shows what would be installed. Mock `fs`, `child_process`, and `process.platform`. Criterion #2
- [x] [INFRA] Add standalone `build` verification job to CI workflow — in `.github/workflows/ci.yml`, add a `build` job that runs `pnpm build` to compile all TypeScript packages (admin, dashboard, CLI). Currently `pnpm build` is only run implicitly as part of the `e2e-admin` job, meaning build failures can be masked by earlier job failures. The new job should run after `install` (same pnpm store cache pattern as other jobs). Steps: checkout, setup Node 20, setup pnpm, `pnpm install`, `pnpm build`. This catches TypeScript compilation errors that `pnpm typecheck` might miss (since typecheck doesn't emit files). Criterion #2 (catching build errors before merge)
- [x] [INFRA] Add health score alert notification to watchdog — in `scripts/watchdog.sh`, after the crash recovery and stale detection phases, compute a simple health score using the same logic as the pipeline-status handler: start at 100, subtract 5 per pending failed task (grep `status=pending` in failed-tasks.md), subtract 10 per active blocker (count non-empty lines under `## Active` in blockers.md), subtract 2 per stale heartbeat. If score drops below `${SKYNET_HEALTH_ALERT_THRESHOLD:-50}`, call `emit_event "health_alert" "Health score: $score"` and `notify_all "Pipeline health alert: score $score/100"`. Use a sentinel file `.dev/health-alert-sent` to prevent repeated alerts — only alert once per drop, delete sentinel when score recovers above threshold. Add `SKYNET_HEALTH_ALERT_THRESHOLD="50"` to `templates/skynet.config.sh` with comment. Criterion #3 (proactive failure detection)
- [x] [INFRA] Add project-driver backlog deduplication check — in `scripts/project-driver.sh`, after the LLM generates new tasks (the `claude` command output) but before appending them to backlog.md, check each new task line against existing pending `[ ]` and claimed `[>]` entries in the current backlog. Normalize comparison: strip tags (`[FEAT]`, `[FIX]`, etc.), lowercase, remove extra whitespace, take first 60 characters. Skip any new task whose normalized prefix matches an existing entry. Log "Skipped duplicate: <title>" for each skipped task. This prevents the project-driver from regenerating tasks that are already in the backlog or in progress, which wastes worker cycles. Criterion #3 (clean state, no wasted effort)
- [x] [FEAT] Add `skynet doctor --fix` auto-remediation mode — in `packages/cli/src/commands/doctor.ts`, add `--fix` boolean option. When a check fails and has a known remediation: (a) stale heartbeats → delete the stale `.dev/worker-N.heartbeat` file, (b) orphaned worktrees → run `git worktree prune` via `execSync`, (c) orphaned claimed tasks (claimed `[>]` in backlog but no matching worker) → reset from `[>]` to `[ ]` in backlog.md, (d) missing required config vars → append defaults from template. Print "Auto-fixed N issues" summary. Without `--fix`, behavior is unchanged (report only). Register the flag via `.option('--fix', 'Auto-fix issues where possible')`. Criterion #1 (self-healing accessible to users) and #3 (faster recovery)
- [x] [FEAT] Add `skynet import` CLI command for restoring pipeline state from snapshot — create `packages/cli/src/commands/import.ts`. Reads a JSON snapshot file (produced by `skynet export`), validates it has expected keys (backlog.md, completed.md, failed-tasks.md, blockers.md, mission.md, skynet.config.sh), then writes each key's string value back to the corresponding `.dev/` file. Add `--dry-run` flag that shows which files would be overwritten and their size changes without writing. Add `--merge` flag that appends rather than overwrites for .md files. Prompt for confirmation before overwriting (unless `--force` flag). Register in `packages/cli/src/index.ts`. Criterion #1 (complete state management lifecycle — export + import)

- [x] [FEAT] Wire emit_event() calls into dev-worker.sh, task-fixer.sh, and watchdog.sh — THIRD attempt. Criterion #4
- [x] [FEAT] Add EventsDashboard component and `/admin/events` page. Criterion #4
- [x] [DOCS] Update README CLI reference with run, watch, upgrade, and metrics commands. Criterion #1
- [x] [FEAT] Add `skynet metrics` CLI command for pipeline performance analytics. Criterion #5
- [x] [INFRA] Add pipeline velocity metrics to project-driver.sh prompt context. Criterion #3 and #5
- [x] [TEST] Add CLI unit tests for watch, run, upgrade, and cleanup commands. Criterion #2
- [x] [FIX] Delete stale dev/* branches for all superseded failed tasks. Criterion #3
- [x] [TEST] Add EventsDashboard component tests. Criterion #2
- [x] [TEST] Add `metrics.test.ts` CLI unit test. Criterion #2
- [x] [FEAT] Add `skynet export` CLI command for pipeline state snapshot. Criterion #1
- [x] [FIX] Fix mission criterion #2 evaluation formula in CLI status and pipeline-status handler
- [x] [TEST] Add events handler unit tests and ActivityFeed component tests — FRESH implementation
- [x] [TEST] Add vitest component tests for SettingsDashboard, WorkerScaling, and LogViewer
- [x] [TEST] Add vitest component tests for PipelineDashboard, TasksDashboard, and MissionDashboard
- [x] [FEAT] Add JSON output mode to `skynet status` for programmatic access — FRESH implementation
- [x] [TEST] Add component tests for MonitoringDashboard, PromptsDashboard, and SyncDashboard
- [x] [INFRA] Add events.log rotation to _events.sh to prevent unbounded growth
- [x] [TEST] Add vitest unit tests for core CLI commands
- [x] [FEAT] Add `skynet watch` command for real-time terminal monitoring
- [x] [FEAT] Add `skynet setup-agents --uninstall` for clean agent removal
- [x] [DOCS] Add CONTRIBUTING.md with agent plugin and extension guide
- [x] [FEAT] Add `skynet upgrade` CLI command for self-update
- [x] [FEAT] Add `skynet run` CLI command for one-shot task execution
- [x] [FEAT] Build events TypeScript handler, API route, and ActivityFeed dashboard component
- [x] [FIX] Adjust self-correction rate formula to count superseded tasks as pipeline self-correction
- [x] [FIX] Update README CLI reference to include pause, resume, and config commands
- [x] [TEST] Add config handler unit tests
- [x] [FIX] Fix CLI status command hardcoded worker heartbeat and worker list
- [x] [FEAT] Add self-correction rate calculation to pipeline-status and dashboard
- [x] [FEAT] Add graceful shutdown signal handling to dev-worker.sh and task-fixer.sh
- [x] [FEAT] Add `skynet pause` and `skynet resume` CLI commands — FRESH implementation
- [x] [INFRA] Extend watchdog stale branch cleanup to handle fixed and superseded tasks — FRESH implementation
- [x] [FEAT] Add pipeline completion detection and mission-complete notification
- [x] [FIX] Supersede stale pending failed-task entries for already-completed functionality
- [x] [DOCS] Add troubleshooting section to README.md
- [x] [FEAT] Add mission progress tracking to pipeline-status handler — FRESH implementation
- [x] [FEAT] Add mission viewer page to admin dashboard — FRESH implementation
- [x] [FIX] Fix watchdog crash_recovery and dispatch hardcoded worker IDs — FRESH implementation
- [x] [FIX] Add error boundaries and loading states to admin dashboard pages
- [x] [TEST] Add end-to-end test for full CLI command integration
- [x] [FEAT] Add `skynet config` CLI command for viewing and editing configuration
- [x] [FEAT] Add task retry budget and fixer cooldown to prevent infinite fix loops
- [x] [INFRA] Enhance `skynet doctor` with runtime consistency checks
- [x] [FIX] Wire WorkerScaling component into admin dashboard navigation
- [x] [FEAT] Add log viewer page to admin dashboard for live log viewing
- [x] [INFRA] Add Playwright E2E test job to CI workflow
- [x] [FIX] Fix SKYNET_MAX_WORKERS default mismatch between config template and watchdog
- [x] [TEST] Add unit tests for untested dashboard handlers
- [x] [FIX] Harden project-driver.sh against missing .dev/ state files
- [x] [FEAT] Add interactive mission template generator to `skynet init`
- [x] [INFRA] Add ESLint with TypeScript support to CI pipeline
- [x] [FEAT] Add `/admin/settings` page for config editing via dashboard
- [x] [TEST] Add mission-raw and pipeline-stream handler unit tests
- [x] [TEST] Add worker-scaling handler unit tests
- [x] [TEST] Add Playwright e2e tests for admin dashboard core flows
- [x] [FEAT] Add `skynet cleanup` CLI command for branch and worktree maintenance
- [x] [FIX] Inject previous failure context into task-fixer retry prompts
- [x] [FIX] Fix task-fixer reading only dev-worker-1.log regardless of which worker failed
- [x] [FEAT] Add `skynet logs` CLI command
- [x] [FEAT] Add `skynet add-task` CLI command
- [x] [FEAT] Add notification channel plugin system
- [x] [FEAT] Add `skynet dashboard` CLI command to launch admin app
- [x] [FEAT] Add pipeline health score to dashboard and `skynet status`
- [x] [INFRA] Add `npx skynet init` end-to-end smoke test
- [x] [FEAT] Add `skynet reset-task` CLI command
- [x] [FEAT] Add worker activity log rotation
- [x] [TEST] Add vitest unit tests for dashboard health score and task parsing
- [x] [FEAT] Add `skynet version` CLI command with update check
- [x] [FIX] Fix CLI scripts path resolution for npm package distribution
- [x] [FIX] Add PID lock to health-check.sh to prevent concurrent instances
- [x] [FIX] Harden task-fixer.sh EXIT trap for mid-merge crash safety
- [x] [FEAT] Add `skynet doctor` CLI diagnostics command
- [x] [FEAT] Add worker port offset to prevent dev-server conflicts
- [x] [FEAT] Add Linux cron support to monitoring agents dashboard handler — FRESH implementation
- [x] [FEAT] Add dynamic worker scaling from admin dashboard
- [x] [FEAT] Add backlog health validation to watchdog
- [x] [FEAT] Add task duration tracking to completed.md
- [x] [INFRA] Add root `test` script and CI unit test job
- [x] [FEAT] Add configurable quality gates via skynet.config.sh
- [x] [FEAT] Add `skynet status` CLI command
- [x] [FEAT] Add worker heartbeat and stale detection
- [x] [FEAT] Add agent plugin system for LLM-agnostic workers
- [x] [INFRA] Add shellcheck linting for all shell scripts
- [x] [FIX] Add merge conflict detection and fresh-branch retry to task-fixer
- [x] [DOCS] Add repository README.md with quickstart and architecture
- [x] [FEAT] Add task dependency tracking
- [x] [FEAT] Add real-time pipeline dashboard via Server-Sent Events
- [x] [FEAT] Add crash recovery to watchdog
- [x] [FEAT] Add `skynet start` and `skynet stop` CLI commands
- [x] [INFRA] Add npm package build and publish workflow
- [x] [INFRA] Add cron support alongside launchd
