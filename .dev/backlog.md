# Backlog

<!-- Priority: top = highest. Format: - [ ] [TAG] Task title — description -->
<!-- Markers: [ ] = pending, [>] = claimed by worker, [x] = done -->

- [x] [FIX] Fix CLI scripts path resolution for npm package distribution — packages/cli/src/commands/init.ts line 7 resolves SKYNET_ROOT via `resolve(__dirname, "../../../..")` which only works inside the monorepo. When installed from npm, scripts/ won't be at that path. Fix: add `"files": ["dist", "scripts"]` to packages/cli/package.json so scripts ship with the tarball, then change SKYNET_ROOT resolution to use `fileURLToPath(new URL('../../scripts', import.meta.url))` pattern (relative to the compiled dist/commands/init.js). Verify `npm pack` includes scripts/ and that init.ts can locate them. Also add `"prepublishOnly": "tsc"` to packages/cli/package.json
- [x] [FIX] Add PID lock to health-check.sh to prevent concurrent instances — health-check.sh has no PID lock, so overlapping launchd/cron runs could invoke Claude simultaneously. Add `LOCK_FILE="$SCRIPTS_DIR/health-check.lock"`, acquire via `mkdir "$LOCK_FILE"` at script start with stale detection (same pattern as dev-worker.sh lines ~50-70), release in an EXIT trap. This aligns with the robustness standard set by dev-worker.sh and task-fixer.sh
- [x] [FIX] Harden task-fixer.sh EXIT trap for mid-merge crash safety — current EXIT trap in task-fixer.sh is minimal. If the script crashes during `git merge` or `git push`, the task remains claimed and the branch is orphaned. Add a full `cleanup_on_exit` function (matching dev-worker.sh pattern): unclaim task in backlog.md via `unclaim_task()`, remove worktree via `git worktree remove --force`, release PID lock, stop any background processes, and log the crash event
- [x] [FEAT] Add `skynet doctor` CLI diagnostics command — create packages/cli/src/commands/doctor.ts. Check: (1) required tools exist: git, node, pnpm, shellcheck — show version or MISSING, (2) skynet.config.sh exists and is parseable, (3) scripts/ directory is accessible and contains expected files (dev-worker.sh, watchdog.sh, etc.), (4) agent availability: run `claude --version` and `codex --version`, report which are available, (5) .dev/ state files exist (backlog.md, completed.md, etc.), (6) worker PID lock files — show active/stale status, (7) git repo status — clean/dirty, current branch. Output a summary with PASS/WARN/FAIL per check. Register in packages/cli/src/index.ts
- [x] [FEAT] Add `skynet add-task` CLI command for backlog injection — create packages/cli/src/commands/add-task.ts. Usage: `skynet add-task "Task title" --tag FEAT --description "details" --position top --blocked-by "other task"`. Acquires the backlog mutex (same mkdir pattern as admin API POST handler in packages/dashboard/src/handlers/tasks.ts), formats as `- [ ] [TAG] Title — description`, optionally appends `<!-- blockedBy: ... -->` metadata. Defaults: tag=FEAT, position=top. Register in packages/cli/src/index.ts _(merge failed)_
- [x] [FEAT] Add worker port offset to prevent dev-server conflicts in multi-worker mode — in dev-worker.sh, when starting the dev server (start-dev.sh or SKYNET_START_DEV_CMD), pass a port offset based on WORKER_ID. Calculate: `WORKER_PORT=$((SKYNET_DEV_PORT + WORKER_ID - 1))`. Export as PORT env var before launching. Add SKYNET_DEV_PORT to skynet.config.sh (default: 3000). This prevents port collisions when workers 1 and 2 run simultaneously
- [x] [FEAT] Add Linux cron support to monitoring agents dashboard — packages/dashboard/src/handlers/monitoring-agents.ts only reads macOS launchctl. Add OS detection via `process.platform`: on Linux, parse `crontab -l` output for entries between `# BEGIN skynet` / `# END skynet` markers (matching the format written by setup-agents.ts). Map cron schedule expressions to human-readable intervals. Return same response shape so the dashboard renders identically on both platforms _(merge failed)_
- [x] [FEAT] Add dynamic worker scaling from admin dashboard — add a "Scale Workers" section to the admin monitoring page with +/- buttons per worker type (dev-worker, task-fixer, project-driver). Backend: create POST /api/admin/workers/scale handler in packages/dashboard/src/handlers/ that accepts `{ workerType, count }`, spawns or kills worker processes by invoking the corresponding script via `child_process.spawn()` with proper PID tracking. Frontend: add WorkerScaling component showing current active count per type with increment/decrement controls. Must handle: PID file cleanup on scale-down, heartbeat registration on scale-up, max worker limit from config
- [x] [FEAT] Add backlog health validation to watchdog — add a `validate_backlog()` function in scripts/_config.sh that checks: (1) no duplicate task titles in pending items, (2) no orphaned `[>]` (claimed) entries without a matching active worker in current-task-N.md files, (3) `blockedBy` references point to tasks that actually exist in backlog or completed. Call from watchdog.sh on each run. Log warnings for any issues found, auto-fix orphaned claims by resetting to `[ ]`
- [>] [FEAT] Add task duration tracking to completed.md — in dev-worker.sh, record task start timestamp (already available as `$STARTED`) and compute duration when logging to completed.md. Add a Duration column to the completed.md table: `| Date | Task | Branch | Duration | Notes |`. Format as human-readable (e.g., "23m", "1h 12m"). Also update task-fixer.sh to track fix duration. Update the pipeline-status handler in packages/dashboard/src/handlers/pipeline-status.ts to parse and include average task duration in its response
- [ ] [INFRA] Add root `test` script and CI unit test job — add `"test": "pnpm -r --filter '@ajioncorp/*' test"` to root package.json so `pnpm test` runs vitest in packages/dashboard (which already has 42 unit tests across 4 test files). Add a `unit-test` job to .github/workflows/ci.yml that runs `pnpm test` after install, alongside the existing typecheck and lint-sh jobs
- [ ] [FEAT] Add automatic stale branch cleanup for abandoned failed tasks — in watchdog.sh, after processing heartbeats, check failed-tasks.md for entries with attempts >= SKYNET_MAX_FIX_ATTEMPTS that have been escalated to blockers.md for more than 24 hours. If the branch still exists locally, run `git branch -D <branch>` and `git worktree prune`. Log cleanup actions. This prevents branch accumulation from permanently failed tasks
- [ ] [FEAT] Add `skynet version` CLI command with update check — create packages/cli/src/commands/version.ts. Read version from package.json, display it. Optionally check npm registry for latest version of @ajioncorp/skynet-cli via `npm view` (with timeout, non-blocking on failure). If outdated, suggest update command. Register in packages/cli/src/index.ts
- [x] [FEAT] Add configurable quality gates via skynet.config.sh — replace hardcoded typecheck+playwright gates in dev-worker.sh (lines ~140-180) and task-fixer.sh (lines ~165-220) with a SKYNET_GATES array. Add SKYNET_GATE_1="pnpm typecheck" etc. to skynet.config.sh. Loop through defined gates in both scripts. Default: just typecheck. This makes the pipeline generic for any project's CI needs
- [x] [FEAT] Add `skynet status` CLI command — create packages/cli/src/commands/status.ts that reads .dev/backlog.md, completed.md, failed-tasks.md, current-task.md, and worker PID lock files. Display: task counts by state, current task name+duration, worker PIDs and status, last activity timestamp, recent completions. Register in packages/cli/src/index.ts
- [x] [FEAT] we need to be able to see in admin for pipeline and monitoring who is active _(claude failed)_
- [x] [NMI] Lets have an ability to add more workers to different areas from the admin dynamically, say i want to increase the tester or fixer capacity or which ever i should be able to _(marked complete but no code was implemented — only .dev state files changed)_
- [x] [FEAT] Lets improve Pipeline and Monitoring for admin — some things are either dated or missing
- [x] [FEAT] Add worker heartbeat and stale detection — workers write a timestamp to .dev/worker-N.heartbeat every 60s during task execution (add periodic write in dev-worker.sh main implementation loop). watchdog.sh checks heartbeats on each run: if any heartbeat is older than SKYNET_STALE_MINUTES, kill the worker, unclaim its task in backlog.md, remove the worktree, reset current-task-N.md to idle
- [x] [FEAT] Add agent plugin system for LLM-agnostic workers — extract Claude Code and Codex CLI invocation from scripts/_config.sh run_agent() into separate plugins at scripts/agents/claude.sh and scripts/agents/codex.sh. Define standard interface: run_agent "prompt" "logfile" returns exit code. Add SKYNET_AGENT_PLUGIN config to skynet.config.sh. Allow custom agent scripts via file path
- [x] [INFRA] Add shellcheck linting for all shell scripts — add shellcheck as a dev dependency or document it as required tool, create `pnpm lint:sh` script that runs shellcheck on all scripts/*.sh files, fix reported issues (unquoted vars, missing error handling), integrate into the CI workflow
- [x] [TEST] Add integration test for full pipeline task lifecycle — create tests/integration/pipeline-lifecycle.test.sh. Test the complete flow: add task to backlog.md → claim_next_task() → verify worktree creation → simulate implementation → run quality gates → verify merge to main and completed.md entry. Also test failure path: task fails gates → logged in failed-tasks.md → task-fixer picks it up _(claude failed)_
- [x] [FEAT] Add `skynet logs` CLI command — create packages/cli/src/commands/logs.ts that tails or displays recent entries from .dev/scripts/*.log files. Support `skynet logs worker` (dev-worker), `skynet logs fixer` (task-fixer), `skynet logs watchdog`, `skynet logs --follow` for real-time tailing. Register in packages/cli/src/index.ts _(claude failed)_
- [x] [TEST] Add Playwright tests for all dashboard component interactions — expand/collapse, tab switching, trigger buttons, log viewer, mission viewer tab, metrics display _(claude failed)_
- [x] [INFRA] Add more tags and add tooltip to them — ability to fine define tasks _(claude failed)_
- [x] [FEAT] Add task dependency tracking — extend backlog.md syntax to support `blockedBy: task-title` metadata, update claim_next_task() in dev-worker.sh to skip tasks whose dependencies are not yet completed, add dependency visualization to dashboard tasks page
- [x] [FEAT] Add real-time pipeline dashboard via Server-Sent Events — create /api/admin/pipeline/stream route that watches .dev/ files for changes using fs.watch and streams status updates, update packages/admin/src/app/admin/pipeline/page.tsx to consume SSE instead of polling
- [x] [FEAT] Add crash recovery to watchdog _(playwright failed — retry pending, branch has implementation)_
- [x] [FEAT] Add `skynet start` and `skynet stop` CLI commands _(task-fixer retry in progress)_
- [x] [INFRA] Add npm package build and publish workflow _(playwright failed — retry pending, branch has implementation)_
- [x] [FEAT] Add self-correction metrics tracking _(playwright failed — retry pending, branch has implementation)_
- [x] [TEST] Add unit tests for shell script lock acquisition and task claiming _(playwright failed — retry pending, branch has implementation)_
- [x] [TEST] Add TypeScript tests for API handlers _(playwright failed — retry pending, branch has implementation)_
- [x] [FEAT] Add mission progress tracking to project-driver _(playwright failed — retry pending, branch has implementation)_
- [x] [FEAT] Add mission.md viewer tab to admin dashboard _(playwright failed — retry pending, branch has implementation)_
- [x] [INFRA] Add CI/CD workflow _(playwright failed — retry pending, branch has implementation)_
- [x] [FEAT] Add webhook notification support _(playwright failed — retry pending, branch has implementation)_
- [x] [INFRA] Add cron support alongside launchd _(playwright failed)_
